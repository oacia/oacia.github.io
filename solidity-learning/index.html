



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="qQVmgWozVe7BXoA15J3gAZpEA5dK168admH4U3W6PAk">
  <meta name="msvalidate.01" content="4902E39C0135E72DE537BCB0FE08B40A">
  <meta name="baidu-site-verification" content="codeva-CSYjpuVg5v">


<link rel="alternate" type="application/rss+xml" title="oaciaのBbBlog~" href="https://oacia.dev/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="oaciaのBbBlog~" href="https://oacia.dev/atom.xml" />
<link rel="alternate" type="application/json" title="oaciaのBbBlog~" href="https://oacia.dev/feed.json" />
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-regular.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-700.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/font_1832207_igi8uaupcus.woff2"
/>
<link rel="preload" href="/background_picture/1_gongzi.webp" as="image" />
<link rel="preload" href="/background_picture/2_xiaoxia.webp" as="image" />
<link rel="preload" href="/background_picture/3_xingye.webp" as="image" />
<link rel="preload" href="/images/avatar.jpg" as="image" />



<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="solidity" />


<link rel="canonical" href="https://oacia.dev/solidity-learning/">


<meta name="description" content="# 前言 过去曾简单接触过 solidity, 合约的内容基本上都是对于函数的调用，感觉和过去看 app 的 java 源码差不多，都是对事件的调用执行。曾经也在 Ropsten 测试网络中进行过几次智能合约的交易，对于交易的过程还是大致有一些了解的，那么我们首先从 solidity 的运行环境开始吧. # 环境配置 这里提供两种配置 solidity 环境的方法 # 通过 Remix 在网页执行">
<meta property="og:type" content="article">
<meta property="og:title" content="solidity语言学习">
<meta property="og:url" content="https://oacia.dev/solidity-learning/">
<meta property="og:site_name" content="oaciaのBbBlog~">
<meta property="og:description" content="# 前言 过去曾简单接触过 solidity, 合约的内容基本上都是对于函数的调用，感觉和过去看 app 的 java 源码差不多，都是对事件的调用执行。曾经也在 Ropsten 测试网络中进行过几次智能合约的交易，对于交易的过程还是大致有一些了解的，那么我们首先从 solidity 的运行环境开始吧. # 环境配置 这里提供两种配置 solidity 环境的方法 # 通过 Remix 在网页执行">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oacia.dev/solidity-learning/chrome_y0mIwkr1Dr.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/chrome_exrP7nVtG6.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%201.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%202.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%203.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%204.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%205.png">
<meta property="og:image" content="https://oacia.dev/solidity-learning/Untitled%206.png">
<meta property="article:published_time" content="2022-10-20T00:19:57.000Z">
<meta property="article:modified_time" content="2025-04-08T18:55:11.945Z">
<meta property="article:author" content="oacia">
<meta property="article:tag" content="solidity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oacia.dev/solidity-learning/chrome_y0mIwkr1Dr.png">
<meta name="twitter:creator" content="@oacia86">


  <title>
solidity语言学习 |
oacia = oaciaのBbBlog~ = DEVIL or SWEET</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  var jq_151 = $.noConflict(true);
  var RENDERER = {
    INIT_CHERRY_BLOSSOM_COUNT : 30,
    MAX_ADDING_INTERVAL : 10,
    WATCH_INTERVAL : 300,
    
    init : function(){
      this.setParameters();
      this.reconstructMethods();
      this.setup();
      this.bindEvent();
      this.render();
    },
    setParameters : function(){
      this.$window = jq_151(window);
      this.$container = jq_151('#loading');
      this.$canvas = jq_151('<canvas />');
      this.context = this.$canvas.appendTo(this.$container).get(0).getContext('2d');
      this.cherries = [];
      this.watchIds = [];
    },
    reconstructMethods : function(){
      this.watchWindowSize = this.watchWindowSize.bind(this);
      this.jdugeToStopResize = this.jdugeToStopResize.bind(this);
      this.render = this.render.bind(this);
    },
    setup : function(){
      this.cherries.length = 0;
      this.watchIds.length = 0;
      this.width = this.$container.width();
      this.height = this.$container.height();
      this.$canvas.attr({width : this.width, height : this.height});
      this.maxAddingInterval = Math.round(this.MAX_ADDING_INTERVAL * 1000 / this.width);
      this.addingInterval = this.maxAddingInterval;
      this.createCherries();
    },
    createCherries : function(){
      for(var i = 0, length = Math.round(this.INIT_CHERRY_BLOSSOM_COUNT * this.width / 1000); i < length; i++){
        this.cherries.push(new CHERRY_BLOSSOM(this, true));
      }
    },
    watchWindowSize : function(){
      this.clearTimer();
      this.tmpWidth = window.width;
      this.tmpHeight = window.height;
      this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL));
    },
    clearTimer : function(){
      while(this.watchIds.length > 0){
        clearTimeout(this.watchIds.pop());
      }
    },
    jdugeToStopResize : function(){
      var width = window.width,
        height = window.height,
        stopped = (width == this.tmpWidth && height == this.tmpHeight);
        
      this.tmpWidth = width;
      this.tmpHeight = height;
      
      if(stopped){
        this.setup();
      }
    },
    bindEvent : function(){
      this.$window.on('resize', this.watchWindowSize);
    },
    render : function(){
      //console.log("render")

      if(jq_151(this.$container).css("display")!="none"){
        requestAnimationFrame(this.render);
      }
      
      this.context.clearRect(0, 0, this.width, this.height);
      
      this.cherries.sort(function(cherry1, cherry2){
        return cherry1.z - cherry2.z;
      });
      for(var i = this.cherries.length - 1; i >= 0; i--){
        if(!this.cherries[i].render(this.context)){
          this.cherries.splice(i, 1);
        }
      }
      if(--this.addingInterval == 0){
        this.addingInterval = this.maxAddingInterval;
        this.cherries.push(new CHERRY_BLOSSOM(this, false));
      }
    }
  };
  var CHERRY_BLOSSOM = function(renderer, isRandom){
    this.renderer = renderer;
    this.init(isRandom);
  };
  CHERRY_BLOSSOM.prototype = {
    FOCUS_POSITION : 300,
    FAR_LIMIT : 600,
    MAX_RIPPLE_COUNT : 100,
    RIPPLE_RADIUS : 100,
    SURFACE_RATE : 0.5,
    SINK_OFFSET : 20,
    
    init : function(isRandom){
      this.x = this.getRandomValue(-this.renderer.width, this.renderer.width);
      this.y = isRandom ? this.getRandomValue(0, this.renderer.height) : this.renderer.height * 1.5;
      this.z = this.getRandomValue(0, this.FAR_LIMIT);
      this.vx = this.getRandomValue(-2, 2);
      this.vy = -2;
      this.theta = this.getRandomValue(0, Math.PI * 2);
      this.phi = this.getRandomValue(0, Math.PI * 2);
      this.psi = 0;
      this.dpsi = this.getRandomValue(Math.PI / 600, Math.PI / 300);
      this.opacity = 0;
      this.endTheta = false;
      this.endPhi = false;
      this.rippleCount = 0;
      
      var axis = this.getAxis(),
        theta = this.theta + Math.ceil(-(this.y + this.renderer.height * this.SURFACE_RATE) / this.vy) * Math.PI / 500;
      theta %= Math.PI * 2;
      
      this.offsetY = 40 * ((theta <= Math.PI / 2 || theta >= Math.PI * 3 / 2) ? -1 : 1);
      this.thresholdY = this.renderer.height / 2 + this.renderer.height * this.SURFACE_RATE * axis.rate;
      this.entityColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.entityColor.addColorStop(0, 'hsl(330, 70%, ' + 50 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(0.05, 'hsl(330, 40%,' + 55 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(1, 'hsl(330, 20%, ' + 70 * (0.3 + axis.rate) + '%)');
      this.shadowColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.shadowColor.addColorStop(0, 'hsl(330, 40%, ' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(0.05, 'hsl(330, 40%,' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(1, 'hsl(330, 20%, ' + 40 * (0.3 + axis.rate) + '%)');
    },
    getRandomValue : function(min, max){
      return min + (max - min) * Math.random();
    },
    getAxis : function(){
      var rate = this.FOCUS_POSITION / (this.z + this.FOCUS_POSITION),
        x = this.renderer.width / 2 + this.x * rate,
        y = this.renderer.height / 2 - this.y * rate;
      return {rate : rate, x : x, y : y};
    },
    renderCherry : function(context, axis){
      context.beginPath();
      context.moveTo(0, 40);
      context.bezierCurveTo(-60, 20, -10, -60, 0, -20);
      context.bezierCurveTo(10, -60, 60, 20, 0, 40);
      context.fill();
      
      for(var i = -4; i < 4; i++){
        context.beginPath();
        context.moveTo(0, 40);
        context.quadraticCurveTo(i * 12, 10, i * 4, -24 + Math.abs(i) * 2);
        context.stroke();
      }
    },
    render : function(context){
      var axis = this.getAxis();
      
      if(axis.y == this.thresholdY && this.rippleCount < this.MAX_RIPPLE_COUNT){
        context.save();
        context.lineWidth = 2;
        context.strokeStyle = 'hsla(0, 0%, 100%, ' + (this.MAX_RIPPLE_COUNT - this.rippleCount) / this.MAX_RIPPLE_COUNT + ')';
        context.translate(axis.x + this.offsetY * axis.rate * (this.theta <= Math.PI ? -1 : 1), axis.y);
        context.scale(1, 0.3);
        context.beginPath();
        context.arc(0, 0, this.rippleCount / this.MAX_RIPPLE_COUNT * this.RIPPLE_RADIUS * axis.rate, 0, Math.PI * 2, false);
        context.stroke();
        context.restore();
        this.rippleCount++;
      }
      if(axis.y < this.thresholdY || (!this.endTheta || !this.endPhi)){
        if(this.y <= 0){
          this.opacity = Math.min(this.opacity + 0.01, 1);
        }
        context.save();
        context.globalAlpha = this.opacity;
        context.fillStyle = this.shadowColor;
        context.strokeStyle = 'hsl(330, 30%,' + 40 * (0.3 + axis.rate) + '%)';
        context.translate(axis.x, Math.max(axis.y, this.thresholdY + this.thresholdY - axis.y));
        context.rotate(Math.PI - this.theta);
        context.scale(axis.rate * -Math.sin(this.phi), axis.rate);
        context.translate(0, this.offsetY);
        this.renderCherry(context, axis);
        context.restore();
      }
      context.save();
      context.fillStyle = this.entityColor;
      context.strokeStyle = 'hsl(330, 40%,' + 70 * (0.3 + axis.rate) + '%)';
      context.translate(axis.x, axis.y + Math.abs(this.SINK_OFFSET * Math.sin(this.psi) * axis.rate));
      context.rotate(this.theta);
      context.scale(axis.rate * Math.sin(this.phi), axis.rate);
      context.translate(0, this.offsetY);
      this.renderCherry(context, axis);
      context.restore();
      
      if(this.y <= -this.renderer.height / 4){
        if(!this.endTheta){
          for(var theta = Math.PI / 2, end = Math.PI * 3 / 2; theta <= end; theta += Math.PI){
            if(this.theta < theta && this.theta + Math.PI / 200 > theta){
              this.theta = theta;
              this.endTheta = true;
              break;
            }
          }
        }
        if(!this.endPhi){
          for(var phi = Math.PI / 8, end = Math.PI * 7 / 8; phi <= end; phi += Math.PI * 3 / 4){
            if(this.phi < phi && this.phi + Math.PI / 200 > phi){
              this.phi = Math.PI / 8;
              this.endPhi = true;
              break;
            }
          }
        }
      }
      if(!this.endTheta){
        if(axis.y == this.thresholdY){
          this.theta += Math.PI / 200 * ((this.theta < Math.PI / 2 || (this.theta >= Math.PI && this.theta < Math.PI * 3 / 2)) ? 1 : -1);
        }else{
          this.theta += Math.PI / 500;
        }
        this.theta %= Math.PI * 2;
      }
      if(this.endPhi){
        if(this.rippleCount == this.MAX_RIPPLE_COUNT){
          this.psi += this.dpsi;
          this.psi %= Math.PI * 2;
        }
      }else{
        this.phi += Math.PI / ((axis.y == this.thresholdY) ? 200 : 500);
        this.phi %= Math.PI;
      }
      if(this.y <= -this.renderer.height * this.SURFACE_RATE){
        this.x += 2;
        this.y = -this.renderer.height * this.SURFACE_RATE;
      }else{
        this.x += this.vx;
        this.y += this.vy;
      }
      return this.z > -this.FOCUS_POSITION && this.z < this.FAR_LIMIT && this.x < this.renderer.width * 1.5;
    }
  };
  jq_151(function(){
    RENDERER.init();
  });
</script>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <!--
    <div class="alice">
      <img src="/images/alice-shake.gif" alt="">
    </div>

    
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
    -->
  </div>
  <script
      defer="defer"
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"
      integrity="sha512-1dalHDkG9EtcOmCnoCjiwQ/HEB5SDNqw8d4G2MKoNwjiwMNeBAkudsBCmSlMnXdsH8Bm0mOd3tl/6nL5y0bMaQ=="
      crossorigin="anonymous"
    ></script>
  <script defer="defer" src="/js/gsap/DrawSVGPlugin.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomEase.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomBounce.min.js"></script>
  <script defer="defer" src="/js/gsap/SplitText.min.js"></script>
  <script defer="defer" src="/js/gsap/logo-run.js"></script>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">solidity语言学习
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-10-20 08:19:57">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-10-20T08:19:57+08:00">2022-10-20</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>25k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>23 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">oacia</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/background_picture/1_mary.jpg"></li>
          <li class="item" data-background-image="/background_picture/2_xingye.webp"></li>
          <li class="item" data-background-image="/background_picture/3_xiaoxia.webp"></li>
          <li class="item" data-background-image="/background_picture/4_alice.webp"></li>
          <li class="item" data-background-image="/background_picture/5_mutsuki.jpg"></li>
          <li class="item" data-background-image="/background_picture/6_arona_plana.webp"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb">
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://oacia.dev/solidity-learning/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="oacia">
    <meta itemprop="description" content="DEVIL or SWEET, 月遇从云 花遇和风">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="oaciaのBbBlog~">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="前言"><a class="anchor" href="#前言">#</a> 前言</h1>
<p>过去曾简单接触过 solidity, 合约的内容基本上都是对于函数的调用，感觉和过去看 app 的 java 源码差不多，都是对事件的调用执行。曾经也在 Ropsten 测试网络中进行过几次智能合约的交易，对于交易的过程还是大致有一些了解的，那么我们首先从 solidity 的运行环境开始吧.</p>
<h1 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h1>
<p>这里提供两种配置 solidity 环境的方法</p>
<h2 id="通过remix在网页执行solidity推荐方便快捷"><a class="anchor" href="#通过remix在网页执行solidity推荐方便快捷">#</a> 通过<span class="exturl" data-url="aHR0cDovL3JlbWl4LmV0aGVyZXVtLm9yZw=="> Remix</span> 在网页执行 solidity (推荐，方便快捷)</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzYxMjQzOTY1L2FydGljbGUvZGV0YWlscy8xMjU1ODA0MTY=">Solidity 开发环境搭建</span></p>
<h2 id="通过visual-code安装solidity"><a class="anchor" href="#通过visual-code安装solidity">#</a> 通过 visual code 安装 solidity</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9jNWJlNzk2NmQ4MzI=">solidity vscode 环境配置</span></p>
<p>1、安装 vscode、node、git 等；</p>
<p>2、打开 vscode，搜索扩展组建 “solidity + hardhat”，安装；</p>
<p>3、安装 prettier 扩展组建</p>
<p>4、格式化代码设置：</p>
<p>“查看” - “命令面板”，输入 setting，点击 Open setting JSON，</p>
<p><img data-src="/solidity-learning/chrome_y0mIwkr1Dr.png" alt="chrome_y0mIwkr1Dr.png" style="aspect-ratio:827 / 504;"></p>
<p>增加:</p>
<figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token string-property property">"[solidity]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"NomicFoundation.hardhat-solidity"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">"[javascript]"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token string">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string">"editor.formatOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span></pre></td></tr></table></figure><p>这样每次保存时，就自动格式化代码；</p>
<p>5、“查看” - “命令面板”，输入 setting，点击 Open User settings,</p>
<p><img data-src="/solidity-learning/chrome_exrP7nVtG6.png" alt="chrome_exrP7nVtG6.png" style="aspect-ratio:827 / 579;"></p>
<h1 id="solidity的数值类型"><a class="anchor" href="#solidity的数值类型">#</a> solidity 的数值类型</h1>
<p>solidity 的数值类型有四类，分别是</p>
<ol>
<li>布尔型<br>
和 c 语言的布尔型类似，solidity 的布尔类型 (  <code>bool</code> ) 也有  <code>true</code>  和  <code>false</code>  两个值</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 布尔值</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">bool</span> <span class="token keyword">public</span> _bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>而布尔型的运算符包括</p>
<ul>
<li>!(逻辑非)</li>
<li>&amp;&amp; (逻辑与，即 and)</li>
<li>||  (逻辑非，即 or)</li>
<li>== (等于)</li>
<li>!= (不等于)</li>
</ul>
<blockquote>
<p>注意: <code>&amp;&amp;</code>  和  <code>||</code>  运算符遵循的是短路规则，从左到右顺序开始运算，例如有  <code>f(x)||g(y)</code>  , 如果  <code>f(x)</code>  的值是  <code>true</code>  , 那么  <code>g(y)</code>  的值将会不会被运算， <code>f(x)&amp;&amp;g(y)</code>  也是同理，如果  <code>f(x)</code>  的值是  <code>false</code>  , 那么  <code>g(y)</code>  同样不会被计算.(<strong>这可以用来节约 gas</strong>)</p>
</blockquote>
<ol>
<li>整型</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 整型</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">int</span> <span class="token keyword">public</span> _int <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 整数，包括负数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> _uint <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 正整数</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">public</span> _number <span class="token operator">=</span> <span class="token number">20220330</span><span class="token punctuation">;</span> <span class="token comment">// 256 位正整数</span></pre></td></tr></table></figure><p>常用的整型运算符包括：</p>
<ul>
<li>比较运算符（返回布尔值）：  <code>&lt;=</code> ，  <code>&lt;</code> ，  <code>==</code> ，  <code>!=</code> ，  <code>&gt;=</code> ，  <code>&gt;</code></li>
<li>算数运算符：  <code>+</code> ， ``， 一元运算  <code>+</code> ,  <code>-</code> ,  <code>*</code> ,  <code>/</code> ，  <code>%</code> （取余），  <code>**</code> （幂）</li>
</ul>
<p>这里除了幂运算 (  <code>**</code> ) 和 python 的语法类似，别的整型运算符可以参考 c 语言</p>
<ol>
<li>地址类型</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 地址</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">public</span> _address <span class="token operator">=</span> <span class="token number">0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> _address1 <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>_address<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//payable address，可以转账、查余额</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 地址类型的成员</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">public</span> balance <span class="token operator">=</span> _address1<span class="token punctuation">.</span>balance<span class="token punctuation">;</span> <span class="token comment">// balance of address</span></pre></td></tr></table></figure><p>此处的  <code>payable</code>  可以重点关注下，因为  <code>payable address</code>  拥有  <code>balance</code>  和  <code>transfer()</code>  两个成员，简单来说， <code>banlance</code>  用来查询账户的余额，而  <code>transfer()</code>  则可以向一个地址发送以太.</p>
<ol>
<li>定长字节数组<br>
字节数组 <code>bytes</code>  分两种，一种定长（ <code>byte</code> ,  <code>bytes8</code> ,  <code>bytes32</code> ），另一种不定长。定长的属于数值类型，不定长的是引用类型。 定长 <code>bytes</code>  可以存一些数据，消耗 <code>gas</code>  比较少。</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 固定长度的字节数组</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">bytes32</span> <span class="token keyword">public</span> _byte32 <span class="token operator">=</span> <span class="token string">"MiniSolidity"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">bytes1</span> <span class="token keyword">public</span> _byte <span class="token operator">=</span> _byte32<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>MiniSolidity</code>  变量以字节的方式存储进变量 <code>_byte32</code> ，转换成 <code>16进制</code> 为： <code>0x4d696e69536f6c69646974790000000000000000000000000000000000000000</code></p>
<p><code>_byte</code>  变量存储 <code>_byte32</code>  的第一个字节，为 <code>0x4d</code> 。</p>
<ol>
<li>枚举类型 enum</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 用 enum 将 uint 0， 1， 2 表示为 Buy, Hold, Sell</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">enum</span> <span class="token class-name">ActionSet</span> <span class="token punctuation">&#123;</span> Buy<span class="token punctuation">,</span> Hold<span class="token punctuation">,</span> Sell <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 创建 enum 变量 action</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    ActionSet action <span class="token operator">=</span> ActionSet<span class="token punctuation">.</span>Buy<span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="solidity的函数类型"><a class="anchor" href="#solidity的函数类型">#</a> solidity 的函数类型</h1>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token operator">&lt;</span><span class="token keyword">function</span> name<span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>parameter types<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">internal</span><span class="token operator">|</span><span class="token keyword">external</span><span class="token operator">|</span><span class="token keyword">public</span><span class="token operator">|</span><span class="token keyword">private</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span><span class="token keyword">pure</span><span class="token operator">|</span><span class="token keyword">view</span><span class="token operator">|</span><span class="token keyword">payable</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">return</span> types<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr></table></figure><ol>
<li>
<p><code>function</code>  用来声明一个函数，固定用法，这与 python 用  <code>def</code>  来声明一个函数有些类似</p>
</li>
<li>
<p><code>&lt;function name&gt;</code>  函数名，自己定</p>
</li>
<li>
<p><code>(&lt;parameter types&gt;)</code>  传入函数中的参数</p>
</li>
<li>
<p><code>&#123;internal|external|public|private&#125;</code>  说明函数的类型，未标明默认函数类型为  <code>internal</code>  .</p>
<ul>
<li><code>public</code> : 内部外部均可见。(也可用于修饰状态变量，public 变量会自动生成  <code>getter</code>  函数，用于查询数值).</li>
<li><code>private</code> : 只能从本合约内部访问，继承的合约也不能用（也可用于修饰状态变量）</li>
<li><code>external</code> : 只能从合约外部访问（但是可以用 <code>this.f()</code>  来调用， <code>f</code>  是函数名）</li>
<li><code>internal</code> : 只能从合约内部访问，继承的合约可以用（也可用于修饰状态变量)</li>
</ul>
</li>
<li>
<p><code>[pure|view|payable]</code>  决定函数权限 / 功能的关键字。带有 <code>payable</code>  的函数可以用来给合约转入 ETH, 而  <code>pure</code>  和  <code>view</code>  , 根据 wtf 大佬的说法，是因为  <code>gas fee</code>  的原因，合约的状态变量存储在链上， <code>gas fee</code>  很贵，如果不改变链上状态，就不用付 <code>gas</code> 。包含 <code>pure</code>  跟 <code>view</code>  关键字的函数是不改写链上状态的，因此用户直接调用他们是不需要付 gas 的（合约中 <code>pure</code> / <code>view</code>  函数调用它们则会改写链上状态，需要付 gas）。</p>
<p>在以太坊中，以下语句被视为修改链上状态：</p>
<ol>
<li>写入状态变量。</li>
<li>释放事件。</li>
<li>创建其他合同。</li>
<li>使用 <code>selfdestruct</code> .</li>
<li>通过调用发送以太币。</li>
<li>调用任何未标记 <code>view</code>  或 <code>pure</code>  的函数。</li>
<li>使用低级调用（low-level calls）。</li>
<li>使用包含某些操作码的内联汇编。</li>
</ol>
<p><strong>这里总结一下三个关键字的作用</strong></p>
<ul>
<li><code>pure</code>  不能读写</li>
<li><code>view</code>  能读不能写</li>
<li><code>payable</code>  可以用来交易</li>
</ul>
</li>
<li>
<p><code>[returns ()]</code>  函数返回的变量类型和名称。</p>
</li>
</ol>
<h1 id="solidity的函数输出"><a class="anchor" href="#solidity的函数输出">#</a> solidity 的函数输出</h1>
<p>solidity 支持函数返回多个值，solidity 函数输出的关键字为  <code>return</code>  和 <code>returns</code></p>
<ul>
<li><code>returns</code>  加在函数名后面，用于声明返回的变量类型及变量名；</li>
<li><code>return</code>  用于函数主体中，返回指定的变量。</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 返回多个变量</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">returnMultiple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>当然，solidity 也可以使用<strong>命名式返回</strong>，示例如下</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 命名式返回</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">returnNamed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _number<span class="token punctuation">,</span> <span class="token builtin">bool</span> _bool<span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> _array<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        _number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        _bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>        _array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">//return (1, true, [uint256 (1),2,5]); 也可以直接用 return 返回值</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity变量的数据存储类型"><a class="anchor" href="#solidity变量的数据存储类型">#</a> solidity 变量的数据存储类型</h1>
<p>solidity 数据存储位置有三类： <code>storage</code> ， <code>memory</code>  和 <code>calldata</code> 。不同存储位置的 <code>gas</code>  成本不同。 <code>storage</code>  类型的数据存在链上，类似计算机的硬盘，消耗 <code>gas</code>  多； <code>memory</code>  和 <code>calldata</code>  类型的临时存在内存里，消耗 <code>gas</code>  少。大致用法：</p>
<ol>
<li><code>storage</code> ：合约里的状态变量默认都是 <code>storage</code> ，存储在链上。</li>
<li><code>memory</code> ：函数里的参数和临时变量一般用 <code>memory</code> ，存储在内存中，不上链。</li>
<li><code>calldata</code> ：和 <code>memory</code>  类似，存储在内存中，不上链。与 <code>memory</code>  的不同点在于 <code>calldata</code>  变量不能修改（ <code>immutable</code> ），一般用于函数的参数。例子：</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">fCalldata</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> _x<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token comment">// 参数为 calldata 数组，不能被修改</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">//_x [0] = 0 // 这样修改会报错</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>_x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="数据位置和赋值规则"><a class="anchor" href="#数据位置和赋值规则">#</a> 数据位置和赋值规则</h2>
<ol>
<li><code>storage</code> （合约的状态变量）赋值给本地 <code>storage</code> （函数里的）时候，会创建引用，<strong>改变新变量会影响原变量</strong>。例子：</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 状态变量：数组 x</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">fStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// 声明一个 storage 的变量 xStorage，指向 x。修改 xStorage 也会影响 x</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> xStorage <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        xStorage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li><code>storage</code>  赋值给 <code>memory</code> ，会<strong>创建独立的副本</strong>，修改其中一个<strong>不会影响</strong>另一个；反之亦然。例子：</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 状态变量：数组 x</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">fMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// 声明一个 Memory 的变量 xMemory，复制 x。修改 xMemory 不会影响 x</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> xMemory <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> xMemory2 <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        xMemory2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li><code>memory</code>  赋值给 <code>memory</code> ，会创建引用，改变新变量会影响原变量。</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">fMemory2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>		<span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> x_tmp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> xMemory <span class="token operator">=</span> x_tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> x_tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li>其他情况，变量赋值给 <code>storage</code> ，会创建独立的复本，修改其中一个不会影响另一个。</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">fStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token builtin">uint</span>  xMemory<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        xMemory<span class="token operator">=</span><span class="token number">123456</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>xMemory<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>				xMemory<span class="token operator">=</span><span class="token number">66666666</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="四种规则的测试代码"><a class="anchor" href="#四种规则的测试代码">#</a> 四种规则的测试代码</h3>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//SPDX-License-Identifier:MIT</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.7</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">dataStorageRule</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 类型为 storage</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">RuleOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> xstorage <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            xstorage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">111</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">Ruletwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">,</span><span class="token builtin">uint</span><span class="token punctuation">,</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> xstorage <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        xstorage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">111</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        xstorage<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">222</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        xstorage<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">333</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">Rulethree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> x_tmp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token builtin">uint8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> xMemory <span class="token operator">=</span> x_tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        xMemory<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> x_tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">Rulefour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token builtin">uint</span>  xMemory<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        xMemory<span class="token operator">=</span><span class="token number">123456</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>xMemory<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>				xMemory<span class="token operator">=</span><span class="token number">66666666</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li>Ruleone</li>
</ul>
<p><img data-src="/solidity-learning/Untitled.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<ul>
<li>Ruletwo</li>
</ul>
<p><img data-src="/solidity-learning/Untitled%201.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<ul>
<li>Rulethree</li>
</ul>
<p><img data-src="/solidity-learning/Untitled%202.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<ul>
<li>Rulefour</li>
</ul>
<p><img data-src="/solidity-learning/Untitled%203.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<h3 id="这里用一张关系图来总结一下这四种规则"><a class="anchor" href="#这里用一张关系图来总结一下这四种规则">#</a> 这里用一张关系图来总结一下这四种规则</h3>
<p><img data-src="/solidity-learning/Untitled%204.png" alt="Untitled" style="aspect-ratio:781 / 621;"></p>
<h1 id="变量的作用域"><a class="anchor" href="#变量的作用域">#</a> 变量的作用域</h1>
<p><code>Solidity</code>  中变量按作用域划分有三种，分别是状态变量（state variable），局部变量（local variable）和全局变量 (global variable)</p>
<ol>
<li>状态变量<br>
指的是存储在链上的变量，所有合约内的函数都可以访问，定义在合约内，函数外，可以在函数内修改状态变量的值，<strong>gas 消耗高.</strong></li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Variables</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">string</span> <span class="token keyword">public</span> z<span class="token punctuation">;</span></pre></td></tr></table></figure><ol>
<li>局部变量<br>
存储在内存中，gas 消耗低</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token builtin">uint</span> xx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">uint</span> yy <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">uint</span> zz <span class="token operator">=</span> xx <span class="token operator">+</span> yy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>zz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li>全局变量<br>
全局变量是全局范围工作的变量，都是 <code>solidity</code>  预留关键字。他们可以在函数内不声明直接使用</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token builtin">address</span> sender <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">uint</span> blockNum <span class="token operator">=</span> block<span class="token punctuation">.</span>number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data <span class="token operator">=</span> msg<span class="token punctuation">.</span>data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> blockNum<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>常用的全局变量关键字:</p>
<ul>
<li><code>blockhash(uint blockNumber) returns (bytes32)</code> ：指定区块的区块哈希 —— 仅可用于最新的 256 个区块且不包括当前区块，否则返回 0 。</li>
<li><code>block.basefee</code>  ( <code>uint</code> ): 当前区块的基础费用，参考： (<span class="exturl" data-url="aHR0cHM6Ly9laXBzLmV0aGVyZXVtLm9yZy9FSVBTL2VpcC0zMTk4">EIP-3198</span> 和 <span class="exturl" data-url="aHR0cHM6Ly9laXBzLmV0aGVyZXVtLm9yZy9FSVBTL2VpcC0xNTU5">EIP-1559</span>)</li>
<li><code>block.chainid</code>  ( <code>uint</code> ): 当前链 id</li>
<li><code>block.coinbase</code>  (  <code>address</code>  ): 挖出当前区块的矿工地址</li>
<li><code>block.difficulty</code>  (  <code>uint</code>  ): 当前区块难度</li>
<li><code>block.gaslimit</code>  (  <code>uint</code>  ): 当前区块 gas 限额</li>
<li><code>block.number</code>  (  <code>uint</code>  ): 当前区块号</li>
<li><code>block.timestamp</code>  (  <code>uint</code> ): 自 unix epoch 起始当前区块以秒计的时间戳</li>
<li><code>gasleft() returns (uint256)</code>  ：剩余的 gas</li>
<li><code>msg.data</code>  (  <code>bytes</code>  ): 完整的 calldata</li>
<li><code>msg.sender</code>  (  <code>address</code>  ): 消息发送者（当前调用）</li>
<li><code>msg.sig</code>  (  <code>bytes4</code>  ): calldata 的前 4 字节（也就是函数标识符）</li>
<li><code>msg.value</code>  (  <code>uint</code>  ): 随消息发送的 wei 的数量</li>
<li><code>tx.gasprice</code>  ( <code>uint</code> ): 交易的 gas 价格</li>
<li><code>tx.origin</code>  (  <code>address</code>  ): 交易发起者（完全的调用链）</li>
</ul>
<h1 id="solidity的引用类型"><a class="anchor" href="#solidity的引用类型">#</a> solidity 的引用类型</h1>
<p><strong>引用类型 (Reference Type)</strong>：包括数组（ <code>array</code> ），结构体（ <code>struct</code> ）和映射（ <code>mapping</code> ），这类变量占空间大，赋值时候直接传递地址（类似指针）。由于这类变量比较复杂，占用存储空间大，我们在使用时必须要声明数据存储的位置。</p>
<h2 id="数组-array"><a class="anchor" href="#数组-array">#</a> 数组 array</h2>
<p>数组（ <code>Array</code> ）是 <code>solidity</code>  常用的一种变量类型，用来存储一组数据（整数，字节，地址等等）。数组分为固定长度数组和可变长度数组两种：</p>
<ul>
<li>固定长度数组：在声明时指定数组的长度。用 <code>T[k]</code>  的格式声明，其中 <code>T</code>  是元素的类型， <code>k</code>  是长度，例如：</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 固定长度 Array</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> array1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">bytes1</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> array2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> array3<span class="token punctuation">;</span></pre></td></tr></table></figure><p>・可变长度数组（动态数组）：在声明时不指定数组的长度。用 <code>T[]</code>  的格式声明，其中 <code>T</code>  是元素的类型，例如（ <code>**bytes</code>  比较特殊，是数组，但是不用加 <code>[]</code> **）：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 可变长度 Array</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">bytes1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array6<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">bytes</span> array7<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="创建数组的规则"><a class="anchor" href="#创建数组的规则">#</a> 创建数组的规则</h3>
<ul>
<li>对于 <code>memory</code>  修饰的 <code>动态数组</code> ，可以用 <code>new</code>  操作符来创建，但是必须声明长度，并且声明后长度不能改变。例子：</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//memory 动态数组</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> array8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> array9 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bytes</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>数组字面常数 (Array Literals) 是写作表达式形式的数组，用方括号包着来初始化 array 的一种方式，并且里面每一个元素的 type 是<strong>以第一个元素为准的</strong>，例如 <code>[1,2,3]</code>  里面所有的元素都是 uint8 类型，因为在 solidity 中如果一个值没有指定 type 的话，默认就是最小单位的该 type，这里 int 的默认最小单位类型就是 uint8。而 <code>[uint(1),2,3]</code>  里面的元素都是 uint 类型，因为第一个元素指定了是 uint 类型了，我们都以第一个元素为准。</li>
<li>如果创建的是动态数组，你需要一个一个元素的赋值。</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="数组成员"><a class="anchor" href="#数组成员">#</a> 数组成员</h3>
<ul>
<li><code>length</code> : 数组有一个包含元素数量的 <code>length</code>  成员， <code>memory</code>  数组的长度在创建后是固定的。</li>
<li><code>push()</code> :  <code>动态数组</code> 和 <code>bytes</code>  拥有 <code>push()</code>  成员，可以在数组最后添加一个 <code>0</code>  元素。</li>
<li><code>push(x)</code> :  <code>动态数组</code> 和 <code>bytes</code>  拥有 <code>push(x)</code>  成员，可以在数组最后添加一个 <code>x</code>  元素。</li>
<li><code>pop()</code> :  <code>动态数组</code> 和 <code>bytes</code>  拥有 <code>pop()</code>  成员，可以移除数组最后一个元素。</li>
</ul>
<h2 id="结构体-struct"><a class="anchor" href="#结构体-struct">#</a> 结构体 struct</h2>
<p>创建一个结构体：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 结构体</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Student</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">uint256</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">uint256</span> score<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>初始化一个结构体：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre>Student student<span class="token punctuation">;</span> <span class="token comment">// 初始一个 student 结构体</span></pre></td></tr></table></figure><hr>
<p><strong>结构体赋值的两种方法：</strong></p>
<ul>
<li>方法 1: 在函数中创建一个  <code>storage</code>  的  <code>struct</code>  引用</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">initStudent1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        Student <span class="token keyword">storage</span> _student <span class="token operator">=</span> student<span class="token punctuation">;</span> <span class="token comment">// assign a copy of student</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        _student<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        _student<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li>方法 2: 直接引用<strong>状态变量</strong>的  <code>struct</code></li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">initStudent2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        student<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        student<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity中的哈希表映射类型mapping"><a class="anchor" href="#solidity中的哈希表映射类型mapping">#</a> solidity 中的哈希表：映射类型 (mapping)</h1>
<h2 id="映射mapping"><a class="anchor" href="#映射mapping">#</a> 映射 mapping</h2>
<p>在映射中，人们可以通过键（ <code>Key</code> ）来查询对应的值（ <code>Value</code> ），比如：通过一个人的 <code>id</code>  来查询他的钱包地址。</p>
<p>声明映射的格式为 <code>mapping(_KeyType =&gt; _ValueType)</code> ，其中 <code>_KeyType</code>  和 <code>_ValueType</code>  分别是 <code>Key</code>  和 <code>Value</code>  的变量类型。例子：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=></span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> idToAddress<span class="token punctuation">;</span> <span class="token comment">//id 映射到地址</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> swapPair<span class="token punctuation">;</span> <span class="token comment">// 币对的映射，地址到地址</span></pre></td></tr></table></figure><p>这里用  <code>mapping(uint =&gt; address) public idToAddress</code>  来说明一下映射类型，例如有一个用户他的 id 叫做  <code>oacia</code>  , 并且他的钱包地址是  <code>0xABCDEF</code>  , 那么我们可以使用如下语句  <code>idToAddress[oacia]=0xABCDEF</code>  这种方式，来将用户  <code>oacia</code>  与他的钱包地址  <code>0xABCDEF</code>  联系起来，下次用户  <code>oacia</code>  再次使用这一个合约时，通过映射  <code>idToAddress</code>  可以马上知道这个用户的钱包地址为  <code>0xABCDEF</code>  .</p>
<h2 id="映射的规则"><a class="anchor" href="#映射的规则">#</a> 映射的规则</h2>
<ul>
<li><strong>规则 1</strong>：映射的 <code>_KeyType</code>  只能选择 <code>solidity</code>  默认的类型，比如 <code>uint</code> ， <code>address</code>  等，不能用自定义的结构体。而 <code>_ValueType</code>  可以使用自定义的类型。下面这个例子<strong>会报错</strong>，因为 <code>_KeyType</code>  使用了我们自定义的结构体：</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 我们定义一个结构体 Struct</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Student</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">uint256</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">uint256</span> score<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>     <span class="token keyword">mapping</span><span class="token punctuation">(</span>Student <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword">public</span> testVar<span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li><strong>规则 2</strong>：映射的存储位置<strong>必须是</strong> <code>storage</code> ，因此可以用于合约的状态变量，函数中的 <code>storage</code>  变量，和 library 函数的参数（见<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL3NvbGlkaXR5L2lzc3Vlcy80NjM1">例子</span>）。不能用于 <code>public</code>  函数的参数或返回结果中，因为 <code>mapping</code>  记录的是一种关系 (key - value pair)。</li>
<li><strong>规则 3</strong>：如果映射声明为 <code>public</code> ，那么 <code>solidity</code>  会自动给你创建一个 <code>getter</code>  函数，可以通过 <code>Key</code>  来查询对应的 <code>Value</code> 。</li>
<li><strong>规则 4</strong>：给映射新增的键值对的语法为 <code>_Var[_Key] = _Value</code> ，其中 <code>_Var</code>  是映射变量名， <code>_Key</code>  和 <code>_Value</code>  对应新增的键值对。例子：</li>
</ul>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> writeMap <span class="token punctuation">(</span><span class="token builtin">uint</span> _Key<span class="token punctuation">,</span> <span class="token builtin">address</span> _Value<span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        idToAddress<span class="token punctuation">[</span>_Key<span class="token punctuation">]</span> <span class="token operator">=</span> _Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="映射的原理"><a class="anchor" href="#映射的原理">#</a> 映射的原理</h2>
<ul>
<li><strong>原理 1</strong>: 映射不储存任何键（ <code>Key</code> ）的资讯，也没有 length 的资讯。</li>
<li><strong>原理 2</strong>: 映射使用 <code>keccak256(key)</code>  当成 offset 存取 value。</li>
<li><strong>原理 3</strong>: 因为 Ethereum 会定义所有未使用的空间为 0，所以未赋值（ <code>Value</code> ）的键（ <code>Key</code> ）初始值都是 0。</li>
</ul>
<h1 id="变量的初始值"><a class="anchor" href="#变量的初始值">#</a> 变量的初始值</h1>
<p>当我们刚定义一个变量并且没有给变量赋值时，solidity 会默认为新定义的变量赋初值，具体如下</p>
<h2 id="值类型初始值"><a class="anchor" href="#值类型初始值">#</a> 值类型初始值</h2>
<ul>
<li><code>boolean</code> :  <code>false</code></li>
<li><code>string</code> :  <code>&quot;&quot;</code></li>
<li><code>int</code> :  <code>0</code></li>
<li><code>uint</code> :  <code>0</code></li>
<li><code>enum</code> : 枚举中的第一个元素</li>
<li><code>address</code> :  <code>0x0000000000000000000000000000000000000000</code>  (或  <code>address(0)</code> )</li>
<li><code>function</code>
<ul>
<li><code>internal</code> : 空白方程</li>
<li><code>external</code> : 空白方程</li>
</ul>
</li>
</ul>
<h2 id="引用类型初始值"><a class="anchor" href="#引用类型初始值">#</a> 引用类型初始值</h2>
<ul>
<li>映射 <code>mapping</code> : 所有元素都为其默认值的 <code>mapping</code></li>
<li>结构体 <code>struct</code> : 所有成员设为其默认值的结构体</li>
<li>数组 <code>array</code>
<ul>
<li>动态数组:  <code>[]</code></li>
<li>静态数组（定长）: 所有成员设为其默认值的静态数组</li>
</ul>
</li>
</ul>
<h2 id="delete操作符"><a class="anchor" href="#delete操作符">#</a> delete 操作符</h2>
<p><code>delete a</code>  会让变量 <code>a</code>  的值变为初始值。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//delete 操作符</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">bool</span> <span class="token keyword">public</span> _bool2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">delete</span> _bool2<span class="token punctuation">;</span> <span class="token comment">//delete 会让_bool2 变为默认值，false</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity的常数"><a class="anchor" href="#solidity的常数">#</a> solidity 的常数</h1>
<p><code>solidity</code>  中两个关键字， <code>constant</code> （常量）和 <code>immutable</code> （不变量）都可以用来表示常数，状态变量声明这个两个关键字之后，不能在合约后更改数值；并且还可以节省 <code>gas</code>  . 另外，只有<strong>数值变量</strong>可以声明 <code>constant</code>  和 <code>immutable</code> ； <code>string</code>  和 <code>bytes</code>  可以声明为 <code>constant</code> ，但不能为 <code>immutable</code> 。</p>
<h2 id="constant"><a class="anchor" href="#constant">#</a> constant</h2>
<p><code>constant</code>  变量<strong>必须在声明的时候初始化</strong>，之后<strong>再也不能改变</strong>。尝试改变的话，编译不通过。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//constant 变量必须在声明的时候初始化，之后不能改变</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">constant</span> CONSTANT_NUM <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">string</span> <span class="token keyword">constant</span> CONSTANT_STRING <span class="token operator">=</span> <span class="token string">"0xAA"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">bytes</span> <span class="token keyword">constant</span> CONSTANT_BYTES <span class="token operator">=</span> <span class="token string">"WTF"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">constant</span> CONSTANT_ADDRESS <span class="token operator">=</span> <span class="token number">0x0000000000000000000000000000000000000000</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="immutable"><a class="anchor" href="#immutable">#</a> <strong>immutable</strong></h2>
<p><code>immutable</code>  变量可以在声明时或构造函数中初始化，因此更加灵活。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//immutable 变量可以在 constructor 里初始化，之后不能改变</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">public</span> immutable IMMUTABLE_NUM <span class="token operator">=</span> <span class="token number">9999999999</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">public</span> immutable IMMUTABLE_ADDRESS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">public</span> immutable IMMUTABLE_BLOCK<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">uint256</span> <span class="token keyword">public</span> immutable IMMUTABLE_TEST<span class="token punctuation">;</span></pre></td></tr></table></figure><p>你可以使用全局变量例如 <code>address(this)</code> ， <code>block.number</code>  ，或者自定义的函数给 <code>immutable</code>  变量初始化。在下面这个例子，我们利用了 <code>test()</code>  函数给 <code>IMMUTABLE_TEST</code>  初始化为 <code>9</code> ：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 利用 constructor 初始化 immutable 变量，因此可以利用</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        IMMUTABLE_ADDRESS <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        IMMUTABLE_BLOCK <span class="token operator">=</span> block<span class="token punctuation">.</span>number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        IMMUTABLE_TEST <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token builtin">uint256</span> what <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>what<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity的控制流"><a class="anchor" href="#solidity的控制流">#</a> solidity 的控制流</h1>
<p>简单看了看，完全可以将 solidity 的控制流和 c 语言类比，因为逻辑基本上是一样的</p>
<ol>
<li><code>if-else</code></li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">ifElseTest</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _number<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>_number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2">
<li><code>for循环</code></li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">forLoopTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    sum <span class="token operator">+=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3">
<li><code>while循环</code></li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">whileTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sum <span class="token operator">+=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="4">
<li><code>do-while循环</code></li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">doWhileTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">uint</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">do</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sum <span class="token operator">+=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="5">
<li><code>三元运算符</code>  三元运算符是 <code>solidity</code>  中唯一一个接受三个操作数的运算符，规则 <code>条件? 条件为真的表达式:条件为假的表达式</code> 。 此运算符经常用作 if 语句的快捷方式。</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 三元运算符 ternary/conditional operator</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">ternaryTest</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> x<span class="token punctuation">,</span> <span class="token builtin">uint256</span> y<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// return the max of x and y</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> x <span class="token operator">>=</span> y <span class="token operator">?</span> x<span class="token punctuation">:</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>另外还有 <code>continue</code> （立即进入下一个循环）和 <code>break</code> （跳出当前循环）关键字可以使用。</p>
<h1 id="solidity的构造函数与修饰器"><a class="anchor" href="#solidity的构造函数与修饰器">#</a> solidity 的构造函数与修饰器</h1>
<h2 id="构造函数"><a class="anchor" href="#构造函数">#</a> 构造函数</h2>
<p>构造函数（ <code>constructor</code> <br>
）是一种特殊的函数，每个合约可以定义一个，并在<strong>部署合约</strong>的时候<strong>自动运行一次</strong>。它可以用来初始化合约的一些参数，例如初始化合约的 <code>owner</code>  地址：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">address</span> owner<span class="token punctuation">;</span> <span class="token comment">// 定义 owner 变量</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token comment">// 构造函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span> <span class="token comment">// 在部署合约的时候，将 owner 设置为部署者的地址</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="修饰器"><a class="anchor" href="#修饰器">#</a> 修饰器</h2>
<p>修饰器（ <code>modifier</code> ）是 <code>solidity</code>  特有的语法，类似于面向对象编程中的 <code>decorator</code> ，声明函数拥有的特性，并减少代码冗余。它就像钢铁侠的智能盔甲，穿上它的函数会带有某些特定的行为。 <code>modifier</code>  的主要使用场景是运行函数前的检查，例如地址，变量，余额等。</p>
<p>我们来定义一个叫做 onlyOwner 的 modifier：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义 modifier</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token keyword">modifier</span> onlyOwner <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检查调用者是否为 owner 地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token keyword">_</span><span class="token punctuation">;</span><span class="token comment">// 如果是的话，继续运行函数主体；否则报错并 revert 交易</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代有 <code>onlyOwner</code>  修饰符的函数只能被 <code>owner</code>  地址调用，比如下面这个例子：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">changeOwner</span><span class="token punctuation">(</span><span class="token builtin">address</span> _newOwner<span class="token punctuation">)</span> <span class="token keyword">external</span> onlyOwner<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      owner <span class="token operator">=</span> _newOwner<span class="token punctuation">;</span><span class="token comment">// 只有 owner 地址运行这个函数，并改变 owner</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们定义了一个 <code>changeOwner</code>  函数，运行他可以改变合约的 <code>owner</code> ，但是由于 <code>onlyOwner</code>  修饰符的存在，只有原先的 <code>owner</code>  可以调用，别人调用就会报错。这也是<strong>最常用</strong>的控制智能合约权限的方法。</p>
<h1 id="solidity的事件"><a class="anchor" href="#solidity的事件">#</a> solidity 的事件</h1>
<p>事件是使用<strong> EVM 日志内置功能</strong>的方便工具，在 dapp 的接口中，它可以反过来调用 Javascript 的<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclOUIlOTElRTUlOTAlQUMmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">监听</span><br>
事件的回调。</p>
<p><code>Solidity</code>  中的事件（ <code>event</code> ）是 <code>EVM</code>  上日志的抽象，它具有两个特点：</p>
<ul>
<li>响应：应用程序（ <code>[ether.js](https://learnblockchain.cn/docs/ethers.js/api-contract.html#id18)</code> ）可以通过 <code>RPC</code>  接口订阅和监听这些事件，并在前端做响应。</li>
<li>经济：事件是 <code>EVM</code>  上<strong>比较经济</strong>的存储数据的方式，每个大概消耗 2,000  <code>gas</code> ；相比之下，链上存储一个新变量至少需要 20,000  <code>gas</code> 。</li>
</ul>
<h2 id="规则"><a class="anchor" href="#规则">#</a> 规则</h2>
<p>事件的声明由 <code>event</code>  关键字开头，然后跟事件名称，括号里面写好事件需要记录的变量类型和变量名。以 <code>ERC20</code>  代币合约的 <code>Transfer</code>  事件为例：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们可以看到， <code>Transfer</code>  事件共记录了 3 个变量 <code>from</code> ， <code>to</code>  和 <code>value</code> ，分别对应代币的转账地址，接收地址和转账数量。</p>
<p>同时 <code>from</code>  和 <code>to</code>  前面带着 <code>indexed</code>  关键字，每个 <code>indexed</code>  标记的变量可以理解为检索事件的索引 “键”，在以太坊上单独作为一个 <code>topic</code>  进行存储和索引，程序可以轻松的筛选出特定转账地址和接收地址的转账事件。<strong>每个事件</strong>最多有<strong> 3 个</strong>带 <code>indexed</code>  的变量。<strong>每个  <code>indexed</code>  变量的大小为固定的 256 比特</strong>。事件的哈希以及这三个带 <code>indexed</code>  的变量在 <code>EVM</code>  日志中通常被存储为 <code>topic</code> 。其中 <code>topic[0]</code>  是此事件的 <code>keccak256</code>  哈希， <code>topic[1]</code>  到 <code>topic[3]</code>  存储了带 <code>indexed</code>  变量的 <code>keccak256</code>  哈希。</p>
<p><code>value</code>  不带  <code>indexed</code>  关键字，会存储在事件的  <code>data</code>  部分中，可以理解为事件的 “值”。 <code>data</code>  部分的变量不能被直接检索，但可以存储任意大小的数据。因此一般  <code>data</code>  部分可以用来存储复杂的数据结构，例如数组和字符串等等，因为这些数据超过了 256 比特，即使存储在事件的  <code>topic</code>  部分中，也是以哈希的方式存储。另外， <code>data</code>  部分的变量在存储上消耗的 gas 相比于  <code>topic</code>  更少。</p>
<p>我们可以在函数里释放事件。在下面的例子中，每次用 <code>_transfer()</code>  函数进行转账操作的时候，都会释放 <code>Transfer</code>  事件，并记录相应的变量。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义_transfer 函数，执行转账逻辑</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">_transfer</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">address</span> to<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token builtin">uint256</span> amount</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>        _balances<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span> <span class="token comment">// 给转账地址一些初始代币</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>        _balances<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span> <span class="token operator">-=</span>  amount<span class="token punctuation">;</span> <span class="token comment">//from 地址减去转账数量</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        _balances<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span> <span class="token comment">//to 地址加上转账数量</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// 释放事件</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity中的继承"><a class="anchor" href="#solidity中的继承">#</a> <strong>solidity 中的继承</strong></h1>
<h2 id="继承"><a class="anchor" href="#继承">#</a> 继承</h2>
<p>继承是面向对象编程很重要的组成部分，可以显著减少重复代码。如果把合约看作是对象的话， <code>solidity</code>  也是面向对象的编程，也支持继承。</p>
<h2 id="规则-2"><a class="anchor" href="#规则-2">#</a> 规则</h2>
<ul>
<li><code>virtual</code> : 父合约中的函数，<strong>如果希望子合约重写</strong>，需要加上 <code>virtual</code>  关键字。</li>
<li><code>override</code> ：子合约重写了父合约中的函数，需要加上 <code>override</code>  关键字。</li>
</ul>
<h2 id="简单继承"><a class="anchor" href="#简单继承">#</a> 简单继承</h2>
<p>我们先写一个简单的爷爷合约 <code>Yeye</code> ，里面包含 1 个 <code>Log</code>  事件和 3 个 <code>function</code> :  <code>hip()</code> ,  <code>pop()</code> ,  <code>yeye()</code> ，输出都是”Yeye”。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Yeye</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">event</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token builtin">string</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 定义 3 个 function: hip (), pop (), man ()，Log 值为 Yeye。</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">hip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Yeye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Yeye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">yeye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Yeye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们再定义一个爸爸合约 <code>Baba</code> ，让他继承 <code>Yeye</code>  合约，语法就是 <code>contract Baba is Yeye</code> ，非常直观。在 <code>Baba</code>  合约里，我们重写一下 <code>hip()</code>  和 <code>pop()</code>  这两个函数，加上 <code>override</code>  关键字，并将他们的输出改为 <code>”Baba”</code> ；并且加一个新的函数 <code>baba</code> ，输出也是 <code>”Baba”</code> 。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Baba</span> <span class="token keyword">is</span> Yeye<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 继承两个 function: hip () 和 pop ()，输出改为 Baba。</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">hip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual override<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Baba"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual override<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Baba"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">baba</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Baba"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们部署合约，可以看到 <code>Baba</code>  合约里有 4 个函数，其中 <code>hip()</code>  和 <code>pop()</code>  的输出被成功改写成 <code>”Baba”</code> ，而继承来的 <code>yeye()</code>  的输出仍然是 <code>”Yeye”</code> 。</p>
<h2 id="多重继承"><a class="anchor" href="#多重继承">#</a> 多重继承</h2>
<p><code>solidity</code>  的合约可以继承多个合约。规则：</p>
<p>继承时要按辈分最高到最低的顺序排。比如我们写一个 <code>Erzi</code>  合约，继承 <code>Yeye</code>  合约和 <code>Baba</code>  合约，那么就要写成 <code>contract Erzi is Yeye, Baba</code> ，而不能写成 <code>contract Erzi is Baba, Yeye</code> ，不然就会报错。 如果某一个函数在多个继承的合约里都存在，比如例子中的 <code>hip()</code>  和 <code>pop()</code> ，在子合约里必须重写，不然会报错。 重写在多个父合约中都重名的函数时， <code>override</code>  关键字后面要加上所有父合约名字，例如 <code>override(Yeye, Baba)</code> 。 例子：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Erzi</span> <span class="token keyword">is</span> Yeye<span class="token punctuation">,</span> Baba<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 继承两个 function: hip () 和 pop ()，输出值为 Erzi。</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">hip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token function">override</span><span class="token punctuation">(</span>Yeye<span class="token punctuation">,</span> Baba<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Erzi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token function">override</span><span class="token punctuation">(</span>Yeye<span class="token punctuation">,</span> Baba<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Erzi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们可以看到， <code>Erzi</code>  合约里面重写了 <code>hip()</code>  和 <code>pop()</code>  两个函数，将输出改为 <code>”Erzi”</code> ，并且还分别从 <code>Yeye</code>  和 <code>Baba</code>  合约继承了 <code>yeye()</code>  和 <code>baba()</code>  两个函数。</p>
<h2 id="修饰器的继承"><a class="anchor" href="#修饰器的继承">#</a> 修饰器的继承</h2>
<p><code>Solidity</code>  中的修饰器（ <code>Modifier</code> ）同样可以继承，用法与函数继承类似，在相应的地方加 <code>virtual</code>  和 <code>override</code>  关键字即可。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Base1</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">modifier</span> <span class="token function">exactDividedBy2And3</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _a<span class="token punctuation">)</span> virtual <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>_a <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> _a <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">_</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Identifier</span> <span class="token keyword">is</span> Base1 <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 计算一个数分别被 2 除和被 3 除的值，但是传入的参数必须是 2 和 3 的倍数</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">getExactDividedBy2And3</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _dividend<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">exactDividedBy2And3</span><span class="token punctuation">(</span>_dividend<span class="token punctuation">)</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">getExactDividedBy2And3WithoutModifier</span><span class="token punctuation">(</span>_dividend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 计算一个数分别被 2 除和被 3 除的值</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">getExactDividedBy2And3WithoutModifier</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _dividend<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token builtin">uint</span> div2 <span class="token operator">=</span> _dividend <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token builtin">uint</span> div3 <span class="token operator">=</span> _dividend <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>div2<span class="token punctuation">,</span> div3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>Identifier</code>  合约可以直接在代码中使用父合约中的 <code>exactDividedBy2And3</code>  修饰器，也可以利用 <code>override</code>  关键字重写修饰器：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">modifier</span> <span class="token function">exactDividedBy2And3</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _a<span class="token punctuation">)</span> override <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">_</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>_a <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> _a <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="构造函数的继承"><a class="anchor" href="#构造函数的继承">#</a> 构造函数的继承</h2>
<p>子合约有两种方法继承父合约的构造函数。举个简单的例子，父合约 <code>A</code>  里面有一个状态变量 <code>a</code> ，并由构造函数的参数来确定：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 构造函数的继承</span></pre></td></tr><tr><td data-num="2"></td><td><pre>abstract <span class="token keyword">contract</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        a <span class="token operator">=</span> _a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li>在继承时声明父构造函数的参数，例如： <code>contract B is A(1)</code></li>
<li>在子合约的构造函数中声明构造函数的参数，例如：</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">C</span> <span class="token keyword">is</span> A <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _c<span class="token punctuation">)</span> <span class="token function">A</span><span class="token punctuation">(</span>_c <span class="token operator">*</span> _c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="调用父合约的函数"><a class="anchor" href="#调用父合约的函数">#</a> 调用父合约的函数</h2>
<p>子合约有两种方式调用父合约的函数，直接调用和利用 <code>super</code>  关键字。</p>
<ol>
<li>直接调用：子合约可以直接用 <code>父合约名.函数名()</code>  的方式来调用父合约函数，例如 <code>Yeye.pop()</code> 。</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">callParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        Yeye<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol>
<li><code>super</code>  关键字：子合约可以利用 <code>super.函数名()</code>  来调用最近的父合约函数。 <code>solidity</code>  继承关系按声明时从右到左的顺序是： <code>contract Erzi is Yeye, Baba</code> ，那么 <code>Baba</code>  是最近的父合约， <code>super.pop()</code>  将调用 <code>Baba.pop()</code>  而不是 <code>Yeye.pop()</code> ：</li>
</ol>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">callParentSuper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token comment">// 将调用最近的父合约函数，Baba.pop ()</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        super<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="solidity中的异常"><a class="anchor" href="#solidity中的异常">#</a> solidity 中的异常</h1>
<p><code>solidity</code>  三种抛出异常的方法： <code>error</code> ， <code>require</code>  和 <code>assert</code></p>
<h2 id="条件检查"><a class="anchor" href="#条件检查">#</a> 条件检查</h2>
<h3 id="error"><a class="anchor" href="#error">#</a> Error</h3>
<p><code>error</code>  是 <code>solidity 0.8版本</code> 新加的内容，方便且高效（<strong>省 <code>gas</code> </strong>）地向用户解释操作失败的原因。人们可以在 <code>contract</code>  之外定义异常。下面，我们定义一个 <code>TransferNotOwner</code>  异常，当用户不是代币 <code>owner</code>  的时候尝试转账，会抛出错误：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Errors 用来定义失败</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">// 以下称为 natspec 注释，可以通过三个斜杠来识别。</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// 当用户被要求确认交易时或错误发生时将显示。</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/// you are not the owner</span></pre></td></tr><tr><td data-num="7"></td><td><pre>error <span class="token function">TransferNotOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 自定义 error</span></pre></td></tr></table></figure><p>在执行当中， <code>error</code> <strong> 必须</strong>搭配 <code>revert</code> （回退）命令使用。</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">transferOwner1</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">address</span> newOwner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token keyword">revert</span> <span class="token function">TransferNotOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> newOwner<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们定义了一个 <code>transferOwner1()</code>  函数，它会检查代币的 <code>owner</code>  是不是发起人，如果不是，就会抛出 <code>TransferNotOwner</code>  异常；如果是的话，就会转账。</p>
<h3 id="require"><a class="anchor" href="#require">#</a> Require</h3>
<p><code>require</code>  命令是 <code>solidity 0.8版本</code> 之前抛出异常的常用方法，目前很多主流合约仍然还在使用它。它很好用，唯一的缺点就是 <code>gas</code>  随着描述异常的字符串长度增加，比 <code>error</code>  命令要高。使用方法： <code>require(检查条件，&quot;异常的描述&quot;)</code> ，当检查条件不成立的时候，就会抛出异常。</p>
<p>我们用 <code>require</code>  命令重写一下上面的 <code>transferOwner</code>  函数：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">transferOwner2</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">address</span> newOwner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">"Transfer Not Owner"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> newOwner<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="assert"><a class="anchor" href="#assert">#</a> Assert</h3>
<p><code>assert</code>  命令一般用于程序员写程序 <code>debug</code> ，因为它不能解释抛出异常的原因（比 <code>require</code>  少个字符串）。它的用法很简单， <code>assert(检查条件）</code> ，当检查条件不成立的时候，就会抛出异常。</p>
<p>我们用 <code>assert</code>  命令重写一下上面的 <code>transferOwner</code>  函数：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">transferOwner3</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">address</span> newOwner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">assert</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> newOwner<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注</strong>：同样作为判断一个条件是否满足的函数，require 会退回剩下的 gas，而 assert 会消耗所有的 gas。</p>
<h2 id="触发异常"><a class="anchor" href="#触发异常">#</a> 触发异常</h2>
<p>提供了  <code>revert</code> ,  <code>throw</code>  来触发异常：</p>
<ul>
<li><code>throw</code> ：关键字抛出异常（从 0.4.13 版本，throw 关键字已被弃用，将来会被淘汰。）回滚所有状态改变，返回” 无效操作代码错误”，而且消耗掉剩下的 gas</li>
<li><code>revert</code> ：函数可以用来标记错误并回退当前调用，允许返回一个数值，将剩余 gas 返还调用者</li>
</ul>
<p>传统处理异常的方式  <code>if...throw</code>  模式<br>
即</p>
<p>等价于：</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">!=</span> owner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">-</span> <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">!=</span> owner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// 如果不等则异常</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> <span class="token keyword">assert</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 校验是否等于</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span> <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="运行第一个solidity代码hello-world"><a class="anchor" href="#运行第一个solidity代码hello-world">#</a> 运行第一个 solidity 代码，hello world</h1>
<p>这里我选择在网页运行运行 solidity</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//SPDX-License-Identifier:GPL-3.0</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.7</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">HelloWorldContract</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">external</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="/solidity-learning/Untitled%205.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<p><img data-src="/solidity-learning/Untitled%206.png" alt="Untitled" style="aspect-ratio:1920 / 991;"></p>
<h1 id="阅读一些智能合约"><a class="anchor" href="#阅读一些智能合约">#</a> 阅读一些智能合约</h1>
<hr>
<h2 id="example1csawdonation"><a class="anchor" href="#example1csawdonation">#</a> example1.CSAWDonation</h2>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> *Submitted for verification at Etherscan.io on 2022-09-09</pre></td></tr><tr><td data-num="3"></td><td><pre>*/</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// SPDX-License-Identifier: MIT</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">>=</span><span class="token version number">0.8.7</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">CSAWDonation</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token keyword">public</span> balances<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">public</span> doneDonating<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">event</span> <span class="token function">sendToAuthor</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">newAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">>=</span> <span class="token number">0.0001</span> ether<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>        balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        doneDonating<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">donateOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>doneDonating<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>call<span class="token punctuation">&#123;</span>value<span class="token punctuation">:</span> <span class="token number">0.0001</span> ether<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            doneDonating<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> donatorBalance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">return</span> balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _token<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">sendToAuthor</span><span class="token punctuation">(</span>_token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//sends the token </span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这个合约是有重入漏洞的，至于什么是重入漏洞，可以参考这篇文章</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3JlYWQvY3YxNzgyMDc1Mw==">智能合约安全–重入漏洞</span></p>
<p>抛开这点来说，这个合约对于像我这种 solidity 初学者来说，还是很有参考意义的.</p>
<h2 id="example2插入排序"><a class="anchor" href="#example2插入排序">#</a> example2. 插入排序</h2>
<p>这里有一个错误的插入排序代码，运行后就会报错</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 插入排序 错误版</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">insertionSortWrong</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> a<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        </pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token builtin">uint</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token builtin">uint</span> j<span class="token operator">=</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>j <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>temp <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                a<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                j<span class="token operator">--</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            a<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>为什么呢？因为变量  <code>j</code>  的类型是  <code>uint</code>  , 是不能取到 **-1<strong> 的，但是在上述代码中， <code>j</code>  可能会取到</strong> - 1**, 所以要规避掉这种错误，让  <code>j</code>  取不到 **-1**.</p>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 插入排序 正确版</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> a<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">// note that uint can not take negative value</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token builtin">uint</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token builtin">uint</span> j<span class="token operator">=</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>j <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>temp <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                j<span class="token operator">--</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="example3投票合约"><a class="anchor" href="#example3投票合约">#</a> example3. 投票合约</h2>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">>=</span><span class="token version number">0.7.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/// @title 委托投票</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">Ballot</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 这里声明了一个新的复合类型用于稍后的变量</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 它用来表示一个选民</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Voter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token builtin">uint</span> weight<span class="token punctuation">;</span> <span class="token comment">// 计票的权重</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token builtin">bool</span> voted<span class="token punctuation">;</span>  <span class="token comment">// 若为真，代表该人已投票</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token builtin">address</span> delegate<span class="token punctuation">;</span> <span class="token comment">// 被委托人</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token builtin">uint</span> vote<span class="token punctuation">;</span>   <span class="token comment">// 投票提案的索引</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 提案的类型</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Proposal</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token builtin">bytes32</span> name<span class="token punctuation">;</span>   <span class="token comment">// 简称（最长 32 个字节）</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token builtin">uint</span> voteCount<span class="token punctuation">;</span> <span class="token comment">// 得票数</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">public</span> chairperson<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 这声明了一个状态变量，为每个可能的地址存储一个 `Voter`。</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> Voter<span class="token punctuation">)</span> <span class="token keyword">public</span> voters<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 一个 `Proposal` 结构类型的动态数组</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    Proposal<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> proposals<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">/// 为 `proposalNames` 中的每个提案，创建一个新的（投票）表决</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> proposalNames<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        chairperson <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        voters<span class="token punctuation">[</span>chairperson<span class="token punctuation">]</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token comment">// 对于提供的每个提案名称，</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token comment">// 创建一个新的 Proposal 对象并把它添加到数组的末尾。</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> proposalNames<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token comment">// `Proposal (&#123;...&#125;)` 创建一个临时 Proposal 对象，</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token comment">// `proposals.push (...)` 将其添加到 `proposals` 的末尾</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            proposals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">Proposal</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                name<span class="token punctuation">:</span> proposalNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                voteCount<span class="token punctuation">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">// 授权 `voter` 对这个（投票）表决进行投票</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token comment">// 只有 `chairperson` 可以调用该函数。</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">giveRightToVote</span><span class="token punctuation">(</span><span class="token builtin">address</span> voter<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token comment">// 若 `require` 的第一个参数的计算结果为 `false`，</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token comment">// 则终止执行，撤销所有对状态和以太币余额的改动。</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment">// 在旧版的 EVM 中这曾经会消耗所有 gas，但现在不会了。</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token comment">// 使用 require 来检查函数是否被正确地调用，是一个好习惯。</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token comment">// 你也可以在 require 的第二个参数中提供一个对错误情况的解释。</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> chairperson<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token string">"Only chairperson can give right to vote."</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token operator">!</span>voters<span class="token punctuation">[</span>voter<span class="token punctuation">]</span><span class="token punctuation">.</span>voted<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token string">"The voter already voted."</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>voters<span class="token punctuation">[</span>voter<span class="token punctuation">]</span><span class="token punctuation">.</span>weight <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        voters<span class="token punctuation">[</span>voter<span class="token punctuation">]</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token comment">/// 把你的投票委托到投票者 `to`。</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">delegate</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token comment">// 传引用</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        Voter <span class="token keyword">storage</span> sender <span class="token operator">=</span> voters<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>sender<span class="token punctuation">.</span>weight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"You have no right to vote"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>sender<span class="token punctuation">.</span>voted<span class="token punctuation">,</span> <span class="token string">"You already voted."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>to <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">"Self-delegation is disallowed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token comment">// 委托是可以传递的，只要被委托者 `to` 也设置了委托。</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token comment">// 一般来说，这种循环委托是危险的。因为，如果传递的链条太长，</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token comment">// 则可能需消耗的 gas 要多于区块中剩余的（大于区块设置的 gasLimit），</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token comment">// 这种情况下，委托不会被执行。</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token comment">// 而在另一些情况下，如果形成闭环，则会让合约完全卡住。</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>voters<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span>delegate <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            to <span class="token operator">=</span> voters<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre>            <span class="token comment">// 不允许闭环委托</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token keyword">require</span><span class="token punctuation">(</span>to <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">"Found loop in delegation."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token comment">// `sender` 是一个引用，相当于对 `voters [msg.sender].voted` 进行修改</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        Voter <span class="token keyword">storage</span> delegate_ <span class="token operator">=</span> voters<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token comment">// Voters cannot delegate to accounts that cannot vote.</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span>delegate_<span class="token punctuation">.</span>weight <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token comment">// Since `sender` is a reference, this</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token comment">// modifies `voters[msg.sender]`.</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        sender<span class="token punctuation">.</span>voted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>        sender<span class="token punctuation">.</span>delegate <span class="token operator">=</span> to<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate_<span class="token punctuation">.</span>voted<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token comment">// 若被委托者已经投过票了，直接增加得票数</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            proposals<span class="token punctuation">[</span>delegate_<span class="token punctuation">.</span>vote<span class="token punctuation">]</span><span class="token punctuation">.</span>voteCount <span class="token operator">+=</span> sender<span class="token punctuation">.</span>weight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token comment">// 若被委托者还没投票，增加委托者的权重</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            delegate_<span class="token punctuation">.</span>weight <span class="token operator">+=</span> sender<span class="token punctuation">.</span>weight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token comment">/// 把你的票 (包括委托给你的票)，</span></pre></td></tr><tr><td data-num="107"></td><td><pre>    <span class="token comment">/// 投给提案 `proposals [proposal].name`.</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">vote</span><span class="token punctuation">(</span><span class="token builtin">uint</span> proposal<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        Voter <span class="token keyword">storage</span> sender <span class="token operator">=</span> voters<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>sender<span class="token punctuation">.</span>voted<span class="token punctuation">,</span> <span class="token string">"Already voted."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        sender<span class="token punctuation">.</span>voted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        sender<span class="token punctuation">.</span>vote <span class="token operator">=</span> proposal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token comment">// 如果 `proposal` 超过了数组的范围，则会自动抛出异常，并恢复所有的改动</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        proposals<span class="token punctuation">[</span>proposal<span class="token punctuation">]</span><span class="token punctuation">.</span>voteCount <span class="token operator">+=</span> sender<span class="token punctuation">.</span>weight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre></pre></td></tr><tr><td data-num="118"></td><td><pre>    <span class="token comment">/// @dev 结合之前所有的投票，计算出最终胜出的提案</span></pre></td></tr><tr><td data-num="119"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">winningProposal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span></pre></td></tr><tr><td data-num="120"></td><td><pre>            <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> winningProposal_<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>        <span class="token builtin">uint</span> winningVoteCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> proposals<span class="token punctuation">.</span>length<span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>proposals<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>voteCount <span class="token operator">></span> winningVoteCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>                winningVoteCount <span class="token operator">=</span> proposals<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>voteCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>                winningProposal_ <span class="token operator">=</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="130"></td><td><pre></pre></td></tr><tr><td data-num="131"></td><td><pre>    <span class="token comment">// 调用 winningProposal () 函数以获取提案数组中获胜者的索引，并以此返回获胜者的名称</span></pre></td></tr><tr><td data-num="132"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">winnerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span></pre></td></tr><tr><td data-num="133"></td><td><pre>            <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span> winnerName_<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        winnerName_ <span class="token operator">=</span> proposals<span class="token punctuation">[</span><span class="token function">winningProposal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="example4简单的公开拍卖"><a class="anchor" href="#example4简单的公开拍卖">#</a> example4. 简单的公开拍卖</h2>
<figure class="highlight solidity"><figcaption data-lang="Solidity (Ethereum)"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">contract</span> <span class="token class-name">SimpleAuction</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 拍卖的参数。</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">payable</span> <span class="token keyword">public</span> beneficiary<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 时间是 unix 的绝对时间戳（自 1970-01-01 以来的秒数）</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 或以秒为单位的时间段。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> auctionEnd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 拍卖的当前状态</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token builtin">address</span> <span class="token keyword">public</span> highestBidder<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token builtin">uint</span> <span class="token keyword">public</span> highestBid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 可以取回的之前的出价</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> pendingReturns<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// 拍卖结束后设为 true，将禁止所有的变更</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token builtin">bool</span> ended<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 变更触发的事件</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">event</span> <span class="token function">HighestBidIncreased</span><span class="token punctuation">(</span><span class="token builtin">address</span> bidder<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">event</span> <span class="token function">AuctionEnded</span><span class="token punctuation">(</span><span class="token builtin">address</span> winner<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">// Errors 用来定义失败</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// 以下称为 natspec 注释，可以通过三个斜杠来识别。</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">// 当用户被要求确认交易时或错误发生时将显示。</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">/// The auction has already ended.</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    error <span class="token function">AuctionAlreadyEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment">/// There is already a higher or equal bid.</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    error <span class="token function">BidNotHighEnough</span><span class="token punctuation">(</span><span class="token builtin">uint</span> highestBid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">/// The auction has not ended yet.</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    error <span class="token function">AuctionNotYetEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">/// The function auctionEnd has already been called.</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    error <span class="token function">AuctionEndAlreadyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">/// 以受益者地址 `beneficiaryAddress` 的名义，</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token comment">/// 创建一个简单的拍卖，拍卖时间为 `biddingTime` 秒。</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">constructor</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token builtin">uint</span> biddingTime<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token builtin">address</span> <span class="token keyword">payable</span> beneficiaryAddress</pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        beneficiary <span class="token operator">=</span> beneficiaryAddress<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        auctionEnd <span class="token operator">=</span> block<span class="token punctuation">.</span>timestamp <span class="token operator">+</span> biddingTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token comment">/// 对拍卖进行出价，具体的出价随交易一起发送。</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token comment">/// 如果没有在拍卖中胜出，则返还出价。</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token comment">// 参数不是必要的。因为所有的信息已经包含在了交易中。</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token comment">// 对于能接收以太币的函数，关键字 payable 是必须的。</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token comment">// 如果拍卖已结束，撤销函数的调用。</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>timestamp <span class="token operator">></span> auctionEndTime<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token keyword">revert</span> <span class="token function">AuctionAlreadyEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token comment">// 如果出价不够高，返还你的钱</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&lt;=</span> highestBid<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token keyword">revert</span> <span class="token function">BidNotHighEnough</span><span class="token punctuation">(</span>highestBid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>highestBid <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token comment">// 返还出价时，简单地直接调用 highestBidder.send (highestBid) 函数，</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token comment">// 是有安全风险的，因为它有可能执行一个非信任合约。</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token comment">// 更为安全的做法是让接收方自己提取金钱。</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            pendingReturns<span class="token punctuation">[</span>highestBidder<span class="token punctuation">]</span> <span class="token operator">+=</span> highestBid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        highestBidder <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        highestBid <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">HighestBidIncreased</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token comment">/// 取回出价（当该出价已被超越）</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token builtin">uint</span> amount <span class="token operator">=</span> pendingReturns<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>amount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            <span class="token comment">// 这里很重要，首先要设零值。</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token comment">// 因为，作为接收调用的一部分，</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token comment">// 接收者可以在 `send` 返回之前，重新调用该函数。</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            pendingReturns<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token comment">// msg.sender is not of type `address payable` and must be</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token comment">// explicitly converted using `payable(msg.sender)` in order</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token comment">// use the member function `send()`.</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                <span class="token comment">// 这里不需抛出异常，只需重置未付款</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                pendingReturns<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token comment">/// 结束拍卖，并把最高的出价发送给受益人</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">auctionEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token comment">// 对于可与其他合约交互的函数（意味着它会调用其他函数或发送以太币），</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        <span class="token comment">// 一个好的指导方针是将其结构分为三个阶段：</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token comment">// 1. 检查条件</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token comment">// 2. 执行动作 (可能会改变条件)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        <span class="token comment">// 3. 与其他合约交互</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token comment">// 如果这些阶段相混合，其他的合约可能会回调当前合约并修改状态，</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token comment">// 或者导致某些效果（比如支付以太币）多次生效。</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token comment">// 如果合约内调用的函数包含了与外部合约的交互，</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token comment">// 则它也会被认为是与外部合约有交互的。</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token comment">// 1. 条件</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>timestamp <span class="token operator">&lt;</span> auctionEndTime<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>            <span class="token keyword">revert</span> <span class="token function">AuctionNotYetEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ended<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token keyword">revert</span> <span class="token function">AuctionEndAlreadyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre>        <span class="token comment">// 2. 生效</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        ended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        <span class="token keyword">emit</span> <span class="token function">AuctionEnded</span><span class="token punctuation">(</span>highestBidder<span class="token punctuation">,</span> highestBid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre></pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token comment">// 3. 交互</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        beneficiary<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>highestBid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h1>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9sZWFybmJsb2NrY2hhaW4uY24vZG9jcy9zb2xpZGl0eS8=">Solidity 中文文档 - Solidity 中文文档 - 登链社区</span></li>
</ul>

      <div class="tags">
          <a href="/tags/solidity/" rel="tag"><i class="ic i-tag"></i> solidity</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2025-04-09 02:55:11" itemprop="dateModified" datetime="2025-04-09T02:55:11+08:00">2025-04-09</time>
  </span>
  <span id="solidity-learning/" class="item leancloud_visitors" data-flag-title="solidity语言学习" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>oacia <i class="ic i-at"><em>@</em></i>oaciaのBbBlog~
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://oacia.dev/solidity-learning/" title="solidity语言学习">https://oacia.dev/solidity-learning/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/%E7%AC%AC%E4%B8%80%E4%B8%AAblog%E7%BA%AA%E5%BF%B5!/" itemprop="url" rel="prev" data-background-image="&#x2F;picture&#x2F;228579.webp" title="第一个blog纪念!">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>第一个blog纪念!</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2022%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9_1024%E7%A8%8B%E5%BA%8F%E5%91%98%E8%8A%82_T4_%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AF%A6%E8%A7%A3/" itemprop="url" rel="next" data-background-image="&#x2F;picture&#x2F;803014.webp" title="2022哔哩哔哩 1024程序员节 T4 区块链详解">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>2022哔哩哔哩 1024程序员节 T4 区块链详解</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text"> 环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87remix%E5%9C%A8%E7%BD%91%E9%A1%B5%E6%89%A7%E8%A1%8Csolidity%E6%8E%A8%E8%8D%90%E6%96%B9%E4%BE%BF%E5%BF%AB%E6%8D%B7"><span class="toc-text"> 通过 Remix 在网页执行 solidity (推荐，方便快捷)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87visual-code%E5%AE%89%E8%A3%85solidity"><span class="toc-text"> 通过 visual code 安装 solidity</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-text"> solidity 的数值类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text"> solidity 的函数类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA"><span class="toc-text"> solidity 的函数输出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E5%8F%98%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B"><span class="toc-text"> solidity 变量的数据存储类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B5%8B%E5%80%BC%E8%A7%84%E5%88%99"><span class="toc-text"> 数据位置和赋值规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E7%A7%8D%E8%A7%84%E5%88%99%E7%9A%84%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text"> 四种规则的测试代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E7%94%A8%E4%B8%80%E5%BC%A0%E5%85%B3%E7%B3%BB%E5%9B%BE%E6%9D%A5%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%E8%BF%99%E5%9B%9B%E7%A7%8D%E8%A7%84%E5%88%99"><span class="toc-text"> 这里用一张关系图来总结一下这四种规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 变量的作用域</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-text"> solidity 的引用类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-array"><span class="toc-text"> 数组 array</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-text"> 创建数组的规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%88%90%E5%91%98"><span class="toc-text"> 数组成员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93-struct"><span class="toc-text"> 结构体 struct</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E4%B8%AD%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8Bmapping"><span class="toc-text"> solidity 中的哈希表：映射类型 (mapping)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84mapping"><span class="toc-text"> 映射 mapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-text"> 映射的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text"> 映射的原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="toc-text"> 变量的初始值</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="toc-text"> 值类型初始值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="toc-text"> 引用类型初始值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text"> delete 操作符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E5%B8%B8%E6%95%B0"><span class="toc-text"> solidity 的常数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#constant"><span class="toc-text"> constant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#immutable"><span class="toc-text"> immutable</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-text"> solidity 的控制流</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BF%AE%E9%A5%B0%E5%99%A8"><span class="toc-text"> solidity 的构造函数与修饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text"> 构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E5%99%A8"><span class="toc-text"> 修饰器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E7%9A%84%E4%BA%8B%E4%BB%B6"><span class="toc-text"> solidity 的事件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E5%88%99"><span class="toc-text"> 规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E4%B8%AD%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-text"> solidity 中的继承</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-text"> 继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E5%88%99-2"><span class="toc-text"> 规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%BB%A7%E6%89%BF"><span class="toc-text"> 简单继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text"> 多重继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E5%99%A8%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-text"> 修饰器的继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-text"> 构造函数的继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%88%B6%E5%90%88%E7%BA%A6%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-text"> 调用父合约的函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solidity%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-text"> solidity 中的异常</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%A3%80%E6%9F%A5"><span class="toc-text"> 条件检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#error"><span class="toc-text"> Error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require"><span class="toc-text"> Require</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#assert"><span class="toc-text"> Assert</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%BC%82%E5%B8%B8"><span class="toc-text"> 触发异常</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%AC%AC%E4%B8%80%E4%B8%AAsolidity%E4%BB%A3%E7%A0%81hello-world"><span class="toc-text"> 运行第一个 solidity 代码，hello world</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%85%E8%AF%BB%E4%B8%80%E4%BA%9B%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-text"> 阅读一些智能合约</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#example1csawdonation"><span class="toc-text"> example1.CSAWDonation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#example2%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F"><span class="toc-text"> example2. 插入排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#example3%E6%8A%95%E7%A5%A8%E5%90%88%E7%BA%A6"><span class="toc-text"> example3. 投票合约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#example4%E7%AE%80%E5%8D%95%E7%9A%84%E5%85%AC%E5%BC%80%E6%8B%8D%E5%8D%96"><span class="toc-text"> example4. 简单的公开拍卖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text"> 参考资料</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="oacia"
      data-src="/images/avatar.jpg">
  
  <svg class="logo-overview" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 540.19 380.99">
    <g id="clips" fill= #00a99d; stroke="none">
      <clipPath id="o">
        <path d="M93.57,284c8,0,14.91-1,20.75-3,5.83-2,10.41-3.66,13.75-5,4.66-1.66,6.16-.75,4.5,2.75-1.67,3.5-4.67,6.42-9,8.75-2.34,1.34-6.09,2.84-11.25,4.5-5.17,1.67-11.09,2.5-17.75,2.5-.34,8.67-3.34,16.84-9,24.5-5.67,7.67-13.34,13.34-23,17-6,2.34-12.17,3.59-18.5,3.75-6.34,.17-12.17-.66-17.5-2.5-5.34-1.83-10.09-4.66-14.25-8.5-4.17-3.83-7.25-8.41-9.25-13.75-2-5.33-2.83-11-2.5-17s1.83-11.83,4.5-17.5c2.66-5.66,6.33-10.75,11-15.25,4.66-4.5,10.16-7.75,16.5-9.75,5.66-1.66,11.41-1.66,17.25,0,5.83,1.67,10.08,4.34,12.75,8,1.66,2.67,2.5,5.67,2.5,9,3-2,6.33-3,10-3h1c3.33,0,6.5,.84,9.5,2.5,3,1.67,5.33,4.5,7,8.5l1,3.5Zm-34,39.5c5.66-.66,10.33-3.83,14-9.5,3.66-5.66,5.33-12.16,5-19.5-4.67,.34-9.09-.41-13.25-2.25-4.17-1.83-6.42-4.58-6.75-8.25-.67-3,0-5.5,2-7.5-.67-2.66-2.75-5-6.25-7s-7.09-2.16-10.75-.5c-4.67,2-8.25,5.84-10.75,11.5-2.5,5.67-3.09,11.84-1.75,18.5,1.33,8,4.75,14.34,10.25,19,5.5,4.67,11.58,6.5,18.25,5.5Z"/>
      </clipPath>
      <clipPath id="a1">
        <path d="M176.06,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      <clipPath id="c">
        <path d="M250.06,280.5c4.66-7.66,12-13.16,22-16.5,10-3.33,19.83-3.66,29.5-1,7.66,2.34,13.5,5.67,17.5,10,4,4.34,5.83,8.5,5.5,12.5-.34,4.67-2.25,8.59-5.75,11.75-3.5,3.17-7.09,5.34-10.75,6.5-3.67,1.17-6.84,1.25-9.5,.25-2.67-1-3.34-3.16-2-6.5,2.66-8,2.75-14.58,.25-19.75-2.5-5.16-5.92-6.41-10.25-3.75-2.67,1.67-5,4.09-7,7.25-2,3.17-3.5,6.75-4.5,10.75s-1.42,8.09-1.25,12.25c.16,4.17,.75,7.92,1.75,11.25,1.33,4,3.66,7.42,7,10.25,3.33,2.84,7.16,4.67,11.5,5.5,4.33,.84,8.91,.67,13.75-.5,4.83-1.16,9.25-3.75,13.25-7.75,7.33-6.66,12.33-14.33,15-23,.33-1.66,1.16-2.91,2.5-3.75,1.33-.83,2.5-1.08,3.5-.75,1,.34,1.83,1.09,2.5,2.25,.66,1.17,.66,2.92,0,5.25-2.34,9.34-6.34,17-12,23-4.67,5.67-10.5,10.42-17.5,14.25-7,3.84-14.25,6.09-21.75,6.75-7.5,.67-14.84-.33-22-3-7.17-2.66-13.25-7.5-18.25-14.5-6-8.66-8.75-17.66-8.25-27,.5-9.33,2.25-16.66,5.25-22Z"/>
      </clipPath>
      <clipPath id="i_b">
        <path d="M393.06,330c-2.34,2.67-5.17,5.09-8.5,7.25-3.34,2.17-7.09,3.59-11.25,4.25-4.17,.67-8.59,.67-13.25,0-4.67-.66-9.17-2.33-13.5-5-4.67-2.66-7.67-7.58-9-14.75-1.34-7.16-1.83-14.66-1.5-22.5,.33-7.83,1.33-14.91,3-21.25,1.66-6.33,3.33-10.16,5-11.5,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,3.59,1.25,6.75-.17,3.17-.5,6.92-1,11.25-.5,4.34-1.09,8.92-1.75,13.75-.67,4.84-.67,9.42,0,13.75,.33,3.67,1.33,6.42,3,8.25,1.66,1.84,3.5,2.84,5.5,3,2,.17,4-.25,6-1.25s3.83-2.33,5.5-4c3-3.66,5.66-7.66,8-12,2.33-4.33,4.16-8.16,5.5-11.5,1-3.66,2.91-5.25,5.75-4.75,2.83,.5,3.75,3.09,2.75,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.34,8.59-10,14.25Z"/>
      </clipPath>
      <clipPath id="a2">
        <path d="M461.56,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      
    </g>
    <g
      id="strokes"
      fill="none"
      stroke=#96d7f5
      stroke-linecap="round"
      stroke-linejoin="round"
    >
    <path
    clip-path="url(#o)"
    class="oPath path"
    d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
    stroke-width="32.5"
    ></path>
    <path
      clip-path="url(#a1)"
      class="a1Path path"
      d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
      stroke-width="59"
    ></path>
    <path
      clip-path="url(#c)"
      class="cPath path"
      d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
      stroke-width="110"
    ></path>
    <path
      clip-path="url(#i_b)"
      class="i_bPath path"
      d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
      stroke-width="33"
    ></path>
    <path
      clip-path="url(#a2)"
      class="a2Path path"
      d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
      stroke-width="70"
    ></path>
    </g>
    <g
      id="strokes2"
      fill="none"
      stroke=#ff97b8
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path
        clip-path="url(#o)"
        class="oPath path"
        d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
        stroke-width="32.5"
      ></path>
      <path
        clip-path="url(#a1)"
        class="a1Path path"
        d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
        stroke-width="59"
      ></path>
      <path
        clip-path="url(#c)"
        class="cPath path"
        d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
        stroke-width="110"
      ></path>
      <path
        clip-path="url(#i_b)"
        class="i_bPath path"
        d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
        stroke-width="33"
      ></path>
      <path
        clip-path="url(#a2)"
        class="a2Path path"
        d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
        stroke-width="70"
      ></path>
    </g>
    <g class="dot-group">
      <path
        id="dot"
        fill=#ff97b8
        d="M362.58,182.21c4.66-.33,9.66,1.17,15,4.5,5.33,3.34,7.66,7.5,7,12.5-.67,2.34-1.92,4.92-3.75,7.75-1.84,2.84-4,5.5-6.5,8s-4.84,4.75-7,6.75c-2.17,2-3.75,3.17-4.75,3.5-2.67,1.67-5.34,2.25-8,1.75-2.67-.5-5-1.5-7-3s-3.59-3.33-4.75-5.5c-1.17-2.16-1.92-4.25-2.25-6.25-.34-2,.16-4.66,1.5-8,1.33-3.33,3.08-6.58,5.25-9.75,2.16-3.16,4.58-6,7.25-8.5,2.66-2.5,5.33-3.75,8-3.75Z"
      ></path>
    </g>
  </svg>
  <div class="description" itemprop="description">月遇从云 花遇和风</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">53</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">46</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29hY2lh" title="https:&#x2F;&#x2F;github.com&#x2F;oacia"><i class="ic i-github"></i></span>
      <a target="_blank" rel="noopener" href="https://twitter.com/oacia86" title="https:&#x2F;&#x2F;twitter.com&#x2F;oacia86" class="item twitter"><i class="ic i-twitter"></i></a>
      <span class="exturl item paper-plane" data-url="aHR0cHM6Ly90Lm1lL29hY2lh" title="https:&#x2F;&#x2F;t.me&#x2F;oacia"><i class="ic i-paper-plane"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOm9hY2lhODZAZ21haWwuY29t" title="mailto:oacia86@gmail.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about-oacia/" rel="section"><i class="ic i-user"></i>关于oacia</a>
  </li>

    
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-feather"></i>文章</a>
  </li>

    
  <li class="item">
    <a href="/TODOlist/" rel="section"><i class="ic i-clock"></i>要做的事</a>
  </li>

    
  <li class="item">
    <a href="/website_maintenance/" rel="section"><i class="ic i-calendar"></i>更新日志</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>小伙伴</a>
  </li>

    
  <li class="item">
    <a href="/music/" rel="section"><i class="ic i-music"></i>听会儿歌吧</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/%E7%AC%AC%E4%B8%80%E4%B8%AAblog%E7%BA%AA%E5%BF%B5!/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2022%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9_1024%E7%A8%8B%E5%BA%8F%E5%91%98%E8%8A%82_T4_%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AF%A6%E8%A7%A3/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2022 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">oacia @ oacia</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">968k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">14:40</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>



<script data-config type="text/javascript">
  var LOCAL = {
    path: 'solidity-learning/',
    favicon: {
      show: "柚鳥ナツ",
      hide: "甘い幸せ"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>
<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>


<script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>
<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
