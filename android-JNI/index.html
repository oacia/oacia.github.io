



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="qQVmgWozVe7BXoA15J3gAZpEA5dK168admH4U3W6PAk">
  <meta name="msvalidate.01" content="4902E39C0135E72DE537BCB0FE08B40A">
  <meta name="baidu-site-verification" content="codeva-CSYjpuVg5v">


<link rel="alternate" type="application/rss+xml" title="oaciaのBbBlog~" href="https://oacia.dev/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="oaciaのBbBlog~" href="https://oacia.dev/atom.xml" />
<link rel="alternate" type="application/json" title="oaciaのBbBlog~" href="https://oacia.dev/feed.json" />
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-regular.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-700.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/font_1832207_igi8uaupcus.woff2"
/>
<link rel="preload" href="/background_picture/1_gongzi.webp" as="image" />
<link rel="preload" href="/background_picture/2_xiaoxia.webp" as="image" />
<link rel="preload" href="/background_picture/3_xingye.webp" as="image" />
<link rel="preload" href="/images/avatar.jpg" as="image" />



<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="https://oacia.dev/android-JNI/">


<meta name="description" content="在日常的安卓逆向中，可能会遇到代码在 libxxx.so  中的情况，而这种在 so  中的代码的编写就涉及到了安卓的 JNI (Java Native Interface) 开发，俗话说要想会逆向，那么首先得要学会正向，假如都没见过某种语法，那还怎么逆向下去嘞？所以就玩玩 JNI 咯～  # 在 Android studio 中开发 JNI 首先我们需要创建一个 jni 文件夹，我们只需要右键">
<meta property="og:type" content="article">
<meta property="og:title" content="安卓JNI学习">
<meta property="og:url" content="https://oacia.dev/android-JNI/">
<meta property="og:site_name" content="oaciaのBbBlog~">
<meta property="og:description" content="在日常的安卓逆向中，可能会遇到代码在 libxxx.so  中的情况，而这种在 so  中的代码的编写就涉及到了安卓的 JNI (Java Native Interface) 开发，俗话说要想会逆向，那么首先得要学会正向，假如都没见过某种语法，那还怎么逆向下去嘞？所以就玩玩 JNI 咯～  # 在 Android studio 中开发 JNI 首先我们需要创建一个 jni 文件夹，我们只需要右键">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921182326835.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921182611380.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921182644581.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921192049257.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921193649062.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921193805084.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230922173927187.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230921194130893.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230923141210982.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20230923222945135.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20240710102719540.png">
<meta property="og:image" content="https://oacia.dev/android-JNI/image-20240710130611981.png">
<meta property="article:published_time" content="2023-09-21T09:25:53.000Z">
<meta property="article:modified_time" content="2025-04-08T18:55:11.430Z">
<meta property="article:author" content="oacia">
<meta property="article:tag" content="reverse,安卓逆向,区块链,学习笔记,破解实战,前端,CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oacia.dev/android-JNI/image-20230921182326835.png">
<meta name="twitter:creator" content="@oacia86">


  <title>
安卓JNI学习 |
oacia = oaciaのBbBlog~ = DEVIL or SWEET</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  var jq_151 = $.noConflict(true);
  var RENDERER = {
    INIT_CHERRY_BLOSSOM_COUNT : 30,
    MAX_ADDING_INTERVAL : 10,
    WATCH_INTERVAL : 300,
    
    init : function(){
      this.setParameters();
      this.reconstructMethods();
      this.setup();
      this.bindEvent();
      this.render();
    },
    setParameters : function(){
      this.$window = jq_151(window);
      this.$container = jq_151('#loading');
      this.$canvas = jq_151('<canvas />');
      this.context = this.$canvas.appendTo(this.$container).get(0).getContext('2d');
      this.cherries = [];
      this.watchIds = [];
    },
    reconstructMethods : function(){
      this.watchWindowSize = this.watchWindowSize.bind(this);
      this.jdugeToStopResize = this.jdugeToStopResize.bind(this);
      this.render = this.render.bind(this);
    },
    setup : function(){
      this.cherries.length = 0;
      this.watchIds.length = 0;
      this.width = this.$container.width();
      this.height = this.$container.height();
      this.$canvas.attr({width : this.width, height : this.height});
      this.maxAddingInterval = Math.round(this.MAX_ADDING_INTERVAL * 1000 / this.width);
      this.addingInterval = this.maxAddingInterval;
      this.createCherries();
    },
    createCherries : function(){
      for(var i = 0, length = Math.round(this.INIT_CHERRY_BLOSSOM_COUNT * this.width / 1000); i < length; i++){
        this.cherries.push(new CHERRY_BLOSSOM(this, true));
      }
    },
    watchWindowSize : function(){
      this.clearTimer();
      this.tmpWidth = window.width;
      this.tmpHeight = window.height;
      this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL));
    },
    clearTimer : function(){
      while(this.watchIds.length > 0){
        clearTimeout(this.watchIds.pop());
      }
    },
    jdugeToStopResize : function(){
      var width = window.width,
        height = window.height,
        stopped = (width == this.tmpWidth && height == this.tmpHeight);
        
      this.tmpWidth = width;
      this.tmpHeight = height;
      
      if(stopped){
        this.setup();
      }
    },
    bindEvent : function(){
      this.$window.on('resize', this.watchWindowSize);
    },
    render : function(){
      //console.log("render")

      if(jq_151(this.$container).css("display")!="none"){
        requestAnimationFrame(this.render);
      }
      
      this.context.clearRect(0, 0, this.width, this.height);
      
      this.cherries.sort(function(cherry1, cherry2){
        return cherry1.z - cherry2.z;
      });
      for(var i = this.cherries.length - 1; i >= 0; i--){
        if(!this.cherries[i].render(this.context)){
          this.cherries.splice(i, 1);
        }
      }
      if(--this.addingInterval == 0){
        this.addingInterval = this.maxAddingInterval;
        this.cherries.push(new CHERRY_BLOSSOM(this, false));
      }
    }
  };
  var CHERRY_BLOSSOM = function(renderer, isRandom){
    this.renderer = renderer;
    this.init(isRandom);
  };
  CHERRY_BLOSSOM.prototype = {
    FOCUS_POSITION : 300,
    FAR_LIMIT : 600,
    MAX_RIPPLE_COUNT : 100,
    RIPPLE_RADIUS : 100,
    SURFACE_RATE : 0.5,
    SINK_OFFSET : 20,
    
    init : function(isRandom){
      this.x = this.getRandomValue(-this.renderer.width, this.renderer.width);
      this.y = isRandom ? this.getRandomValue(0, this.renderer.height) : this.renderer.height * 1.5;
      this.z = this.getRandomValue(0, this.FAR_LIMIT);
      this.vx = this.getRandomValue(-2, 2);
      this.vy = -2;
      this.theta = this.getRandomValue(0, Math.PI * 2);
      this.phi = this.getRandomValue(0, Math.PI * 2);
      this.psi = 0;
      this.dpsi = this.getRandomValue(Math.PI / 600, Math.PI / 300);
      this.opacity = 0;
      this.endTheta = false;
      this.endPhi = false;
      this.rippleCount = 0;
      
      var axis = this.getAxis(),
        theta = this.theta + Math.ceil(-(this.y + this.renderer.height * this.SURFACE_RATE) / this.vy) * Math.PI / 500;
      theta %= Math.PI * 2;
      
      this.offsetY = 40 * ((theta <= Math.PI / 2 || theta >= Math.PI * 3 / 2) ? -1 : 1);
      this.thresholdY = this.renderer.height / 2 + this.renderer.height * this.SURFACE_RATE * axis.rate;
      this.entityColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.entityColor.addColorStop(0, 'hsl(330, 70%, ' + 50 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(0.05, 'hsl(330, 40%,' + 55 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(1, 'hsl(330, 20%, ' + 70 * (0.3 + axis.rate) + '%)');
      this.shadowColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.shadowColor.addColorStop(0, 'hsl(330, 40%, ' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(0.05, 'hsl(330, 40%,' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(1, 'hsl(330, 20%, ' + 40 * (0.3 + axis.rate) + '%)');
    },
    getRandomValue : function(min, max){
      return min + (max - min) * Math.random();
    },
    getAxis : function(){
      var rate = this.FOCUS_POSITION / (this.z + this.FOCUS_POSITION),
        x = this.renderer.width / 2 + this.x * rate,
        y = this.renderer.height / 2 - this.y * rate;
      return {rate : rate, x : x, y : y};
    },
    renderCherry : function(context, axis){
      context.beginPath();
      context.moveTo(0, 40);
      context.bezierCurveTo(-60, 20, -10, -60, 0, -20);
      context.bezierCurveTo(10, -60, 60, 20, 0, 40);
      context.fill();
      
      for(var i = -4; i < 4; i++){
        context.beginPath();
        context.moveTo(0, 40);
        context.quadraticCurveTo(i * 12, 10, i * 4, -24 + Math.abs(i) * 2);
        context.stroke();
      }
    },
    render : function(context){
      var axis = this.getAxis();
      
      if(axis.y == this.thresholdY && this.rippleCount < this.MAX_RIPPLE_COUNT){
        context.save();
        context.lineWidth = 2;
        context.strokeStyle = 'hsla(0, 0%, 100%, ' + (this.MAX_RIPPLE_COUNT - this.rippleCount) / this.MAX_RIPPLE_COUNT + ')';
        context.translate(axis.x + this.offsetY * axis.rate * (this.theta <= Math.PI ? -1 : 1), axis.y);
        context.scale(1, 0.3);
        context.beginPath();
        context.arc(0, 0, this.rippleCount / this.MAX_RIPPLE_COUNT * this.RIPPLE_RADIUS * axis.rate, 0, Math.PI * 2, false);
        context.stroke();
        context.restore();
        this.rippleCount++;
      }
      if(axis.y < this.thresholdY || (!this.endTheta || !this.endPhi)){
        if(this.y <= 0){
          this.opacity = Math.min(this.opacity + 0.01, 1);
        }
        context.save();
        context.globalAlpha = this.opacity;
        context.fillStyle = this.shadowColor;
        context.strokeStyle = 'hsl(330, 30%,' + 40 * (0.3 + axis.rate) + '%)';
        context.translate(axis.x, Math.max(axis.y, this.thresholdY + this.thresholdY - axis.y));
        context.rotate(Math.PI - this.theta);
        context.scale(axis.rate * -Math.sin(this.phi), axis.rate);
        context.translate(0, this.offsetY);
        this.renderCherry(context, axis);
        context.restore();
      }
      context.save();
      context.fillStyle = this.entityColor;
      context.strokeStyle = 'hsl(330, 40%,' + 70 * (0.3 + axis.rate) + '%)';
      context.translate(axis.x, axis.y + Math.abs(this.SINK_OFFSET * Math.sin(this.psi) * axis.rate));
      context.rotate(this.theta);
      context.scale(axis.rate * Math.sin(this.phi), axis.rate);
      context.translate(0, this.offsetY);
      this.renderCherry(context, axis);
      context.restore();
      
      if(this.y <= -this.renderer.height / 4){
        if(!this.endTheta){
          for(var theta = Math.PI / 2, end = Math.PI * 3 / 2; theta <= end; theta += Math.PI){
            if(this.theta < theta && this.theta + Math.PI / 200 > theta){
              this.theta = theta;
              this.endTheta = true;
              break;
            }
          }
        }
        if(!this.endPhi){
          for(var phi = Math.PI / 8, end = Math.PI * 7 / 8; phi <= end; phi += Math.PI * 3 / 4){
            if(this.phi < phi && this.phi + Math.PI / 200 > phi){
              this.phi = Math.PI / 8;
              this.endPhi = true;
              break;
            }
          }
        }
      }
      if(!this.endTheta){
        if(axis.y == this.thresholdY){
          this.theta += Math.PI / 200 * ((this.theta < Math.PI / 2 || (this.theta >= Math.PI && this.theta < Math.PI * 3 / 2)) ? 1 : -1);
        }else{
          this.theta += Math.PI / 500;
        }
        this.theta %= Math.PI * 2;
      }
      if(this.endPhi){
        if(this.rippleCount == this.MAX_RIPPLE_COUNT){
          this.psi += this.dpsi;
          this.psi %= Math.PI * 2;
        }
      }else{
        this.phi += Math.PI / ((axis.y == this.thresholdY) ? 200 : 500);
        this.phi %= Math.PI;
      }
      if(this.y <= -this.renderer.height * this.SURFACE_RATE){
        this.x += 2;
        this.y = -this.renderer.height * this.SURFACE_RATE;
      }else{
        this.x += this.vx;
        this.y += this.vy;
      }
      return this.z > -this.FOCUS_POSITION && this.z < this.FAR_LIMIT && this.x < this.renderer.width * 1.5;
    }
  };
  jq_151(function(){
    RENDERER.init();
  });
</script>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <!--
    <div class="alice">
      <img src="/images/alice-shake.gif" alt="">
    </div>

    
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
    -->
  </div>
  <script
      defer="defer"
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"
      integrity="sha512-1dalHDkG9EtcOmCnoCjiwQ/HEB5SDNqw8d4G2MKoNwjiwMNeBAkudsBCmSlMnXdsH8Bm0mOd3tl/6nL5y0bMaQ=="
      crossorigin="anonymous"
    ></script>
  <script defer="defer" src="/js/gsap/DrawSVGPlugin.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomEase.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomBounce.min.js"></script>
  <script defer="defer" src="/js/gsap/SplitText.min.js"></script>
  <script defer="defer" src="/js/gsap/logo-run.js"></script>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">安卓JNI学习
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2023-09-21 17:25:53">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2023-09-21T17:25:53+08:00">2023-09-21</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>23k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>21 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">oacia</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/background_picture/1_mary.jpg"></li>
          <li class="item" data-background-image="/background_picture/2_xingye.webp"></li>
          <li class="item" data-background-image="/background_picture/3_xiaoxia.webp"></li>
          <li class="item" data-background-image="/background_picture/4_alice.webp"></li>
          <li class="item" data-background-image="/background_picture/5_mutsuki.jpg"></li>
          <li class="item" data-background-image="/background_picture/6_arona_plana.webp"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb">
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://oacia.dev/android-JNI/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="oacia">
    <meta itemprop="description" content="DEVIL or SWEET, 月遇从云 花遇和风">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="oaciaのBbBlog~">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>在日常的安卓逆向中，可能会遇到代码在 <code>libxxx.so</code>  中的情况，而这种在 <code>so</code>  中的代码的编写就涉及到了安卓的 JNI (Java Native Interface) 开发，俗话说要想会逆向，那么首先得要学会正向，假如都没见过某种语法，那还怎么逆向下去嘞？所以就玩玩 JNI 咯～</p>
</blockquote>
<h1 id="在android-studio中开发jni"><a class="anchor" href="#在android-studio中开发jni">#</a> 在 Android studio 中开发 JNI</h1>
<p>首先我们需要创建一个 jni 文件夹，我们只需要右键 app, 然后点击 <code>New-&gt;Folder-&gt;JNI Folder</code>  就可以创建了</p>
<p><img data-src="/android-JNI/image-20230921182326835.png" alt="image-20230921182326835" style="aspect-ratio:1920 / 1079;"></p>
<p>接下来从 <code>Android</code>  布局转到 <code>Project</code>  布局，就可以看到新创建的 <code>jni</code>  文件夹</p>
<p><img data-src="/android-JNI/image-20230921182611380.png" alt="image-20230921182611380" style="aspect-ratio:512 / 541;"></p>
<p><img data-src="/android-JNI/image-20230921182644581.png" alt="image-20230921182644581" style="aspect-ratio:482 / 571;"></p>
<p>随后创建一个 <code>oacia.c</code>  和 <code>Android.mk</code></p>
<p><img data-src="/android-JNI/image-20230921192049257.png" alt="image-20230921192049257" style="aspect-ratio:413 / 344;"></p>
<p>之后我们需要编写 <code>Android.mk</code> , 关于语法可以参考下面的链接</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vbmRrL2d1aWRlcy9hbmRyb2lkX21rP2hsPXpoLWNu">Android.mk 语法</span></p>
<p>于是 <code>Android.mk</code>  的内容如下</p>
<figure class="highlight makefile"><figcaption data-lang="makefile"></figcaption><table><tr><td data-num="1"></td><td><pre>LOCAL_PATH <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">call</span> my-dir<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>CLEAR_VARS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>LOCAL_MODULE <span class="token operator">:=</span> oacia</pre></td></tr><tr><td data-num="5"></td><td><pre>LOCAL_SRC_FILES <span class="token operator">:=</span> oacia.c</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>BUILD_SHARED_LIBRARY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#BUILD_SHARED_LIBRARY 生成共享链接库</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#如果想要生成单独的可执行文件，可以使用 BUILD_EXECUTABLE</span></pre></td></tr></table></figure><p><code>Android.mk</code>  编写完成之后，我们需要将这个配置文件和我们的目标源文件 <code>oacia.c</code>  链接在一起，具体操作如下</p>
<p>右键 <code>app</code>  文件夹，选择 <code>Add C++ to Module</code></p>
<p><img data-src="/android-JNI/image-20230921193649062.png" alt="image-20230921193649062" style="aspect-ratio:932 / 355;"></p>
<p>然后选中我们之前编写的 <code>Android.mk</code>  文件即可完成链接</p>
<p><img data-src="/android-JNI/image-20230921193805084.png" alt="image-20230921193805084" style="aspect-ratio:871 / 406;"></p>
<p>随后我们来到声明 jni 层函数的位置，鼠标悬浮在爆红的函数，点击 <code>Create JNI function for</code></p>
<p><img data-src="/android-JNI/image-20230922173927187.png" alt="image-20230922173927187" style="aspect-ratio:1292 / 711;"></p>
<p>Android studio 便自动为我们完成了函数的定义工作</p>
<p><img data-src="/android-JNI/image-20230921194130893.png" alt="image-20230921194130893" style="aspect-ratio:1304 / 260;"></p>
<h1 id="数据类型"><a class="anchor" href="#数据类型">#</a> 数据类型</h1>
<h2 id="基本数据类型"><a class="anchor" href="#基本数据类型">#</a> 基本数据类型</h2>
<table>
<thead>
<tr>
<th>Java 类型</th>
<th>JNI 数据类型</th>
<th>位数</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>jboolean</td>
<td>unsigned 8 bits</td>
</tr>
<tr>
<td>byte</td>
<td>jbyte</td>
<td>signed 8 bits</td>
</tr>
<tr>
<td>char</td>
<td>jchar</td>
<td>unsigned 16 bits</td>
</tr>
<tr>
<td>short</td>
<td>jshort</td>
<td>signed 16 bits</td>
</tr>
<tr>
<td>int</td>
<td>jint</td>
<td>signed 32 bits</td>
</tr>
<tr>
<td>long</td>
<td>jlong</td>
<td>signed 64 bits</td>
</tr>
<tr>
<td>float</td>
<td>jfloat</td>
<td>32 bits</td>
</tr>
<tr>
<td>double</td>
<td>jdouble</td>
<td>64 bits</td>
</tr>
</tbody>
</table>
<h2 id="引用数据类型"><a class="anchor" href="#引用数据类型">#</a> 引用数据类型</h2>
<table>
<thead>
<tr>
<th>Java 类型</th>
<th>JNI 数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>void</td>
<td>void</td>
</tr>
<tr>
<td>java.lang.Object</td>
<td>jobject</td>
</tr>
<tr>
<td>java.lang.Class</td>
<td>jclass</td>
</tr>
<tr>
<td>java.lang.String</td>
<td>jstring</td>
</tr>
<tr>
<td>java.lang.Throwable</td>
<td>jthrowable</td>
</tr>
<tr>
<td>Object[]</td>
<td>jobjectArray</td>
</tr>
<tr>
<td>boolean[]</td>
<td>jbooleanArray</td>
</tr>
<tr>
<td>byte[]</td>
<td>jbyteArray</td>
</tr>
<tr>
<td>char[]</td>
<td>jcharArray</td>
</tr>
<tr>
<td>short[]</td>
<td>jshortArray</td>
</tr>
<tr>
<td>int[]</td>
<td>jintArray</td>
</tr>
<tr>
<td>long[]</td>
<td>jlongArray</td>
</tr>
<tr>
<td>float[]</td>
<td>jfloatArray</td>
</tr>
<tr>
<td>double[]</td>
<td>jdoubleArray</td>
</tr>
</tbody>
</table>
<h2 id="jvalue类型"><a class="anchor" href="#jvalue类型">#</a> jvalue 类型</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">union</span> jvalue <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    jboolean    z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    jbyte       b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    jchar       c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    jshort      s<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    jint        i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    jlong       j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    jfloat      f<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    jdouble     d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    jobject     l<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span> jvalue<span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="类型描述符"><a class="anchor" href="#类型描述符">#</a> 类型描述符</h2>
<p>看起来和 smali 的类型声明一模一样</p>
<table>
<thead>
<tr>
<th>Java 类型</th>
<th>类型描述符</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>Z</td>
</tr>
<tr>
<td>short</td>
<td>S</td>
</tr>
<tr>
<td>float</td>
<td>F</td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
</tr>
<tr>
<td>int</td>
<td>I</td>
</tr>
<tr>
<td>double</td>
<td>D</td>
</tr>
<tr>
<td>char</td>
<td>C</td>
</tr>
<tr>
<td>long</td>
<td>J</td>
</tr>
<tr>
<td>void</td>
<td>V</td>
</tr>
<tr>
<td>引用类型</td>
<td>L + 全限定名 + ;</td>
</tr>
<tr>
<td>数组</td>
<td>[+ 类型描述符</td>
</tr>
<tr>
<td>方法</td>
<td>(参数的类型描述符) 返回值的类型描述符</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>表示一个 string 类</p>
<p><code>L</code> + <code>全限定名</code> ，其中 <code>.</code>  换成 <code>/</code> , 最后加上 <code>;</code></p>
<table>
<thead>
<tr>
<th>java 类型</th>
<th><strong>类型描述符</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>java.lang.String</code></td>
<td><code>Ljava/lang/String;</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>表示数组</p>
<table>
<thead>
<tr>
<th>java 类型</th>
<th><strong>类型描述符</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>String[]</code></td>
<td><code>[Ljava/lang/String;</code></td>
</tr>
<tr>
<td><code>int[][]</code></td>
<td><code> [[I</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>表示方法</p>
<table>
<thead>
<tr>
<th>java 类型</th>
<th><strong>类型描述符</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>long f (int n,String s,int arr[]);</code></td>
<td><code>(ILjava/lang/String;[I) J</code></td>
</tr>
<tr>
<td><code>void f ();</code></td>
<td><code>() V</code></td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id="其他常用类型"><a class="anchor" href="#其他常用类型">#</a> 其他常用类型</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> jint            jsize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">_jfieldID</span><span class="token punctuation">;</span>                       <span class="token comment">/* opaque structure */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_jfieldID</span><span class="token operator">*</span> jfieldID<span class="token punctuation">;</span>     <span class="token comment">/* field IDs */</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">_jmethodID</span><span class="token punctuation">;</span>                      <span class="token comment">/* opaque structure */</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_jmethodID</span><span class="token operator">*</span> jmethodID<span class="token punctuation">;</span>   <span class="token comment">/* method IDs */</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_FALSE</span>   <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_TRUE</span>    <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_VERSION_1_1</span> <span class="token expression"><span class="token number">0x00010001</span></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_VERSION_1_2</span> <span class="token expression"><span class="token number">0x00010002</span></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_VERSION_1_4</span> <span class="token expression"><span class="token number">0x00010004</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_VERSION_1_6</span> <span class="token expression"><span class="token number">0x00010006</span></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_OK</span>          <span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>         </span><span class="token comment">/* no error */</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_ERR</span>         <span class="token expression"><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        </span><span class="token comment">/* generic error */</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_EDETACHED</span>   <span class="token expression"><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>        </span><span class="token comment">/* thread detached from the VM */</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_EVERSION</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>        </span><span class="token comment">/* JNI version error */</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_COMMIT</span>      <span class="token expression"><span class="token number">1</span>           </span><span class="token comment">/* copy content, do not free buffer */</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JNI_ABORT</span>       <span class="token expression"><span class="token number">2</span>           </span><span class="token comment">/* free buffer w/o copying back */</span></span></pre></td></tr></table></figure><h1 id="javavm"><a class="anchor" href="#javavm">#</a> JavaVM</h1>
<h2 id="定义"><a class="anchor" href="#定义">#</a> 定义</h2>
<p>javaVM 是 java 虚拟机在 jni 层的代表，在 Android 上，<strong> 一个进程只有一个 JavaVM</strong>，所有的线程共用一个 JavaVM, 也就是在 Android 进程中是通过<strong>有且只有一个</strong>虚拟机对象来服务所有 Java 和 C/C++ 代码。</p>
<p><img data-src="/android-JNI/image-20230923141210982.png" alt="image-20230923141210982" style="aspect-ratio:1202 / 333;"></p>
<h2 id="invocation-api"><a class="anchor" href="#invocation-api">#</a> Invocation API</h2>
<p>Invocation API 允许软件提供商在原生程序中内嵌 Java 虚拟机。因此可以不需要链接任何 Java 虚拟机代码来提供 Java-enabled 的应用程序。</p>
<h3 id="destoryjavavm"><a class="anchor" href="#destoryjavavm">#</a> DestoryJavaVM</h3>
<p>卸载一个 Java 虚拟机，并收回它拥有的资源。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param vm: 需要被销毁的虚拟机。</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 成功返回 JNI_OK ，失败返回负数。</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>jint <span class="token function">DestroyJavaVM</span><span class="token punctuation">(</span>JavaVM <span class="token operator">*</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>JDK/JRE 1.1 还没有完全支持这个函数。在 JDK/JRE 1.1 只有主线程才允许调用该函数。</li>
<li>从 JDK/JRE 1.2 开始，任何线程，不管是否已经 attached，都可以调用该函数，如果当前线程已经 attached，则虚拟机会等待当前线程作为唯一的非守护用户线程。</li>
<li>如果当前线程没有 attached，则先 attached，再等待当前线程作为唯一的非守护用户线程。</li>
<li>JDK/JRE 1.1.2 不支持 unload 虚拟机。</li>
</ul>
<h3 id="attachcurrentthread"><a class="anchor" href="#attachcurrentthread">#</a> AttachCurrentThread</h3>
<p>附加当前线程到 <code>JavaVM</code> , 并返回 <code>JNIEnv</code></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param vm: 需要被 attach 到的虚拟机。</pre></td></tr><tr><td data-num="3"></td><td><pre>@param p_env: 返回的当前线程的 JNI 接口指针。</pre></td></tr><tr><td data-num="4"></td><td><pre>@param thr_args: JavaVMAttachArgs 结构体来指定附加信息，或传入 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 成功返回 JNI_OK ，失败返回负数。</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</pre></td></tr><tr><td data-num="7"></td><td><pre>jint <span class="token function">AttachCurrentThread</span><span class="token punctuation">(</span>JavaVM <span class="token operator">*</span>vm<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>p_env<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>thr_args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><details class="info"><summary>thr_args</summary><div>
<p><code>thr_args</code>  的结构体如下</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">JavaVMAttachArgs</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    jint version<span class="token punctuation">;</span>  <span class="token comment">/* must be at least JNI_VERSION_1_2 */</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>    <span class="token comment">/* the name of the thread as a modified UTF-8 string, or NULL */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    jobject group<span class="token punctuation">;</span> <span class="token comment">/* global ref of a ThreadGroup object, or NULL */</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> JavaVMAttachArgs</pre></td></tr></table></figure></div></details>
<ul>
<li>尝试 attach 已经 attached 过的线程不会执行任何操作（no-op）。</li>
<li>一个本地线程不能同时 attach 到两个不同的 Java 虚拟机。</li>
<li>当前一个线程 attach 到虚拟机，它的上下文 ClassLoader 是 Bootstrap ClassLoader。</li>
</ul>
<h3 id="attachcurrentthreadasdaemon"><a class="anchor" href="#attachcurrentthreadasdaemon">#</a> AttachCurrentThreadAsDaemon</h3>
<p>和 AttachCurrentThread 类似，只是新创建的 java.lang.Thread 被设置为守护线程（daemon）</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param vm: 需要被 attach 到的虚拟机。</pre></td></tr><tr><td data-num="3"></td><td><pre>@param p_env: 返回的当前线程的 JNI 接口指针。</pre></td></tr><tr><td data-num="4"></td><td><pre>@param thr_args: JavaVMAttachArgs 结构体来指定附加信息，或传入 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 成功返回 JNI_OK ，失败返回负数。</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</pre></td></tr><tr><td data-num="7"></td><td><pre>jint <span class="token function">AttachCurrentThreadAsDaemon</span><span class="token punctuation">(</span>JavaVM<span class="token operator">*</span> vm<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span> p_env<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="detachcurrentthread"><a class="anchor" href="#detachcurrentthread">#</a> DetachCurrentThread</h3>
<p>从 java 虚拟机 detach 当前线程。所有这个线程持有的 Java 监视区 (monitor) 都会被释放。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>jint <span class="token function">DetachCurrentThread</span><span class="token punctuation">(</span>JavaVM <span class="token operator">*</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>从 JDK/JRE 1.2 开始，主线程可以从虚拟机 detach。</li>
</ul>
<h3 id="getenv"><a class="anchor" href="#getenv">#</a> GetEnv</h3>
<p>获取当前线程的 JNI 接口指针  <code>JNIEnv</code></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param vm: 当前的 JavaVM 虚拟机</pre></td></tr><tr><td data-num="3"></td><td><pre>@param env: 存储返回的当前线程的 JNI 接口指针。</pre></td></tr><tr><td data-num="4"></td><td><pre>@param version: JNI 版本。</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: </pre></td></tr><tr><td data-num="6"></td><td><pre>	如果当前线程还没有 attach 到虚拟机，则设置 *env 为 NULL ，并返回 JNI_EDETACHED。</pre></td></tr><tr><td data-num="7"></td><td><pre>	如果指定的 JNI 版本不被支持，则设置 *env 为 NULL ，并且返回 JNI_EVERSION。</pre></td></tr><tr><td data-num="8"></td><td><pre>	否则设置 *env 为正常的接口，并返回 JNI_OK </pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr><tr><td data-num="10"></td><td><pre>jint <span class="token function">GetEnv</span><span class="token punctuation">(</span>JavaVM <span class="token operator">*</span>vm<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>env<span class="token punctuation">,</span> jint version<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="javavm虚拟机加载流程"><a class="anchor" href="#javavm虚拟机加载流程">#</a> JavaVM 虚拟机加载流程</h2>
<h3 id="创建虚拟机"><a class="anchor" href="#创建虚拟机">#</a> 创建虚拟机</h3>
<p><code>JNI_CreateJavaVM()</code>  函数载入和初始化一个 Java 虚拟机。调用该函数的线程被视为是主线程（main thread）。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">inlcude</span> <span class="token expression"><span class="token operator">&lt;</span>jni<span class="token punctuation">.</span>h<span class="token operator">></span></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>@param p_vm: 指向 JavaVM * 的指针，函数成功返回时会给 JavaVM * 指针赋值。</pre></td></tr><tr><td data-num="4"></td><td><pre>@param p_env: 指向 JNIEnv * 的指针，函数成功返回时会给 JNIEnv * 指针赋值。</pre></td></tr><tr><td data-num="5"></td><td><pre>@param vm_args: 指向 JavaVMInitArgs 的指针，是初始化虚拟机的参数。</pre></td></tr><tr><td data-num="6"></td><td><pre>@return: 如果函数执行成功，返回 JNI_OK (值为 0)，如果失败返回负值。</pre></td></tr><tr><td data-num="7"></td><td><pre>*/</pre></td></tr><tr><td data-num="8"></td><td><pre>jint <span class="token function">JNI_CreateJavaVM</span><span class="token punctuation">(</span>JavaVM <span class="token operator">*</span><span class="token operator">*</span>p_vm<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>p_env<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>vm_args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><details class="info"><summary>vm_args</summary><div>
<p>第 3 个参数  <code>vm_args</code>  的结构体为：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">JavaVMInitArgs</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    jint version<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    jint nOptions<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    JavaVMOption <span class="token operator">*</span>options<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    jboolean ignoreUnrecognized<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> JavaVMInitArgs<span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>version</code>  必须大于等于  <code>JNI_VERSION_1_2</code> ,</p>
</li>
<li>
<p><code>nOptions</code>  为  <code>options</code>  的数量.</p>
<ul>
<li>
<p>options 的结构体为:</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">JavaVMOption</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>optionString<span class="token punctuation">;</span>  <span class="token comment">/* the option as a string in the default platform encoding */</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>extraInfo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span> JavaVMOption<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><code>ignoreUnrecognized</code>  设置为  <code>JNI_TRUE</code>  ，则会忽视所有不被识别的以  <code>-X</code>  或  <code>_</code>  开头的参数字符串，如果设置为  <code>JNI_FALSE</code>  ，则遇到不被识别的参数时 <code>JNI_CreateJavaVM</code>  函数会返回  <code>JNI_ERR</code></p>
<p>所有虚拟机的实现都支持它自己的非标准参数。非标准参数必须以  <code>-X</code>  或  <code>_</code>  开头。例如，JDK/JRE 支持  <code>-Xms</code>  和  <code>-Xmx</code>  参数来允许开发者指定初始化和最大的 heap 大小。</p>
</li>
</ul>
</div></details>
<ul>
<li>在 JDK/JRE 1.2，不允许在同一个进程创建多个 Java 虚拟机。</li>
</ul>
<p><strong>使用示例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>JavaVMInitArgs vm_args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>JavaVMOption options<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>optionString <span class="token operator">=</span> <span class="token string">"-Djava.compiler=NONE"</span><span class="token punctuation">;</span>           <span class="token comment">/* disable JIT */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>options<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>optionString <span class="token operator">=</span> <span class="token string">"-Djava.class.path=c:\myclasses"</span><span class="token punctuation">;</span> <span class="token comment">/* user classes */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>options<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>optionString <span class="token operator">=</span> <span class="token string">"-Djava.library.path=c:\mylibs"</span><span class="token punctuation">;</span>  <span class="token comment">/* set native library path */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>options<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>optionString <span class="token operator">=</span> <span class="token string">"-verbose:jni"</span><span class="token punctuation">;</span>                   <span class="token comment">/* print JNI-related messages */</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>vm_args<span class="token punctuation">.</span>version <span class="token operator">=</span> JNI_VERSION_1_2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>vm_args<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>vm_args<span class="token punctuation">.</span>nOptions <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>vm_args<span class="token punctuation">.</span>ignoreUnrecognized <span class="token operator">=</span> TRUE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">/* Note that in the JDK/JRE, there is no longer any need to call</span></pre></td></tr><tr><td data-num="15"></td><td><pre> * JNI_GetDefaultJavaVMInitArgs.</pre></td></tr><tr><td data-num="16"></td><td><pre> */</pre></td></tr><tr><td data-num="17"></td><td><pre>res <span class="token operator">=</span> <span class="token function">JNI_CreateJavaVM</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vm<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>env<span class="token punctuation">,</span> <span class="token operator">&amp;</span>vm_args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><h3 id="线程附加到虚拟机"><a class="anchor" href="#线程附加到虚拟机">#</a> 线程附加到虚拟机</h3>
<p>JNI 接口指针 (JNIEnv) 只在当前线程有效，如果需要在另一个线程访问 Java 虚拟机，必须先调用  <code>AttachCurrentThread()</code>  来将自己 attach 到虚拟机来获得 JNI 接口指针 <code>JNIEnv</code></p>
<p>线程必须有足够的栈空间来执行一定的工作。每个线程分配多少栈空间根据系统而不同。</p>
<h3 id="脱离虚拟机"><a class="anchor" href="#脱离虚拟机">#</a> 脱离虚拟机</h3>
<p>一个 attach 到虚拟机的本地线程必须在退出前调用  <code>DetachCurrentThread()</code>  来和虚拟机脱离。如果还有 Java 方法在 call stack 中，则这个线程不能被 detach。</p>
<h3 id="卸载虚拟机"><a class="anchor" href="#卸载虚拟机">#</a> 卸载虚拟机</h3>
<p>使用  <code>JNI_DestroyJavaVM()</code>  函数来卸载一个 Java 虚拟机</p>
<p>虚拟机会等待（阻塞），直到当前线程成为唯一的非守护进程的用户进程，才真正执行卸载操作。</p>
<p>用户进程 (user thread) 包括:</p>
<ul>
<li>Java 线程 (java threads)</li>
<li>attached 到虚拟机的本地线程 (attached native threads)</li>
</ul>
<blockquote>
<p>为什么要做这样的限制（强制等待），是因为 Java 线程和 native 线程可能会 hold 住系统资源，例如锁，窗口等资源，而虚拟机不能自动释放这些资源。通过限制当前线程是唯一的运行中的用户线程才 unload 虚拟机，则将释放这种系统资源的任务交给程序员自己来负责了。</p>
</blockquote>
<h2 id="获取javavm接口"><a class="anchor" href="#获取javavm接口">#</a> 获取 JavaVM 接口</h2>
<ul>
<li>在 Java VM 虚拟机加载动态链接库时，可以在 <code>JNI_OnLoad</code>  的参数中获取到 <code>JavaVM</code></li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>JavaVM <span class="token operator">*</span>global_jvm<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>JNIEXPORT jint <span class="token function">JNI_OnLoad</span><span class="token punctuation">(</span>JavaVM<span class="token operator">*</span> vm<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> reserved<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    global_jvm <span class="token operator">=</span> vm<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li>
<p>通过 <code>JNIEnv</code>  获取 <code>JavaVM</code></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>JavaVM <span class="token operator">*</span>gJavaVM<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>jobject gJavaObj<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>JNIEXPORT <span class="token keyword">void</span> JNICALL <span class="token function">Java_com_xxx_android2native_JniManager_openJni</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span> env<span class="token punctuation">,</span> jobject object<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 线程不允许共用 env 环境变量，但是 JavaVM 指针是整个 jvm 共用的，所以可以通过下面的方法保存 JavaVM 指针，在线程中使用</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    env<span class="token operator">-></span><span class="token function">GetJavaVM</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gJavaVM<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 同理，jobject 变量也不允许在线程中共用，因此需要创建全局的 jobject 对象在线程中访问该对象</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    gJavaObj <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">NewGlobalRef</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
</ul>
<h1 id="jnienv"><a class="anchor" href="#jnienv">#</a> JNIEnv</h1>
<h2 id="定义-2"><a class="anchor" href="#定义-2">#</a> 定义</h2>
<p>JNIEnv 是提供 JNI Native 函数的基础环境，线程相关，<strong>不同线程的 JNIEnv 相互独立</strong>，并且 JNIEnv 是一个 JNI 接口指针，指向了本地方法的一个函数表，该函数表中的每一个成员指向了一个 JNI 函数，本地方法通过 JNI 函数来访问 JVM 中的数据结构.</p>
<p><img data-src="/android-JNI/image-20230923222945135.png" alt="image-20230923222945135" style="aspect-ratio:1105 / 433;"></p>
<h2 id="jni函数"><a class="anchor" href="#jni函数">#</a> JNI 函数</h2>
<h3 id="版本信息"><a class="anchor" href="#版本信息">#</a> 版本信息</h3>
<h4 id="getversion"><a class="anchor" href="#getversion">#</a> GetVersion</h4>
<p>获取 JNI 版本号</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param env: JNI interface 指针</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回一个十六进制整数，其中高 16 位表示主版本号，低 16 位标识表示次版本号，如：1.2, GetVersion () 返回 0x00010002, 1.4, GetVersion () returns 0x00010004.</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>jint <span class="token function">GetVersion</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>后面再出现  <code>JNIEnv *env</code>  这样的参数不再注释</strong></p>
<h3 id="类操作"><a class="anchor" href="#类操作">#</a> 类操作</h3>
<h4 id="defineclass"><a class="anchor" href="#defineclass">#</a> DefineClass</h4>
<p>从原始类数据的缓冲区中加载类。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param loader: 分派给所定义的类的类加载器</pre></td></tr><tr><td data-num="3"></td><td><pre>@param buf: 包含 .class 文件数据的缓冲区 </pre></td></tr><tr><td data-num="4"></td><td><pre>@param buflen: 缓冲区长度</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 返回 Java 类对象。如果出错则返回 NULL。</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw:</pre></td></tr><tr><td data-num="7"></td><td><pre>		ClassFormatError  如果类数据指定的类无效</pre></td></tr><tr><td data-num="8"></td><td><pre>		ClassCircularityError  如果类或接口是自身的超类或超接口</pre></td></tr><tr><td data-num="9"></td><td><pre>		OutOfMemoryError  如果系统内存不足</pre></td></tr><tr><td data-num="10"></td><td><pre>*/</pre></td></tr><tr><td data-num="11"></td><td><pre>jclass <span class="token function">DefineClass</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject loader<span class="token punctuation">,</span> <span class="token keyword">const</span> jbyte <span class="token operator">*</span>buf <span class="token punctuation">,</span> jsize bufLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="findclass"><a class="anchor" href="#findclass">#</a> FindClass</h4>
<p>该函数用于加载 Java 类。它将在 CLASSPATH 环境变量所指定的目录和 zip 文件里搜索指定的类名。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param name: 类全名 = (包名 +‘/’+ 类名).replace ('.', '/');</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 类对象全名；如果找不到该类，则返回 NULL。</pre></td></tr><tr><td data-num="4"></td><td><pre>@throw:  </pre></td></tr><tr><td data-num="5"></td><td><pre>		ClassFormatError      如果类数据指定的类无效</pre></td></tr><tr><td data-num="6"></td><td><pre>		ClassCircularityError   如果类或接口是自身的超类或超接口</pre></td></tr><tr><td data-num="7"></td><td><pre>		NoClassDefFoundError    如果找不到所请求的类或接口的定义</pre></td></tr><tr><td data-num="8"></td><td><pre>		OutOfMemoryError        如果系统内存不足</pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr><tr><td data-num="10"></td><td><pre>jclass <span class="token function">FindClass</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getobjectclass"><a class="anchor" href="#getobjectclass">#</a> GetObjectClass</h4>
<p>通过对象获取这个类。该函数比较简单，唯一注意的是对象不能为 NULL，否则获取的 class 肯定返回也为 NULL。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: Java 类对象实例</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre>jclass <span class="token function">GetObjectClass</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getsuperclass"><a class="anchor" href="#getsuperclass">#</a> GetSuperclass</h4>
<p>获取父类或者说超类</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 如果 clazz 代表一般类而非 Object 类，则该函数返回由 clazz 所指定的类的超类。 如果 clazz 指向 Object 类或代表某个接口，则该函数返回 NULL。</pre></td></tr><tr><td data-num="4"></td><td><pre>*/  </pre></td></tr><tr><td data-num="5"></td><td><pre>jclass <span class="token function">GetSuperclass</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="isassignablefrom"><a class="anchor" href="#isassignablefrom">#</a> IsAssignableFrom</h4>
<p>确定 clazz1 的对象是否可安全地强制转换为 clazz2</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz1: 源类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param clazz2: 目标类对象</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 以下三种情况返回 JNI_TRUE, 否则返回 JNI_FALSE</pre></td></tr><tr><td data-num="5"></td><td><pre>	1. 第一及第二个类参数引用同一个 Java 类</pre></td></tr><tr><td data-num="6"></td><td><pre>	2. 第一个类是第二个类的子类</pre></td></tr><tr><td data-num="7"></td><td><pre>	3. 第二个类是第一个类的某个接口</pre></td></tr><tr><td data-num="8"></td><td><pre>*/   </pre></td></tr><tr><td data-num="9"></td><td><pre>jboolean <span class="token function">IsAssignableFrom</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz1<span class="token punctuation">,</span>  jclass clazz2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="异常操作"><a class="anchor" href="#异常操作">#</a> 异常操作</h3>
<h4 id="throw"><a class="anchor" href="#throw">#</a> Throw</h4>
<p>抛出 java.lang.Throwable 对象</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre> @param obj: java.lang.Throwable 对象</pre></td></tr><tr><td data-num="3"></td><td><pre> @return: 成功时返回 0，失败时返回负数</pre></td></tr><tr><td data-num="4"></td><td><pre> @throw: java.lang.Throwable 对象 obj</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre>jint  <span class="token function">Throw</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jthrowable obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="thrownew"><a class="anchor" href="#thrownew">#</a> ThrowNew</h4>
<p>利用指定类的消息（由 message 指定）构造异常对象并抛出该异常</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: java.lang.Throwable 的子类</pre></td></tr><tr><td data-num="3"></td><td><pre>@param message: 用于构造 java.lang.Throwable 对象的消息</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 成功时返回 0，失败时返回负数</pre></td></tr><tr><td data-num="5"></td><td><pre>@throw: 新构造的 java.lang.Throwable 对象</pre></td></tr><tr><td data-num="6"></td><td><pre>*/    </pre></td></tr><tr><td data-num="7"></td><td><pre>jint <span class="token function">ThrowNew</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env <span class="token punctuation">,</span>  jclass clazz<span class="token punctuation">,</span>  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="exceptionoccurred"><a class="anchor" href="#exceptionoccurred">#</a> ExceptionOccurred</h4>
<p>确定某个异常是否正被抛出。在本地代码调用 ExceptionClear () 或 Java 代码处理该异常前，异常将始终保持抛出状态。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@return: 返回正被抛出的异常对象，如果当前无异常被抛出，则返回 NULL</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre>jthrowable <span class="token function">ExceptionOccurred</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="exceptiondescribe"><a class="anchor" href="#exceptiondescribe">#</a> ExceptionDescribe</h4>
<p>将异常及堆栈的回溯输出到标准输出（例如 stderr）。该例程可便利调试操作。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">ExceptionDescribe</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="exceptionclear"><a class="anchor" href="#exceptionclear">#</a> ExceptionClear</h4>
<p>清除当前抛出的任何异常。如果当前无异常，则不产生任何效果。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">ExceptionClear</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="fatalerror"><a class="anchor" href="#fatalerror">#</a> FatalError</h4>
<p>抛出致命错误并且不希望虚拟机进行修复。该函数无返回值</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param msg: 错误消息</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">FatalError</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="全局及局部引用"><a class="anchor" href="#全局及局部引用">#</a> 全局及局部引用</h3>
<h4 id="deleteweakglobalref"><a class="anchor" href="#deleteweakglobalref">#</a> DeleteWeakGlobalRef</h4>
<p>删除弱全局引用</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">DeleteWeakGlobalRef</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jweak obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newweakglobalref"><a class="anchor" href="#newweakglobalref">#</a> NewWeakGlobalRef</h4>
<p>用 obj 创建新的弱全局引用</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: 全局或局部引用</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回弱全局引用，弱 obj 指向 null，或者内存不足时返回 NULL，同时抛出异常</pre></td></tr><tr><td data-num="4"></td><td><pre>*/    </pre></td></tr><tr><td data-num="5"></td><td><pre>jweak <span class="token function">NewWeakGlobalRef</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="deletelocalref"><a class="anchor" href="#deletelocalref">#</a> DeleteLocalRef</h4>
<p>删除 localRef 所指向的局部引用</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param localRef: 局部引用</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span>  <span class="token function">DeleteLocalRef</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject localRef<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newlocalref"><a class="anchor" href="#newlocalref">#</a> NewLocalRef</h4>
<p>创建 obj 参数所引用对象的局部引用，创建的引用要通过调用 DeleteLocalRef () 来显式删除</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: 全局或局部引用</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回局部引用，如果系统内存不足则返回 NULL</pre></td></tr><tr><td data-num="4"></td><td><pre>*/    </pre></td></tr><tr><td data-num="5"></td><td><pre>jobject <span class="token function">NewLocalRef</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject ref<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="deleteglobalref"><a class="anchor" href="#deleteglobalref">#</a> DeleteGlobalRef</h4>
<p>删除 globalRef 所指向的全局引用</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param globalRef: 全局引用</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">DeleteGlobalRef</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject globalRef<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newglobalref"><a class="anchor" href="#newglobalref">#</a> NewGlobalRef</h4>
<p>创建 obj 参数所引用对象的新全局引用，创建的引用要通过调用 DeleteGlobalRef () 来显式撤消</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: 全局或局部引用</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回全局引用，如果系统内存不足则返回 NULL</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>object <span class="token function">NewGlobalRef</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="对象操作"><a class="anchor" href="#对象操作">#</a> 对象操作</h3>
<h4 id="issameobject"><a class="anchor" href="#issameobject">#</a> IsSameObject</h4>
<p>测试两个引用是否引用同一 Java 对象</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param ref1: java 对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param ref2: java 对象</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 如果 ref1 和 ref2 引用同一 Java 对象或均为 NULL，则返回 JNI_TRUE。否则返回 JNI_FALSE</pre></td></tr><tr><td data-num="5"></td><td><pre>*/    </pre></td></tr><tr><td data-num="6"></td><td><pre>jboolean <span class="token function">IsSameObject</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject ref1<span class="token punctuation">,</span> jobject ref2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="isinstanceof"><a class="anchor" href="#isinstanceof">#</a> IsInstanceOf</h4>
<p>测试对象是否为某个类的实例</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: Java 对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 如果可将 obj 强制转换为 clazz，则返回 JNI_TRUE。否则返回 JNI_FALSE。NULL 对象可强制转换为任何类</pre></td></tr><tr><td data-num="5"></td><td><pre>*/    </pre></td></tr><tr><td data-num="6"></td><td><pre>jboolean <span class="token function">IsInstanceOf</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getobjectclass-2"><a class="anchor" href="#getobjectclass-2">#</a> GetObjectClass</h4>
<p>返回对象的类</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: Java 对象（不能为 NULL）</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: Java 类对象</pre></td></tr><tr><td data-num="4"></td><td><pre>*/    </pre></td></tr><tr><td data-num="5"></td><td><pre>jclass <span class="token function">GetObjectClass</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newobject"><a class="anchor" href="#newobject">#</a> NewObject</h4>
<p>构造新 Java 对象。方法 methodId 指向应调用的构造函数方法。注意：该 ID 特指该类 class 的构造函数 ID，必须通过调用 GetMethodID () 获得，且调用时的方法名必须为  <code>&lt;init&gt;</code> ，而返回类型必须为 void (V)，clazz 参数务必不要引用数组类。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@return: 返回 Java 对象，如果无法构造该对象，则返回 NULL</pre></td></tr><tr><td data-num="3"></td><td><pre>@throw: InstantiationException  如果该类为接口或抽象类</pre></td></tr><tr><td data-num="4"></td><td><pre>        OutOfMemoryError   如果系统内存不足</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre>jobject <span class="token function">NewObject</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env <span class="token punctuation">,</span>  jclass clazz<span class="token punctuation">,</span>  jmethodID methodID<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 参数附加在函数后面</span></pre></td></tr><tr><td data-num="7"></td><td><pre>jobject <span class="token function">NewObjectA</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env <span class="token punctuation">,</span> jclassclazz<span class="token punctuation">,</span>  jmethodID methodID<span class="token punctuation">,</span> jvalue <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 参数以指针形式附加 </span></pre></td></tr><tr><td data-num="8"></td><td><pre>jobjec <span class="token function">tNewObjectV</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env <span class="token punctuation">,</span> jclassclazz<span class="token punctuation">,</span>  jmethodID methodID<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 参数以 "链表" 形式附加</span></pre></td></tr></table></figure><h4 id="allocobject"><a class="anchor" href="#allocobject">#</a> AllocObject</h4>
<p>分配新 Java 对象而不调用该对象的任何构造函数，返回该对象的引用；clazz 参数务必不要引用数组类。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回 Java 对象；如果无法构造该对象，则返回 NULL</pre></td></tr><tr><td data-num="4"></td><td><pre>@throw: InstantiationException：如果该类为一个接口或抽象类</pre></td></tr><tr><td data-num="5"></td><td><pre>        OutOfMemoryError：如果系统内存不足</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</pre></td></tr><tr><td data-num="7"></td><td><pre>jobject <span class="token function">AllocObject</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="字符串操作"><a class="anchor" href="#字符串操作">#</a> 字符串操作</h3>
<h4 id="getreleasestringcritical"><a class="anchor" href="#getreleasestringcritical">#</a> Get/ReleaseStringCritical</h4>
<p>这两个函数的语义与 Get/ReleaseStringChars 函数类似，但 VM 会尽量返回一个指针。但是使用这一对函数时必须有严格限制：在这对函数调用之间绝对不能调用其他 JNI 方法，否则将导致当前线程阻塞。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> jchar <span class="token operator">*</span> <span class="token function">GetStringCritical</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span> jboolean <span class="token operator">*</span>isCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">ReleaseStringCritical</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span> <span class="token keyword">const</span> jchar <span class="token operator">*</span>carray<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringutfregion"><a class="anchor" href="#getstringutfregion">#</a> GetStringUTFRegion</h4>
<p>将 str 偏移位置 start 开始的 len 长度 unicode 字符转换为 C char 字符，并放在 buf 中</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">GetStringUTFRegion</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring str<span class="token punctuation">,</span> jsize start<span class="token punctuation">,</span> jsize len<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringregion"><a class="anchor" href="#getstringregion">#</a> GetStringRegion</h4>
<p>从 str 的偏移位置 start 开始，复制 len 长度的 unicode 字符到 buf 中</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">GetStringRegion</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring str<span class="token punctuation">,</span> jsize start<span class="token punctuation">,</span> jsize len<span class="token punctuation">,</span> jchar <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="releasestringutfchars"><a class="anchor" href="#releasestringutfchars">#</a> ReleaseStringUTFChars</h4>
<p>通知本地代码不要再访问 utf。utf 参数是一个指针，可利用 GetStringUTFChars () 获得</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param string: Java 字符串对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param utf: 指向 UTF-8 字符串的指针</pre></td></tr><tr><td data-num="4"></td><td><pre>*/    </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">void</span>  <span class="token function">ReleaseStringUTFChars</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span>  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringutfchars"><a class="anchor" href="#getstringutfchars">#</a> GetStringUTFChars</h4>
<p>返回指向字符串的 UTF-8 字符数组的指针。该数组在被 ReleaseStringUTFChars () 释放前将一直有效。 如果 isCopy 不是 NULL，*isCopy 在复制完成后即被设为 JNI_TRUE。如果未复制，则设为 JNI_FALSE。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param string: Java 字符串对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param isCopy: 指向布尔值的指针</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 指向 UTF-8 字符串的指针。如果操作失败，则为 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>*/    </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">GetStringUTFChars</span> <span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span> jboolean <span class="token operator">*</span>isCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringutflength"><a class="anchor" href="#getstringutflength">#</a> GetStringUTFLength</h4>
<p>以字节为单位返回字符串的 UTF-8 长度</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param string: Java 字符串对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 返回字符串的长度</pre></td></tr><tr><td data-num="4"></td><td><pre>*/    </pre></td></tr><tr><td data-num="5"></td><td><pre>jsize  <span class="token function">GetStringUTFLength</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newstringutf"><a class="anchor" href="#newstringutf">#</a> NewStringUTF</h4>
<p>利用 UTF-8 字符数组构造新 java.lang.String 对象</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param bytes: 指向 UTF-8 字符串的指针</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: Java 字符串对象。如果无法构造该字符串，则为 NULL</pre></td></tr><tr><td data-num="4"></td><td><pre>@throw: OutOfMemoryError 如果系统内存不足</pre></td></tr><tr><td data-num="5"></td><td><pre>*/    </pre></td></tr><tr><td data-num="6"></td><td><pre>jstring  <span class="token function">NewStringUTF</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="releasestringchars"><a class="anchor" href="#releasestringchars">#</a> ReleaseStringChars</h4>
<p>通知本地代码不要再访问 chars。参数 chars 是一个指针，可通过 GetStringChars () 从 string 获得</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param chars: 指向 Unicode 字符串的指针</pre></td></tr><tr><td data-num="3"></td><td><pre>*/    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">ReleaseStringChars</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span> <span class="token keyword">const</span> jchar <span class="token operator">*</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringchars"><a class="anchor" href="#getstringchars">#</a> GetStringChars</h4>
<p>返回指向字符串的 Unicode 字符数组的指针。该指针在调用 ReleaseStringchars () 前一直有效。如果 isCopy 非空，则在复制完成后将 *isCopy 设为 JNI_TRUE。如果没有复制，则设为 JNI_FALSE</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param string: Java 字符串对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param isCopy: 指向布尔值的指针</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 指向 Unicode 字符串的指针，如果操作失败，则返回 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> jchar <span class="token operator">*</span> <span class="token function">GetStringChars</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">,</span> jboolean <span class="token operator">*</span>isCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstringlength"><a class="anchor" href="#getstringlength">#</a> GetStringLength</h4>
<p>返回 Java 字符串的长度（Unicode 字符数）</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param string: Java 字符串对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: Java 字符串的长度</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>jsize  <span class="token function">GetStringLength</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jstring string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newstring"><a class="anchor" href="#newstring">#</a> NewString</h4>
<p>利用 Unicode 字符数组构造新的 java.lang.String 对象</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param unicodeChars: 指向 Unicode 字符串的指针</pre></td></tr><tr><td data-num="3"></td><td><pre>@param len: Unicode 字符串的长度</pre></td></tr><tr><td data-num="4"></td><td><pre>@return Java 字符串对象。如果无法构造该字符串，则为 NULL.</pre></td></tr><tr><td data-num="5"></td><td><pre>@throw OutOfMemoryError：如果系统内存不足</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</pre></td></tr><tr><td data-num="7"></td><td><pre>jstring  <span class="token function">NewString</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> <span class="token keyword">const</span> jchar <span class="token operator">*</span>unicodeChars<span class="token punctuation">,</span> jsize len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="数组操作"><a class="anchor" href="#数组操作">#</a> 数组操作</h3>
<h4 id="setobjectarrayelement"><a class="anchor" href="#setobjectarrayelement">#</a> SetObjectArrayElement</h4>
<p>设置 Object 数组的元素</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组</pre></td></tr><tr><td data-num="3"></td><td><pre>@param index: 元素索引</pre></td></tr><tr><td data-num="4"></td><td><pre>@param value: 新的对象</pre></td></tr><tr><td data-num="5"></td><td><pre>@throw: ArrayIndexOutOfBoundsException 如果 index 不是数组中的有效下标</pre></td></tr><tr><td data-num="6"></td><td><pre>       ArrayStoreException 如果 value 的类不是数组元素类的子类</pre></td></tr><tr><td data-num="7"></td><td><pre>*/   </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">void</span>  <span class="token function">SetObjectArrayElement</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobjectArray array<span class="token punctuation">,</span>  jsize index<span class="token punctuation">,</span> jobject value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getobjectarrayelement"><a class="anchor" href="#getobjectarrayelement">#</a> GetObjectArrayElement</h4>
<p>返回 Object 数组的元素</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组</pre></td></tr><tr><td data-num="3"></td><td><pre>@param index: 元素索引</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: Java 对象</pre></td></tr><tr><td data-num="5"></td><td><pre>@throw: ArrayIndexOutOfBoundsException 如果 index 不是数组中的有效下标</pre></td></tr><tr><td data-num="6"></td><td><pre>*/    </pre></td></tr><tr><td data-num="7"></td><td><pre>jobject <span class="token function">GetObjectArrayElement</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobjectArray array<span class="token punctuation">,</span> jsize index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newobjectarray"><a class="anchor" href="#newobjectarray">#</a> NewObjectArray</h4>
<p>构造新的数组，它将保存类 elementClass 中的对象。所有元素初始值均设为 initialElement</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param length: 数组大小</pre></td></tr><tr><td data-num="3"></td><td><pre>@param elementClass: 数组元素类对象</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: initialElement 初始值，可以为 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>@throw: OutOfMemoryError 如果系统内存不足</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</pre></td></tr><tr><td data-num="7"></td><td><pre>jarray <span class="token function">NewObjectArray</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jsize length<span class="token punctuation">,</span> jclass elementClass<span class="token punctuation">,</span> jobject initialElement<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getarraylength"><a class="anchor" href="#getarraylength">#</a> GetArrayLength</h4>
<p>返回数组中的元素数</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@return: 数组的长度</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>jsize <span class="token function">GetArrayLength</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jarray array<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="newprimitivetypearray-routines"><a class="anchor" href="#newprimitivetypearray-routines">#</a> New[PrimitiveType]Array Routines</h4>
<p>用于构造基本类型数组对象</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param length: 要构造的数组的长度</pre></td></tr><tr><td data-num="3"></td><td><pre>@return Java 数组。如果无法构造该数组，则为 NULL</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>ArrayType New<span class="token punctuation">[</span>PrimitiveType<span class="token punctuation">]</span><span class="token function">Array</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jsize length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>下表说明了特定的基本类型数组构造函数。用户应把 New [PrimitiveType] Array 替换为某个实际的基本类型数组构造函数例程名，然后将 ArrayType 替换为该例程相应的数组类型:</p>
<table>
<thead>
<tr>
<th>New[PrimitiveType]Array</th>
<th>ArrayType</th>
</tr>
</thead>
<tbody>
<tr>
<td>NewBooleanArray()</td>
<td>jbooleanarray</td>
</tr>
<tr>
<td>NewByteArray()</td>
<td>jbytearray</td>
</tr>
<tr>
<td>NewCharArray()</td>
<td>jchararray</td>
</tr>
<tr>
<td>NewShortArray()</td>
<td>jshortarray</td>
</tr>
<tr>
<td>NewIntArray()</td>
<td>jintarray</td>
</tr>
<tr>
<td>NewLongArray()</td>
<td>jlongarray</td>
</tr>
<tr>
<td>NewFloatArray()</td>
<td>jfloatarray</td>
</tr>
<tr>
<td>NewDoubleArray()</td>
<td>jdoublearray</td>
</tr>
</tbody>
</table>
<h4 id="getprimitivetypearrayelements"><a class="anchor" href="#getprimitivetypearrayelements">#</a> Get[PrimitiveType]ArrayElements</h4>
<p>一组返回基本类型数组体的函数。结果在调用相应的 Release [PrimitiveType] ArrayElements () 函数前将一直有效。由于返回的数组可能是 Java 数组的副本，因此对返回数组的更改不必在基本类型数组中反映出来，直到调用了 Release [PrimitiveType] ArrayElements ()。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 对象数组</pre></td></tr><tr><td data-num="3"></td><td><pre>@param isCopy: 如果 isCopy 不是 NULL，*isCopy 在复制完成后即被设为 JNI_TRUE; 如果未复制，则设为 JNI_FALSE</pre></td></tr><tr><td data-num="4"></td><td><pre>@return: 返回指向数组的指针，如果操作失败，则为 NULL</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre>NativeType <span class="token operator">*</span> Get<span class="token punctuation">[</span>PrimitiveType<span class="token punctuation">]</span><span class="token function">ArrayElements</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> ArrayType array<span class="token punctuation">,</span> jboolean <span class="token operator">*</span>isCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th>Get[PrimitiveType]ArrayElements</th>
<th>NativeType</th>
<th>ArrayType</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetBooleanArrayElements()</td>
<td>jboolean</td>
<td>jbooleanArray</td>
</tr>
<tr>
<td>GetByteArrayElements()</td>
<td>jbyte</td>
<td>jbyteArray</td>
</tr>
<tr>
<td>GetCharArrayElements()</td>
<td>jchar</td>
<td>jcharArray</td>
</tr>
<tr>
<td>GetShortArrayElements()</td>
<td>jshort</td>
<td>jshortArray</td>
</tr>
<tr>
<td>GetIntArrayElements()</td>
<td>jint</td>
<td>jintArray</td>
</tr>
<tr>
<td>GetLongArrayElements()</td>
<td>jlong</td>
<td>jlongArray</td>
</tr>
<tr>
<td>GetFloatArrayElements()</td>
<td>jfloat</td>
<td>jfloatArray</td>
</tr>
<tr>
<td>GetDoubleArrayElements()</td>
<td>jdouble</td>
<td>jdoubleArray</td>
</tr>
</tbody>
</table>
<h4 id="releaseprimitivetypearrayelements"><a class="anchor" href="#releaseprimitivetypearrayelements">#</a> Release[PrimitiveType]ArrayElements</h4>
<p>释放 elems，通知本地代码不要再访问 elems</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param elems: 参数是一个通过使用对应的 Get [PrimitiveType] ArrayElements () 函数由 array 导出的指针。</pre></td></tr><tr><td data-num="4"></td><td><pre>@param mode: 释放模式，mode 参数将提供有关如何释放数组缓冲区的信息。</pre></td></tr><tr><td data-num="5"></td><td><pre>如果 elems 不是 array 中数组元素的副本，mode 将无效；否则，mode 将具有下表所述的功能:</pre></td></tr><tr><td data-num="6"></td><td><pre>	0               复制回内容并释放 elems 缓冲区</pre></td></tr><tr><td data-num="7"></td><td><pre>	JNI_COMMIT      复制回内容但不释放 elems 缓冲区</pre></td></tr><tr><td data-num="8"></td><td><pre>	JNI_ABORT       释放缓冲区但不复制回变化</pre></td></tr><tr><td data-num="9"></td><td><pre>*/    </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">void</span>  Release<span class="token punctuation">[</span>PrimitiveType<span class="token punctuation">]</span><span class="token function">ArrayElements</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> ArrayType array<span class="token punctuation">,</span> NativeType <span class="token operator">*</span>elems<span class="token punctuation">,</span> jint mode<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>Release [PrimitiveType] ArrayElements 惯用法里的类型参数与 Get [PrimitiveType] ArrayElements 对应，不再列出</p>
<h4 id="getprimitivetypearrayregion"><a class="anchor" href="#getprimitivetypearrayregion">#</a> Get[PrimitiveType]ArrayRegion</h4>
<p>将基本类型数组某一区域复制到缓冲区中的一组函数，使用时替换 PrimitiveType， ArrayType，和 NativeType，如 GetBooleanArrayRegion () ，jbooleanArray 和 jboolean</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组 </pre></td></tr><tr><td data-num="3"></td><td><pre>@param start: 起始位置</pre></td></tr><tr><td data-num="4"></td><td><pre>@param len:   要复制的长度</pre></td></tr><tr><td data-num="5"></td><td><pre>@param buf:   目标缓冲区</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw: ArrayIndexOutOfBoundsException 如果区域中的某个下标无效</pre></td></tr><tr><td data-num="7"></td><td><pre>*/</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">void</span>  Get<span class="token punctuation">[</span>PrimitiveType<span class="token punctuation">]</span><span class="token function">ArrayRegion</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> ArrayType array<span class="token punctuation">,</span> jsize start<span class="token punctuation">,</span> jsize len<span class="token punctuation">,</span> NativeType <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="setprimitivetypearrayregion"><a class="anchor" href="#setprimitivetypearrayregion">#</a> Set[PrimitiveType]ArrayRegion</h4>
<p>将基本类型数组的某一区域从缓冲区中复制回来的一组函数，使用时替换 PrimitiveType， ArrayType，和 NativeType，如 SetBooleanArrayRegion () ，jbooleanArray 和 jboolean</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param array: Java 数组</pre></td></tr><tr><td data-num="3"></td><td><pre>@param start: 起始位置</pre></td></tr><tr><td data-num="4"></td><td><pre>@param len:   写回的长度</pre></td></tr><tr><td data-num="5"></td><td><pre>@param buf:   源缓冲区</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw: ArrayIndexOutOfBoundsException：如果区域中的某个下标无效</pre></td></tr><tr><td data-num="7"></td><td><pre>*/    </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">void</span>  Set<span class="token punctuation">[</span>PrimitiveType<span class="token punctuation">]</span><span class="token function">ArrayRegion</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> ArrayType array<span class="token punctuation">,</span> jsize start<span class="token punctuation">,</span> jsize len<span class="token punctuation">,</span> NativeType <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getprimitivearraycritical与releaseprimitivearraycritical"><a class="anchor" href="#getprimitivearraycritical与releaseprimitivearraycritical">#</a> GetPrimitiveArrayCritical 与 ReleasePrimitiveArrayCritical</h4>
<p>作用同 Get/Release [PrimitiveType] ArrayElements 相同，但是 VM 尽可能返回原 java 数组的指针，否则返回一份拷贝。</p>
<p>这两组调用之间不能调用其他 JNI 函数或进行其他系统调用，否则会导致线程阻塞。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token operator">*</span> <span class="token function">GetPrimitiveArrayCritical</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jarray array<span class="token punctuation">,</span> jboolean <span class="token operator">*</span>isCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">ReleasePrimitiveArrayCritical</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jarray array<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>carray<span class="token punctuation">,</span> jint mode<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="访问对象的属性和方法"><a class="anchor" href="#访问对象的属性和方法">#</a> 访问对象的属性和方法</h3>
<h4 id="getstaticmethodid"><a class="anchor" href="#getstaticmethodid">#</a> GetStaticMethodID</h4>
<p>获取类对象的静态方法 ID</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>jfieldID  <span class="token function">GetStaticMethodID</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getfieldid"><a class="anchor" href="#getfieldid">#</a> GetFieldID</h4>
<p>返回 Java 类（非静态）域的属性 ID。该域由其名称及签名指定。访问器函数的 Get [type] Field 及 Set [type] Field 系列使用域 ID 检索对象域。GetFieldID () 不能用于获取数组的长度域。应使用 GetArrayLength ()。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param name:  该属性的 Name 名称</pre></td></tr><tr><td data-num="4"></td><td><pre>@param sig:   该属性的域签名</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 属性 ID 对象。如果操作失败，则返回 NULL</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw: NoSuchFieldError  如果找不到指定的域</pre></td></tr><tr><td data-num="7"></td><td><pre>        ExceptionInInitializerError 如果由于异常而导致类初始化程序失败</pre></td></tr><tr><td data-num="8"></td><td><pre>        OutOfMemoryError 如果系统内存不足</pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr><tr><td data-num="10"></td><td><pre>jfieldID  <span class="token function">GetFieldID</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getmethodid"><a class="anchor" href="#getmethodid">#</a> GetMethodID</h4>
<p>返回类或接口实例（非静态）方法的方法 ID。方法可在某个 clazz 的超类中定义，也可从 clazz 继承。该方法由其名称和签名决定。 GetMethodID () 可使未初始化的类初始化。要获得构造函数的方法 ID，应将  <code>&lt;init&gt;</code>  作为方法名，同时将 void (V) 作为返回类型</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param name:  该方法的 Name 名称</pre></td></tr><tr><td data-num="4"></td><td><pre>@param sig:   该方法参数和返回值域签名     *</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 方法 ID，如果找不到指定的方法，则为 NULL</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw: NoSuchMethodError 如果找不到指定方法</pre></td></tr><tr><td data-num="7"></td><td><pre>        ExceptionInInitializerError 如果由于异常而导致类初始化程序失败</pre></td></tr><tr><td data-num="8"></td><td><pre>        OutOfMemoryError 如果系统内存不足</pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr><tr><td data-num="10"></td><td><pre>jmethodID <span class="token function">GetMethodID</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="getstaticfieldid"><a class="anchor" href="#getstaticfieldid">#</a> GetStaticFieldID</h4>
<p>获取类的静态域 ID 方法</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>jfieldID  <span class="token function">GetStaticFieldID</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span>jclass clazz<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="gettypefield"><a class="anchor" href="#gettypefield">#</a> Get[type]Field</h4>
<p>该例程系列返回对象的实例（非静态）域的值。要访问的域由通过调用 GetFieldID () 而得到的域 ID 指定。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: Java 对象（不能为 NULL）</pre></td></tr><tr><td data-num="3"></td><td><pre>@param fieldID: 有效的域 ID</pre></td></tr><tr><td data-num="4"></td><td><pre>@return:  属性的内容</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre>NativeType Get<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">Field</span> <span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfieldID fieldID<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 获取类对象静态域的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>NativeType GetStatic<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">Field</span> <span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span>env<span class="token punctuation">,</span> jclass classzz<span class="token punctuation">,</span> jfieldID fieldID<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th>Get[type]Field</th>
<th>NativeType</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetObjectField()</td>
<td>jobject</td>
</tr>
<tr>
<td>GetBooleanField()</td>
<td>jboolean</td>
</tr>
<tr>
<td>GetByteField()</td>
<td>jbyte</td>
</tr>
<tr>
<td>GetCharField()</td>
<td>jchar</td>
</tr>
<tr>
<td>GetShortField()</td>
<td>jshort</td>
</tr>
<tr>
<td>GetIntField()</td>
<td>jint</td>
</tr>
<tr>
<td>GetLongField()</td>
<td>jlong</td>
</tr>
<tr>
<td>GetFloatField()</td>
<td>jfloat</td>
</tr>
<tr>
<td>GetDoubleField()</td>
<td>jdouble</td>
</tr>
</tbody>
</table>
<h4 id="settypefield"><a class="anchor" href="#settypefield">#</a> Set[type]Field</h4>
<p>该惯用法设置对象的实例（非静态）属性的值。要访问的属性由通过调用 SetFieldID () 而得到的属性 ID 指定。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj: Java 对象（不能为 NULL）</pre></td></tr><tr><td data-num="3"></td><td><pre>@param fieldId: 有效的域 ID</pre></td></tr><tr><td data-num="4"></td><td><pre>@param value: 域的新值</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">void</span>  Set<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">Field</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfieldID fieldID<span class="token punctuation">,</span> NativeType value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 设置类的静态域的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">void</span>  SetStatic<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">Field</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass classzz<span class="token punctuation">,</span> jfieldID fieldID<span class="token punctuation">,</span> NativeType value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th>Set[type]Field</th>
<th>NativeType</th>
</tr>
</thead>
<tbody>
<tr>
<td>SetObjectField()</td>
<td>jobject</td>
</tr>
<tr>
<td>SetBooleanField()</td>
<td>jboolean</td>
</tr>
<tr>
<td>SetByteField()</td>
<td>jbyte</td>
</tr>
<tr>
<td>SetCharField()</td>
<td>jchar</td>
</tr>
<tr>
<td>SetShortField()</td>
<td>jshort</td>
</tr>
<tr>
<td>SetIntField()</td>
<td>jint</td>
</tr>
<tr>
<td>SetLongField()</td>
<td>jlong</td>
</tr>
<tr>
<td>SetFloatField()</td>
<td>jfloat</td>
</tr>
<tr>
<td>SetDoubleField()</td>
<td>jdouble</td>
</tr>
</tbody>
</table>
<h4 id="calltypemethod"><a class="anchor" href="#calltypemethod">#</a> Call[type]Method</h4>
<p>这三个操作的方法用于从本地方法调用 Java 实例方法。它们的差别仅在于向其所调用的方法传递参数时所用的机制。</p>
<p>这三个操作将根据所指定的 methodID 调用 Java 对象的实例（非静态）方法。参数 methodID 必须通过调用 GetMethodID () 来获得。当这些函数用于调用私有方法和构造函数时，methodID 必须从 obj 的真实类派生而来，而不应从其某个超类派生。当然，附加参数可以为空 。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param obj Java 对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param methodId 方法 ID</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>NativeType Call<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">Method</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jmethodID methodID<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 参数附加在函数后面，</span></pre></td></tr><tr><td data-num="6"></td><td><pre>NativeType Call<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">MethodA</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jmethodID methodID<span class="token punctuation">,</span> jvalue <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 参数以指针形式附加</span></pre></td></tr><tr><td data-num="7"></td><td><pre>NativeType Call<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token function">MethodV</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span>jmethodID methodID<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数以 "链表" 形式附加</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th>Call[type]Method&lt;A/V&gt;</th>
<th>NativeType</th>
</tr>
</thead>
<tbody>
<tr>
<td>CallVoidMethod()</td>
<td>无</td>
</tr>
<tr>
<td>CallObjectMethod()</td>
<td>jobect</td>
</tr>
<tr>
<td>CallBooleanMethod ()</td>
<td>jboolean</td>
</tr>
<tr>
<td>CallByteMethod()</td>
<td>jbyte</td>
</tr>
<tr>
<td>CallCharMethod()</td>
<td>jchar</td>
</tr>
<tr>
<td>CallShortMethod()</td>
<td>jshort</td>
</tr>
<tr>
<td>CallIntMethod()</td>
<td>jint</td>
</tr>
<tr>
<td>CallLongMethod()</td>
<td>jlong</td>
</tr>
<tr>
<td>CallFloatMethod()</td>
<td>jfloat</td>
</tr>
<tr>
<td>CallDoubleMethod()</td>
<td>jdouble</td>
</tr>
</tbody>
</table>
<h3 id="注册本地方法"><a class="anchor" href="#注册本地方法">#</a> 注册本地方法</h3>
<h4 id="registernatives"><a class="anchor" href="#registernatives">#</a> RegisterNatives</h4>
<p>向 clazz 参数指定的类注册本地方法。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: 目标类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@param methods: JNINativeMethod 结构数组，其中包含本地方法的名称、签名和函数指针</pre></td></tr><tr><td data-num="4"></td><td><pre>@param nMethods: methods 参数的长度</pre></td></tr><tr><td data-num="5"></td><td><pre>@return: 成功时返回 0；失败时返回负数</pre></td></tr><tr><td data-num="6"></td><td><pre>@throw:  NoSuchMethodError 如果找不到指定的方法或方法不是本地方法</pre></td></tr><tr><td data-num="7"></td><td><pre>*/</pre></td></tr><tr><td data-num="8"></td><td><pre>jint <span class="token function">RegisterNatives</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">,</span> <span class="token keyword">const</span> JNINativeMethod <span class="token operator">*</span>methods<span class="token punctuation">,</span> jint nMethods<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><details class="info"><summary>methods</summary><div>
<p>JNINativeMethod 定义如下：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>                       </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>          </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>signature<span class="token punctuation">;</span>               </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>fnPtr<span class="token punctuation">;</span>               </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> JNINativeMethod<span class="token punctuation">;</span></pre></td></tr></table></figure></div></details>
<h4 id="unregisternatives"><a class="anchor" href="#unregisternatives">#</a> UnregisterNatives</h4>
<p>反注册类的本地方法。类将返回到链接或注册了本地方法函数前的状态。该函数不应在本地代码中使用。相反，它可以为某些程序提供一种重新加载和重新链接本地库的途径。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>@param clazz: Java 类对象</pre></td></tr><tr><td data-num="3"></td><td><pre>@throw: 成功时返回 0；失败时返回负数</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre>jint <span class="token function">UnregisterNatives</span> <span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass clazz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="jobject-thiz"><a class="anchor" href="#jobject-thiz">#</a> jobject thiz</h1>
<p>当我们在 native 中注册一个 java 函数后，一般可以看到函数的声明都像下面这个样子</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">Java_com_oacia_loadso_MainActivity_hello</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject thiz<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// TODO: implement hello()</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>那么函数的第二个参数 <code>jobject thiz</code>  有什么作用呢？</p>
<p>我们不妨看一看 android studio 给我们的代码提示</p>
<p><img data-src="/android-JNI/image-20240710102719540.png" alt="image-20240710102719540" style="aspect-ratio:1198 / 127;"></p>
<p>这个 <code>thiz</code>  指向的是 native 函数声明所在的类</p>
<p>demo 如下，在 <code>MainActivity</code>  中的 <code>onCreate</code>  会对变量 s 赋值</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>oacia<span class="token punctuation">.</span>loadso</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">static</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">try</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">"oacia"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">"oacia_tag"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        s<span class="token operator">=</span><span class="token string">"change in create"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 JNI 中会通过 <code>jobject thiz</code>  读取变量 <code>s</code></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;jni.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdio.h"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">extern</span> <span class="token string">"C"</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;android/log.h></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TAG</span> <span class="token string">"oacia_tag"</span> <span class="token comment">// 这个是自定义的 LOG 的标识</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOGD</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">__android_log_print</span><span class="token punctuation">(</span>ANDROID_LOG_DEBUG<span class="token punctuation">,</span>TAG <span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span> </span><span class="token comment">// 定义 LOGD 类型</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOGI</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">__android_log_print</span><span class="token punctuation">(</span>ANDROID_LOG_INFO<span class="token punctuation">,</span>TAG <span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span> </span><span class="token comment">// 定义 LOGI 类型</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOGW</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">__android_log_print</span><span class="token punctuation">(</span>ANDROID_LOG_WARN<span class="token punctuation">,</span>TAG <span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span> </span><span class="token comment">// 定义 LOGW 类型</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOGE</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">__android_log_print</span><span class="token punctuation">(</span>ANDROID_LOG_ERROR<span class="token punctuation">,</span>TAG <span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span> </span><span class="token comment">// 定义 LOGE 类型</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOGF</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">__android_log_print</span><span class="token punctuation">(</span>ANDROID_LOG_FATAL<span class="token punctuation">,</span>TAG <span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span> </span><span class="token comment">// 定义 LOGF 类型</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>jint <span class="token function">JNI_OnLoad</span><span class="token punctuation">(</span>JavaVM<span class="token operator">*</span> vm<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> reserved __unused<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> JNI_VERSION_1_6<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>JNIEXPORT <span class="token keyword">void</span> JNICALL</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function">Java_com_oacia_loadso_MainActivity_hello</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject thiz<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// TODO: implement hello()</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    jclass clazz <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">GetObjectClass</span><span class="token punctuation">(</span>thiz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    jfieldID s_field <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">GetFieldID</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token string">"s"</span><span class="token punctuation">,</span><span class="token string">"Ljava/lang/String;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    jstring str <span class="token operator">=</span> <span class="token punctuation">(</span>jstring<span class="token punctuation">)</span>env<span class="token operator">-></span><span class="token function">GetObjectField</span><span class="token punctuation">(</span>thiz<span class="token punctuation">,</span>s_field<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">LOGD</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>env<span class="token operator">-></span><span class="token function">GetStringUTFChars</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>最终也是成功读取并打印出了经过修改后的变量 s 的值</p>
<p><img data-src="/android-JNI/image-20240710130611981.png" alt="image-20240710130611981" style="aspect-ratio:1063 / 38;"></p>
<h1 id="动态注册"><a class="anchor" href="#动态注册">#</a> 动态注册</h1>
<p>动态注册都是调用 <code>RegisterNatives</code>  来实现的 <code>JNINativeMethod</code>  内数组的三个参数分别代表 <code>函数名称</code> ， <code>函数签名</code> ， <code>主体函数</code></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>jint <span class="token function">RegisterNatives</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    jclass clazz <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">FindClass</span><span class="token punctuation">(</span><span class="token string">"com/oacia/loadso/MainActivity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">LOGE</span><span class="token punctuation">(</span><span class="token string">"con't find class: com/oacia/loadso/MainActivity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> JNI_ERR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    JNINativeMethod methods_MainActivity<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#123;</span><span class="token string">"stringFromJNI"</span><span class="token punctuation">,</span> <span class="token string">"()Ljava/lang/String;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> stringFromJNI<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#123;</span><span class="token string">"add"</span><span class="token punctuation">,</span>           <span class="token string">"(II)I"</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> add<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// int len = sizeof(methods_MainActivity) / sizeof(methods_MainActivity[0]);</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> env<span class="token operator">-></span><span class="token function">RegisterNatives</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> methods_MainActivity<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                                <span class="token keyword">sizeof</span><span class="token punctuation">(</span>methods_MainActivity<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>methods_MainActivity<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="native层调用java层函数"><a class="anchor" href="#native层调用java层函数">#</a> native 层调用 java 层函数</h1>
<p>native 调用 java 层的函数只需要四步就可以完成</p>
<ol>
<li>获取 class</li>
<li>获取函数签名</li>
<li>获取 class 的实例</li>
<li>调用函数</li>
</ol>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>jclass loadso <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">FindClass</span><span class="token punctuation">(</span><span class="token string">"com/oacia/loadso/MainActivity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>jmethodID MethodID <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">GetMethodID</span><span class="token punctuation">(</span>loadso<span class="token punctuation">,</span> <span class="token string">"logA"</span><span class="token punctuation">,</span> <span class="token string">"()V"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>jobject javaObject <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">AllocObject</span><span class="token punctuation">(</span>loadso<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>env<span class="token operator">-></span><span class="token function">CallVoidMethod</span><span class="token punctuation">(</span>javaObject<span class="token punctuation">,</span> MethodID<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2025-04-09 02:55:11" itemprop="dateModified" datetime="2025-04-09T02:55:11+08:00">2025-04-09</time>
  </span>
  <span id="android-JNI/" class="item leancloud_visitors" data-flag-title="安卓JNI学习" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>oacia <i class="ic i-at"><em>@</em></i>oaciaのBbBlog~
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://oacia.dev/android-JNI/" title="安卓JNI学习">https://oacia.dev/android-JNI/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/xianyu-capture/" itemprop="url" rel="prev" data-background-image="&#x2F;picture&#x2F;220180.webp" title="安卓APP抓包-以咸鱼为例">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>安卓APP抓包-以咸鱼为例</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/dexloader/" itemprop="url" rel="next" data-background-image="&#x2F;picture&#x2F;602214.webp" title="Android动态加载dex">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Android动态加载dex</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8android-studio%E4%B8%AD%E5%BC%80%E5%8F%91jni"><span class="toc-text"> 在 Android studio 中开发 JNI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 基本数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 引用数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jvalue%E7%B1%BB%E5%9E%8B"><span class="toc-text"> jvalue 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text"> 类型描述符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 其他常用类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#javavm"><span class="toc-text"> JavaVM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-text"> 定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#invocation-api"><span class="toc-text"> Invocation API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#destoryjavavm"><span class="toc-text"> DestoryJavaVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attachcurrentthread"><span class="toc-text"> AttachCurrentThread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attachcurrentthreadasdaemon"><span class="toc-text"> AttachCurrentThreadAsDaemon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detachcurrentthread"><span class="toc-text"> DetachCurrentThread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getenv"><span class="toc-text"> GetEnv</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#javavm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-text"> JavaVM 虚拟机加载流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text"> 创建虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%99%84%E5%8A%A0%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text"> 线程附加到虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%B1%E7%A6%BB%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text"> 脱离虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text"> 卸载虚拟机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96javavm%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 获取 JavaVM 接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jnienv"><span class="toc-text"> JNIEnv</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-text"> 定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jni%E5%87%BD%E6%95%B0"><span class="toc-text"> JNI 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-text"> 版本信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getversion"><span class="toc-text"> GetVersion</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%93%8D%E4%BD%9C"><span class="toc-text"> 类操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#defineclass"><span class="toc-text"> DefineClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findclass"><span class="toc-text"> FindClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getobjectclass"><span class="toc-text"> GetObjectClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getsuperclass"><span class="toc-text"> GetSuperclass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isassignablefrom"><span class="toc-text"> IsAssignableFrom</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%93%8D%E4%BD%9C"><span class="toc-text"> 异常操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#throw"><span class="toc-text"> Throw</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#thrownew"><span class="toc-text"> ThrowNew</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exceptionoccurred"><span class="toc-text"> ExceptionOccurred</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exceptiondescribe"><span class="toc-text"> ExceptionDescribe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exceptionclear"><span class="toc-text"> ExceptionClear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fatalerror"><span class="toc-text"> FatalError</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%8A%E5%B1%80%E9%83%A8%E5%BC%95%E7%94%A8"><span class="toc-text"> 全局及局部引用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#deleteweakglobalref"><span class="toc-text"> DeleteWeakGlobalRef</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newweakglobalref"><span class="toc-text"> NewWeakGlobalRef</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deletelocalref"><span class="toc-text"> DeleteLocalRef</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newlocalref"><span class="toc-text"> NewLocalRef</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deleteglobalref"><span class="toc-text"> DeleteGlobalRef</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newglobalref"><span class="toc-text"> NewGlobalRef</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C"><span class="toc-text"> 对象操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#issameobject"><span class="toc-text"> IsSameObject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isinstanceof"><span class="toc-text"> IsInstanceOf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getobjectclass-2"><span class="toc-text"> GetObjectClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newobject"><span class="toc-text"> NewObject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#allocobject"><span class="toc-text"> AllocObject</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-text"> 字符串操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getreleasestringcritical"><span class="toc-text"> Get&#x2F;ReleaseStringCritical</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringutfregion"><span class="toc-text"> GetStringUTFRegion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringregion"><span class="toc-text"> GetStringRegion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#releasestringutfchars"><span class="toc-text"> ReleaseStringUTFChars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringutfchars"><span class="toc-text"> GetStringUTFChars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringutflength"><span class="toc-text"> GetStringUTFLength</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newstringutf"><span class="toc-text"> NewStringUTF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#releasestringchars"><span class="toc-text"> ReleaseStringChars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringchars"><span class="toc-text"> GetStringChars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstringlength"><span class="toc-text"> GetStringLength</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newstring"><span class="toc-text"> NewString</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C"><span class="toc-text"> 数组操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setobjectarrayelement"><span class="toc-text"> SetObjectArrayElement</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getobjectarrayelement"><span class="toc-text"> GetObjectArrayElement</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newobjectarray"><span class="toc-text"> NewObjectArray</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getarraylength"><span class="toc-text"> GetArrayLength</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#newprimitivetypearray-routines"><span class="toc-text"> New[PrimitiveType]Array Routines</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getprimitivetypearrayelements"><span class="toc-text"> Get[PrimitiveType]ArrayElements</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#releaseprimitivetypearrayelements"><span class="toc-text"> Release[PrimitiveType]ArrayElements</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getprimitivetypearrayregion"><span class="toc-text"> Get[PrimitiveType]ArrayRegion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setprimitivetypearrayregion"><span class="toc-text"> Set[PrimitiveType]ArrayRegion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getprimitivearraycritical%E4%B8%8Ereleaseprimitivearraycritical"><span class="toc-text"> GetPrimitiveArrayCritical 与 ReleasePrimitiveArrayCritical</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-text"> 访问对象的属性和方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getstaticmethodid"><span class="toc-text"> GetStaticMethodID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getfieldid"><span class="toc-text"> GetFieldID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getmethodid"><span class="toc-text"> GetMethodID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getstaticfieldid"><span class="toc-text"> GetStaticFieldID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gettypefield"><span class="toc-text"> Get[type]Field</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#settypefield"><span class="toc-text"> Set[type]Field</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calltypemethod"><span class="toc-text"> Call[type]Method</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95"><span class="toc-text"> 注册本地方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#registernatives"><span class="toc-text"> RegisterNatives</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unregisternatives"><span class="toc-text"> UnregisterNatives</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jobject-thiz"><span class="toc-text"> jobject thiz</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C"><span class="toc-text"> 动态注册</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#native%E5%B1%82%E8%B0%83%E7%94%A8java%E5%B1%82%E5%87%BD%E6%95%B0"><span class="toc-text"> native 层调用 java 层函数</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="oacia"
      data-src="/images/avatar.jpg">
  
  <svg class="logo-overview" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 540.19 380.99">
    <g id="clips" fill= #00a99d; stroke="none">
      <clipPath id="o">
        <path d="M93.57,284c8,0,14.91-1,20.75-3,5.83-2,10.41-3.66,13.75-5,4.66-1.66,6.16-.75,4.5,2.75-1.67,3.5-4.67,6.42-9,8.75-2.34,1.34-6.09,2.84-11.25,4.5-5.17,1.67-11.09,2.5-17.75,2.5-.34,8.67-3.34,16.84-9,24.5-5.67,7.67-13.34,13.34-23,17-6,2.34-12.17,3.59-18.5,3.75-6.34,.17-12.17-.66-17.5-2.5-5.34-1.83-10.09-4.66-14.25-8.5-4.17-3.83-7.25-8.41-9.25-13.75-2-5.33-2.83-11-2.5-17s1.83-11.83,4.5-17.5c2.66-5.66,6.33-10.75,11-15.25,4.66-4.5,10.16-7.75,16.5-9.75,5.66-1.66,11.41-1.66,17.25,0,5.83,1.67,10.08,4.34,12.75,8,1.66,2.67,2.5,5.67,2.5,9,3-2,6.33-3,10-3h1c3.33,0,6.5,.84,9.5,2.5,3,1.67,5.33,4.5,7,8.5l1,3.5Zm-34,39.5c5.66-.66,10.33-3.83,14-9.5,3.66-5.66,5.33-12.16,5-19.5-4.67,.34-9.09-.41-13.25-2.25-4.17-1.83-6.42-4.58-6.75-8.25-.67-3,0-5.5,2-7.5-.67-2.66-2.75-5-6.25-7s-7.09-2.16-10.75-.5c-4.67,2-8.25,5.84-10.75,11.5-2.5,5.67-3.09,11.84-1.75,18.5,1.33,8,4.75,14.34,10.25,19,5.5,4.67,11.58,6.5,18.25,5.5Z"/>
      </clipPath>
      <clipPath id="a1">
        <path d="M176.06,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      <clipPath id="c">
        <path d="M250.06,280.5c4.66-7.66,12-13.16,22-16.5,10-3.33,19.83-3.66,29.5-1,7.66,2.34,13.5,5.67,17.5,10,4,4.34,5.83,8.5,5.5,12.5-.34,4.67-2.25,8.59-5.75,11.75-3.5,3.17-7.09,5.34-10.75,6.5-3.67,1.17-6.84,1.25-9.5,.25-2.67-1-3.34-3.16-2-6.5,2.66-8,2.75-14.58,.25-19.75-2.5-5.16-5.92-6.41-10.25-3.75-2.67,1.67-5,4.09-7,7.25-2,3.17-3.5,6.75-4.5,10.75s-1.42,8.09-1.25,12.25c.16,4.17,.75,7.92,1.75,11.25,1.33,4,3.66,7.42,7,10.25,3.33,2.84,7.16,4.67,11.5,5.5,4.33,.84,8.91,.67,13.75-.5,4.83-1.16,9.25-3.75,13.25-7.75,7.33-6.66,12.33-14.33,15-23,.33-1.66,1.16-2.91,2.5-3.75,1.33-.83,2.5-1.08,3.5-.75,1,.34,1.83,1.09,2.5,2.25,.66,1.17,.66,2.92,0,5.25-2.34,9.34-6.34,17-12,23-4.67,5.67-10.5,10.42-17.5,14.25-7,3.84-14.25,6.09-21.75,6.75-7.5,.67-14.84-.33-22-3-7.17-2.66-13.25-7.5-18.25-14.5-6-8.66-8.75-17.66-8.25-27,.5-9.33,2.25-16.66,5.25-22Z"/>
      </clipPath>
      <clipPath id="i_b">
        <path d="M393.06,330c-2.34,2.67-5.17,5.09-8.5,7.25-3.34,2.17-7.09,3.59-11.25,4.25-4.17,.67-8.59,.67-13.25,0-4.67-.66-9.17-2.33-13.5-5-4.67-2.66-7.67-7.58-9-14.75-1.34-7.16-1.83-14.66-1.5-22.5,.33-7.83,1.33-14.91,3-21.25,1.66-6.33,3.33-10.16,5-11.5,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,3.59,1.25,6.75-.17,3.17-.5,6.92-1,11.25-.5,4.34-1.09,8.92-1.75,13.75-.67,4.84-.67,9.42,0,13.75,.33,3.67,1.33,6.42,3,8.25,1.66,1.84,3.5,2.84,5.5,3,2,.17,4-.25,6-1.25s3.83-2.33,5.5-4c3-3.66,5.66-7.66,8-12,2.33-4.33,4.16-8.16,5.5-11.5,1-3.66,2.91-5.25,5.75-4.75,2.83,.5,3.75,3.09,2.75,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.34,8.59-10,14.25Z"/>
      </clipPath>
      <clipPath id="a2">
        <path d="M461.56,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      
    </g>
    <g
      id="strokes"
      fill="none"
      stroke=#96d7f5
      stroke-linecap="round"
      stroke-linejoin="round"
    >
    <path
    clip-path="url(#o)"
    class="oPath path"
    d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
    stroke-width="32.5"
    ></path>
    <path
      clip-path="url(#a1)"
      class="a1Path path"
      d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
      stroke-width="59"
    ></path>
    <path
      clip-path="url(#c)"
      class="cPath path"
      d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
      stroke-width="110"
    ></path>
    <path
      clip-path="url(#i_b)"
      class="i_bPath path"
      d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
      stroke-width="33"
    ></path>
    <path
      clip-path="url(#a2)"
      class="a2Path path"
      d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
      stroke-width="70"
    ></path>
    </g>
    <g
      id="strokes2"
      fill="none"
      stroke=#ff97b8
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path
        clip-path="url(#o)"
        class="oPath path"
        d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
        stroke-width="32.5"
      ></path>
      <path
        clip-path="url(#a1)"
        class="a1Path path"
        d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
        stroke-width="59"
      ></path>
      <path
        clip-path="url(#c)"
        class="cPath path"
        d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
        stroke-width="110"
      ></path>
      <path
        clip-path="url(#i_b)"
        class="i_bPath path"
        d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
        stroke-width="33"
      ></path>
      <path
        clip-path="url(#a2)"
        class="a2Path path"
        d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
        stroke-width="70"
      ></path>
    </g>
    <g class="dot-group">
      <path
        id="dot"
        fill=#ff97b8
        d="M362.58,182.21c4.66-.33,9.66,1.17,15,4.5,5.33,3.34,7.66,7.5,7,12.5-.67,2.34-1.92,4.92-3.75,7.75-1.84,2.84-4,5.5-6.5,8s-4.84,4.75-7,6.75c-2.17,2-3.75,3.17-4.75,3.5-2.67,1.67-5.34,2.25-8,1.75-2.67-.5-5-1.5-7-3s-3.59-3.33-4.75-5.5c-1.17-2.16-1.92-4.25-2.25-6.25-.34-2,.16-4.66,1.5-8,1.33-3.33,3.08-6.58,5.25-9.75,2.16-3.16,4.58-6,7.25-8.5,2.66-2.5,5.33-3.75,8-3.75Z"
      ></path>
    </g>
  </svg>
  <div class="description" itemprop="description">月遇从云 花遇和风</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">53</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">46</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29hY2lh" title="https:&#x2F;&#x2F;github.com&#x2F;oacia"><i class="ic i-github"></i></span>
      <a target="_blank" rel="noopener" href="https://twitter.com/oacia86" title="https:&#x2F;&#x2F;twitter.com&#x2F;oacia86" class="item twitter"><i class="ic i-twitter"></i></a>
      <span class="exturl item paper-plane" data-url="aHR0cHM6Ly90Lm1lL29hY2lh" title="https:&#x2F;&#x2F;t.me&#x2F;oacia"><i class="ic i-paper-plane"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOm9hY2lhODZAZ21haWwuY29t" title="mailto:oacia86@gmail.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about-oacia/" rel="section"><i class="ic i-user"></i>关于oacia</a>
  </li>

    
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-feather"></i>文章</a>
  </li>

    
  <li class="item">
    <a href="/TODOlist/" rel="section"><i class="ic i-clock"></i>要做的事</a>
  </li>

    
  <li class="item">
    <a href="/website_maintenance/" rel="section"><i class="ic i-calendar"></i>更新日志</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>小伙伴</a>
  </li>

    
  <li class="item">
    <a href="/music/" rel="section"><i class="ic i-music"></i>听会儿歌吧</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/xianyu-capture/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/dexloader/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2022 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">oacia @ oacia</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">968k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">14:40</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>



<script data-config type="text/javascript">
  var LOCAL = {
    path: 'android-JNI/',
    favicon: {
      show: "柚鳥ナツ",
      hide: "甘い幸せ"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>
<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>


<script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>
<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
