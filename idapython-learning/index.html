



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="qQVmgWozVe7BXoA15J3gAZpEA5dK168admH4U3W6PAk">
  <meta name="msvalidate.01" content="4902E39C0135E72DE537BCB0FE08B40A">
  <meta name="baidu-site-verification" content="codeva-CSYjpuVg5v">


<link rel="alternate" type="application/rss+xml" title="oaciaのBbBlog~" href="https://oacia.dev/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="oaciaのBbBlog~" href="https://oacia.dev/atom.xml" />
<link rel="alternate" type="application/json" title="oaciaのBbBlog~" href="https://oacia.dev/feed.json" />
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-regular.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/noto-serif-sc-v22-chinese-simplified_latin-700.woff2"
/>
<link
      rel="preload"
      as="font"
      type="font/woff2"
      crossorigin=""
      href="/fonts/font_1832207_igi8uaupcus.woff2"
/>
<link rel="preload" href="/background_picture/1_gongzi.webp" as="image" />
<link rel="preload" href="/background_picture/2_xiaoxia.webp" as="image" />
<link rel="preload" href="/background_picture/3_xingye.webp" as="image" />
<link rel="preload" href="/images/avatar.jpg" as="image" />



<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="idapython" />


<link rel="canonical" href="https://oacia.dev/idapython-learning/">


<meta name="description" content="IDApython 在日常逆向的过程中是十分重要的存在，过去零零散散的接触过一些 idapython, 但是我觉得还是有必要去系统的整理一下相关的函数，以便未来倘若忘记了可以快速通过这篇笔记回忆起来  # 官方文档  IDA Help: Alphabetical list of IDC functions IDAPython documentation  # IDApython 编写环境  Py">
<meta property="og:type" content="article">
<meta property="og:title" content="IDApython学习笔记">
<meta property="og:url" content="https://oacia.dev/idapython-learning/">
<meta property="og:site_name" content="oaciaのBbBlog~">
<meta property="og:description" content="IDApython 在日常逆向的过程中是十分重要的存在，过去零零散散的接触过一些 idapython, 但是我觉得还是有必要去系统的整理一下相关的函数，以便未来倘若忘记了可以快速通过这篇笔记回忆起来  # 官方文档  IDA Help: Alphabetical list of IDC functions IDAPython documentation  # IDApython 编写环境  Py">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oacia.dev/idapython-learning/image-20230727214455985.png">
<meta property="og:image" content="https://oacia.dev/idapython-learning/image-20230727214548246.png">
<meta property="og:image" content="https://oacia.dev/idapython-learning/image-20230727214648595.png">
<meta property="og:image" content="https://oacia.dev/idapython-learning/image-20230727214905476.png">
<meta property="og:image" content="https://oacia.dev/idapython-learning/image-20240719233943064.png">
<meta property="article:published_time" content="2023-08-24T10:14:21.000Z">
<meta property="article:modified_time" content="2025-04-08T18:55:11.706Z">
<meta property="article:author" content="oacia">
<meta property="article:tag" content="idapython">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oacia.dev/idapython-learning/image-20230727214455985.png">
<meta name="twitter:creator" content="@oacia86">


  <title>
IDApython学习笔记 |
oacia = oaciaのBbBlog~ = DEVIL or SWEET</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  var jq_151 = $.noConflict(true);
  var RENDERER = {
    INIT_CHERRY_BLOSSOM_COUNT : 30,
    MAX_ADDING_INTERVAL : 10,
    WATCH_INTERVAL : 300,
    
    init : function(){
      this.setParameters();
      this.reconstructMethods();
      this.setup();
      this.bindEvent();
      this.render();
    },
    setParameters : function(){
      this.$window = jq_151(window);
      this.$container = jq_151('#loading');
      this.$canvas = jq_151('<canvas />');
      this.context = this.$canvas.appendTo(this.$container).get(0).getContext('2d');
      this.cherries = [];
      this.watchIds = [];
    },
    reconstructMethods : function(){
      this.watchWindowSize = this.watchWindowSize.bind(this);
      this.jdugeToStopResize = this.jdugeToStopResize.bind(this);
      this.render = this.render.bind(this);
    },
    setup : function(){
      this.cherries.length = 0;
      this.watchIds.length = 0;
      this.width = this.$container.width();
      this.height = this.$container.height();
      this.$canvas.attr({width : this.width, height : this.height});
      this.maxAddingInterval = Math.round(this.MAX_ADDING_INTERVAL * 1000 / this.width);
      this.addingInterval = this.maxAddingInterval;
      this.createCherries();
    },
    createCherries : function(){
      for(var i = 0, length = Math.round(this.INIT_CHERRY_BLOSSOM_COUNT * this.width / 1000); i < length; i++){
        this.cherries.push(new CHERRY_BLOSSOM(this, true));
      }
    },
    watchWindowSize : function(){
      this.clearTimer();
      this.tmpWidth = window.width;
      this.tmpHeight = window.height;
      this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL));
    },
    clearTimer : function(){
      while(this.watchIds.length > 0){
        clearTimeout(this.watchIds.pop());
      }
    },
    jdugeToStopResize : function(){
      var width = window.width,
        height = window.height,
        stopped = (width == this.tmpWidth && height == this.tmpHeight);
        
      this.tmpWidth = width;
      this.tmpHeight = height;
      
      if(stopped){
        this.setup();
      }
    },
    bindEvent : function(){
      this.$window.on('resize', this.watchWindowSize);
    },
    render : function(){
      //console.log("render")

      if(jq_151(this.$container).css("display")!="none"){
        requestAnimationFrame(this.render);
      }
      
      this.context.clearRect(0, 0, this.width, this.height);
      
      this.cherries.sort(function(cherry1, cherry2){
        return cherry1.z - cherry2.z;
      });
      for(var i = this.cherries.length - 1; i >= 0; i--){
        if(!this.cherries[i].render(this.context)){
          this.cherries.splice(i, 1);
        }
      }
      if(--this.addingInterval == 0){
        this.addingInterval = this.maxAddingInterval;
        this.cherries.push(new CHERRY_BLOSSOM(this, false));
      }
    }
  };
  var CHERRY_BLOSSOM = function(renderer, isRandom){
    this.renderer = renderer;
    this.init(isRandom);
  };
  CHERRY_BLOSSOM.prototype = {
    FOCUS_POSITION : 300,
    FAR_LIMIT : 600,
    MAX_RIPPLE_COUNT : 100,
    RIPPLE_RADIUS : 100,
    SURFACE_RATE : 0.5,
    SINK_OFFSET : 20,
    
    init : function(isRandom){
      this.x = this.getRandomValue(-this.renderer.width, this.renderer.width);
      this.y = isRandom ? this.getRandomValue(0, this.renderer.height) : this.renderer.height * 1.5;
      this.z = this.getRandomValue(0, this.FAR_LIMIT);
      this.vx = this.getRandomValue(-2, 2);
      this.vy = -2;
      this.theta = this.getRandomValue(0, Math.PI * 2);
      this.phi = this.getRandomValue(0, Math.PI * 2);
      this.psi = 0;
      this.dpsi = this.getRandomValue(Math.PI / 600, Math.PI / 300);
      this.opacity = 0;
      this.endTheta = false;
      this.endPhi = false;
      this.rippleCount = 0;
      
      var axis = this.getAxis(),
        theta = this.theta + Math.ceil(-(this.y + this.renderer.height * this.SURFACE_RATE) / this.vy) * Math.PI / 500;
      theta %= Math.PI * 2;
      
      this.offsetY = 40 * ((theta <= Math.PI / 2 || theta >= Math.PI * 3 / 2) ? -1 : 1);
      this.thresholdY = this.renderer.height / 2 + this.renderer.height * this.SURFACE_RATE * axis.rate;
      this.entityColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.entityColor.addColorStop(0, 'hsl(330, 70%, ' + 50 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(0.05, 'hsl(330, 40%,' + 55 * (0.3 + axis.rate) + '%)');
      this.entityColor.addColorStop(1, 'hsl(330, 20%, ' + 70 * (0.3 + axis.rate) + '%)');
      this.shadowColor = this.renderer.context.createRadialGradient(0, 40, 0, 0, 40, 80);
      this.shadowColor.addColorStop(0, 'hsl(330, 40%, ' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(0.05, 'hsl(330, 40%,' + 30 * (0.3 + axis.rate) + '%)');
      this.shadowColor.addColorStop(1, 'hsl(330, 20%, ' + 40 * (0.3 + axis.rate) + '%)');
    },
    getRandomValue : function(min, max){
      return min + (max - min) * Math.random();
    },
    getAxis : function(){
      var rate = this.FOCUS_POSITION / (this.z + this.FOCUS_POSITION),
        x = this.renderer.width / 2 + this.x * rate,
        y = this.renderer.height / 2 - this.y * rate;
      return {rate : rate, x : x, y : y};
    },
    renderCherry : function(context, axis){
      context.beginPath();
      context.moveTo(0, 40);
      context.bezierCurveTo(-60, 20, -10, -60, 0, -20);
      context.bezierCurveTo(10, -60, 60, 20, 0, 40);
      context.fill();
      
      for(var i = -4; i < 4; i++){
        context.beginPath();
        context.moveTo(0, 40);
        context.quadraticCurveTo(i * 12, 10, i * 4, -24 + Math.abs(i) * 2);
        context.stroke();
      }
    },
    render : function(context){
      var axis = this.getAxis();
      
      if(axis.y == this.thresholdY && this.rippleCount < this.MAX_RIPPLE_COUNT){
        context.save();
        context.lineWidth = 2;
        context.strokeStyle = 'hsla(0, 0%, 100%, ' + (this.MAX_RIPPLE_COUNT - this.rippleCount) / this.MAX_RIPPLE_COUNT + ')';
        context.translate(axis.x + this.offsetY * axis.rate * (this.theta <= Math.PI ? -1 : 1), axis.y);
        context.scale(1, 0.3);
        context.beginPath();
        context.arc(0, 0, this.rippleCount / this.MAX_RIPPLE_COUNT * this.RIPPLE_RADIUS * axis.rate, 0, Math.PI * 2, false);
        context.stroke();
        context.restore();
        this.rippleCount++;
      }
      if(axis.y < this.thresholdY || (!this.endTheta || !this.endPhi)){
        if(this.y <= 0){
          this.opacity = Math.min(this.opacity + 0.01, 1);
        }
        context.save();
        context.globalAlpha = this.opacity;
        context.fillStyle = this.shadowColor;
        context.strokeStyle = 'hsl(330, 30%,' + 40 * (0.3 + axis.rate) + '%)';
        context.translate(axis.x, Math.max(axis.y, this.thresholdY + this.thresholdY - axis.y));
        context.rotate(Math.PI - this.theta);
        context.scale(axis.rate * -Math.sin(this.phi), axis.rate);
        context.translate(0, this.offsetY);
        this.renderCherry(context, axis);
        context.restore();
      }
      context.save();
      context.fillStyle = this.entityColor;
      context.strokeStyle = 'hsl(330, 40%,' + 70 * (0.3 + axis.rate) + '%)';
      context.translate(axis.x, axis.y + Math.abs(this.SINK_OFFSET * Math.sin(this.psi) * axis.rate));
      context.rotate(this.theta);
      context.scale(axis.rate * Math.sin(this.phi), axis.rate);
      context.translate(0, this.offsetY);
      this.renderCherry(context, axis);
      context.restore();
      
      if(this.y <= -this.renderer.height / 4){
        if(!this.endTheta){
          for(var theta = Math.PI / 2, end = Math.PI * 3 / 2; theta <= end; theta += Math.PI){
            if(this.theta < theta && this.theta + Math.PI / 200 > theta){
              this.theta = theta;
              this.endTheta = true;
              break;
            }
          }
        }
        if(!this.endPhi){
          for(var phi = Math.PI / 8, end = Math.PI * 7 / 8; phi <= end; phi += Math.PI * 3 / 4){
            if(this.phi < phi && this.phi + Math.PI / 200 > phi){
              this.phi = Math.PI / 8;
              this.endPhi = true;
              break;
            }
          }
        }
      }
      if(!this.endTheta){
        if(axis.y == this.thresholdY){
          this.theta += Math.PI / 200 * ((this.theta < Math.PI / 2 || (this.theta >= Math.PI && this.theta < Math.PI * 3 / 2)) ? 1 : -1);
        }else{
          this.theta += Math.PI / 500;
        }
        this.theta %= Math.PI * 2;
      }
      if(this.endPhi){
        if(this.rippleCount == this.MAX_RIPPLE_COUNT){
          this.psi += this.dpsi;
          this.psi %= Math.PI * 2;
        }
      }else{
        this.phi += Math.PI / ((axis.y == this.thresholdY) ? 200 : 500);
        this.phi %= Math.PI;
      }
      if(this.y <= -this.renderer.height * this.SURFACE_RATE){
        this.x += 2;
        this.y = -this.renderer.height * this.SURFACE_RATE;
      }else{
        this.x += this.vx;
        this.y += this.vy;
      }
      return this.z > -this.FOCUS_POSITION && this.z < this.FAR_LIMIT && this.x < this.renderer.width * 1.5;
    }
  };
  jq_151(function(){
    RENDERER.init();
  });
</script>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <!--
    <div class="alice">
      <img src="/images/alice-shake.gif" alt="">
    </div>

    
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
    -->
  </div>
  <script
      defer="defer"
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"
      integrity="sha512-1dalHDkG9EtcOmCnoCjiwQ/HEB5SDNqw8d4G2MKoNwjiwMNeBAkudsBCmSlMnXdsH8Bm0mOd3tl/6nL5y0bMaQ=="
      crossorigin="anonymous"
    ></script>
  <script defer="defer" src="/js/gsap/DrawSVGPlugin.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomEase.min.js"></script>
  <script defer="defer" src="/js/gsap/CustomBounce.min.js"></script>
  <script defer="defer" src="/js/gsap/SplitText.min.js"></script>
  <script defer="defer" src="/js/gsap/logo-run.js"></script>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">IDApython学习笔记
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2023-08-24 18:14:21">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2023-08-24T18:14:21+08:00">2023-08-24</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>26k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>24 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">oacia</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/background_picture/1_mary.jpg"></li>
          <li class="item" data-background-image="/background_picture/2_xingye.webp"></li>
          <li class="item" data-background-image="/background_picture/3_xiaoxia.webp"></li>
          <li class="item" data-background-image="/background_picture/4_alice.webp"></li>
          <li class="item" data-background-image="/background_picture/5_mutsuki.jpg"></li>
          <li class="item" data-background-image="/background_picture/6_arona_plana.webp"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb">
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://oacia.dev/idapython-learning/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="oacia">
    <meta itemprop="description" content="DEVIL or SWEET, 月遇从云 花遇和风">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="oaciaのBbBlog~">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>IDApython 在日常逆向的过程中是十分重要的存在，过去零零散散的接触过一些 idapython, 但是我觉得还是有必要去系统的整理一下相关的函数，以便未来倘若忘记了可以快速通过这篇笔记回忆起来</p>
</blockquote>
<h1 id="官方文档"><a class="anchor" href="#官方文档">#</a> 官方文档</h1>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9oZXgtcmF5cy5jb20vcHJvZHVjdHMvaWRhL3N1cHBvcnQvaWRhZG9jLzE2Mi5zaHRtbA==">IDA Help: Alphabetical list of IDC functions</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuaGV4LXJheXMuY29tL3Byb2R1Y3RzL2lkYS9zdXBwb3J0L2lkYXB5dGhvbl9kb2NzLw==">IDAPython documentation</span></li>
</ul>
<h1 id="idapython编写环境"><a class="anchor" href="#idapython编写环境">#</a> IDApython 编写环境</h1>
<ul>
<li>PyCharm 2021.2.3 社区版</li>
<li>IDA7.7</li>
<li>python3.8</li>
</ul>
<p>由于 IDA 自带的 IDE 没有代码补全十分的难用，所以我准备在 <code>PyCharm</code>  中编写 IDApython 代码</p>
<p>在 pycharm 中进入到 <code>文件--&gt;设置--&gt;项目: xxx.py--&gt;Python解释器</code> ，然后点击此处的 <code>全部显示</code> 如图</p>
<p><img data-src="/idapython-learning/image-20230727214455985.png" alt="image-20230727214455985" style="aspect-ratio:1227 / 891;"></p>
<p>然后点击该位置来添加自定义路径</p>
<p><img data-src="/idapython-learning/image-20230727214548246.png" alt="image-20230727214548246" style="aspect-ratio:782 / 762;"></p>
<p>将 <code>IDA安装路径\python\3</code>  添加至解释器路径中如图</p>
<p><img data-src="/idapython-learning/image-20230727214648595.png" alt="image-20230727214648595" style="aspect-ratio:779 / 603;"></p>
<p>点击确定之后，在 <code>Pycharm</code>  中即可实现 <code>IDApython</code>  代码补全</p>
<p><img data-src="/idapython-learning/image-20230727214905476.png" alt="image-20230727214905476" style="aspect-ratio:808 / 466;"></p>
<hr>
<p>当然啦，我们也可以直接在 windows 中添加 <code>PYTHONPATH</code>  的环境变量，同样可以做到 idapython 的代码补全</p>
<p><img data-src="/idapython-learning/image-20240719233943064.png" alt="image-20240719233943064" style="aspect-ratio:634 / 155;"></p>
<h1 id="地址-address"><a class="anchor" href="#地址-address">#</a> 地址 address</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>get_screen_ea<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#获取当前光标所在地址</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>get_inf_attr<span class="token punctuation">(</span>INF_MAX_EA<span class="token punctuation">)</span><span class="token comment">#获取本文件的最大地址</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>idc<span class="token punctuation">.</span>get_inf_attr<span class="token punctuation">(</span>INF_MIN_EA<span class="token punctuation">)</span><span class="token comment">#获取本文件的最小地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>idaapi<span class="token punctuation">.</span>get_imagebase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#获取文件的基址</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token operator">/</span>idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#获取下一条 / 上一条指令的地址</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 判断当前地址是否在程序中存在</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> idaapi<span class="token punctuation">.</span>BADADDR <span class="token operator">!=</span> ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"valid address"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="反汇编-disasm"><a class="anchor" href="#反汇编-disasm">#</a> 反汇编 disasm</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>GetDisasm<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#获取某一个地址的反编译汇编指令</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#返回助记符，get mnemonic</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token comment">#返回第 n + 1 个参数</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token comment">#返回第 n + 1 个参数的数值形式</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>idc<span class="token punctuation">.</span>get_item_size<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#获取某行汇编的长度</span></pre></td></tr></table></figure><p>举个例子</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ea <span class="token operator">=</span> here<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>idc<span class="token punctuation">.</span>GetDisasm<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># mov eax, [rbp+var_4]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># mov</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># eax</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># [rbp+var_4]</span></pre></td></tr></table></figure><h1 id="段-segment"><a class="anchor" href="#段-segment">#</a> 段 segment</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>get_segm_name<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#获取地址所在段的段名</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>idc<span class="token punctuation">.</span>get_segm_start<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token operator">/</span>idc<span class="token punctuation">.</span>get_segm_end<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#获取地址所在段起始 / 结束地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>idautils<span class="token punctuation">.</span>Segments<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#获取所有的段首地址</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>idc<span class="token punctuation">.</span>get_first_seg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>idc<span class="token punctuation">.</span>get_next_seg<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 获取第一个段 / 下一个段的地址</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>idc<span class="token punctuation">.</span>get_segm_attr<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>attr<span class="token punctuation">)</span><span class="token operator">/</span>idc<span class="token punctuation">.</span>set_segm_attr<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>attr<span class="token punctuation">,</span>value<span class="token punctuation">)</span> <span class="token comment"># 获取 / 设置函数的属性</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">'.text'</span><span class="token punctuation">)</span><span class="token comment">#通过 name 来获取段对象</span></pre></td></tr></table></figure><p>举个例子</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#遍历所有的段</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> idautils<span class="token punctuation">.</span>Segments<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"%s:\t0x%x\t0x%x"</span></span> <span class="token operator">%</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>          idc<span class="token punctuation">.</span>get_segm_name<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>          idc<span class="token punctuation">.</span>get_segm_start<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>          idc<span class="token punctuation">.</span>get_segm_end<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 通过名称来获取段对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sg <span class="token operator">=</span> ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">'.text'</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>sg<span class="token punctuation">.</span>start_ea<span class="token punctuation">,</span>sg<span class="token punctuation">.</span>end_ea<span class="token punctuation">,</span>sg<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="函数-function"><a class="anchor" href="#函数-function">#</a> 函数 function</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>get_func_name<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#通过地址获取函数名</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token comment">#通过地址获取地址所在的函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>idc<span class="token punctuation">.</span>get_next_func<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token operator">/</span>idc<span class="token punctuation">.</span>get_prev_func<span class="token punctuation">(</span>ea<span class="token punctuation">)</span> <span class="token comment"># 获取当前函数的前一个 / 后一个函数的地址</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>idautils<span class="token punctuation">.</span>Functions<span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token comment">#获取所有函数的首地址，若没有参数，则默认从头到尾</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>idc<span class="token punctuation">.</span>get_func_attr<span class="token punctuation">(</span>func<span class="token punctuation">,</span> FUNCATTR_FLAGS<span class="token punctuation">)</span><span class="token comment">#检索函数的信息</span></pre></td></tr></table></figure><p>举个例子</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#遍历所有函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> func <span class="token keyword">in</span> idautils<span class="token punctuation">.</span>Functions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> idc<span class="token punctuation">.</span>get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#获取函数的起始 / 结束地址</span></pre></td></tr><tr><td data-num="2"></td><td><pre>func <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>start_ea<span class="token punctuation">,</span> func<span class="token punctuation">.</span>end_ea<span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#检索关于函数的信息，来判断该函数是否是库中代码，或者函数是否有返回值等等</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> func <span class="token keyword">in</span> idautils<span class="token punctuation">.</span>Functions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#获取所有已知的函数首地址</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    flags <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_func_attr<span class="token punctuation">(</span>func<span class="token punctuation">,</span> FUNCATTR_FLAGS<span class="token punctuation">)</span><span class="token comment">#获取标志</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_NORET<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"FUNC_NORET"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_FAR<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_FAR"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_LIB<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_LIB"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_STATIC<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_STATIC"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_FRAME<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_FRAME"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_USERFAR<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_USERFAR"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_HIDDEN<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_HIDDEN"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_THUNK<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_THUNK"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> flags <span class="token operator">&amp;</span> FUNC_LIB<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> get_func_name<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"FUNC_BOTTOMBP"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>各个函数标志的含义如下</p>
<table>
<thead>
<tr>
<th>函数标志</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>FUNC_NORET</td>
<td>这个标志表示某个函数是否有返回值，它本身的值是 1，下面是一个没有返回值的函数，注意它没有函数的最后并不是  <code>ret</code>  或者  <code>leave</code>  指令。</td>
</tr>
<tr>
<td>FUNC_FAR</td>
<td>这个标志非常少的出现，标志程序是否使用分段内存，它的值为 2。</td>
</tr>
<tr>
<td>FUNC_USERFAR</td>
<td>少见</td>
</tr>
<tr>
<td>FUNC_LIB</td>
<td>这个表示用于寻找库函数的代码。识别库函数代码是非常有必要的，因为我们在分析的时候一般将其跳过，它的值是 4。</td>
</tr>
<tr>
<td>FUNC_STATIC</td>
<td>静态函数</td>
</tr>
<tr>
<td>FUNC_FRAME</td>
<td>这个标志表示函数是否使用了 ebp 寄存器 (帧指针)，使用 ebp 寄存器的函数通常有如下的语法设定，目的是为了保存栈帧。</td>
</tr>
<tr>
<td>FUNC_BOTTOMBP</td>
<td>和 FUNC_FRAME 一样，该标志用于跟踪帧指针 (ebp)。它作用是识别函数中帧指针是 否等于堆栈指针 (esp)。</td>
</tr>
<tr>
<td>FUNC_HIDDEN</td>
<td>带有 FUNC_HIDDEN 标志的函数意味着它们是隐藏的，这个函数需要展开才能查看。如 果我们跳转到一个标记为 HIDDEN 的地址的话，它会自动的展开。</td>
</tr>
<tr>
<td>FUNC_THUNK</td>
<td>表示这个函数是否是一个 thunk 函数，thunk 函数表示的是一个简单的跳转函数。</td>
</tr>
</tbody>
</table>
<h1 id="块-block"><a class="anchor" href="#块-block">#</a> 块 block</h1>
<p>遍历一个函数中的块</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idaapi</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> idc</pre></td></tr><tr><td data-num="3"></td><td><pre>f_blocks <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>FlowChart<span class="token punctuation">(</span>idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span><span class="token number">0x401E80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>idaapi<span class="token punctuation">.</span>FC_PREDS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> block <span class="token keyword">in</span> f_blocks<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>start_ea<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>end_ea<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>block<span class="token punctuation">.</span>end_ea<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>block<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token comment"># 特别注意，block.end_ea 表示下一个块的起始地址，并不是当前块的结束地址！！，idc.prev_head (block.end_ea) 才是获取这个块的结束地址</span></pre></td></tr></table></figure><p>获取 block 的前驱块</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idaapi</pre></td></tr><tr><td data-num="2"></td><td><pre>f_blocks <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>FlowChart<span class="token punctuation">(</span>idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span><span class="token number">0x401E80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>idaapi<span class="token punctuation">.</span>FC_PREDS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>block <span class="token operator">=</span> f_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 获取当前块的前驱块</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> pred <span class="token keyword">in</span> block<span class="token punctuation">.</span>preds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"前驱块"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>pred<span class="token punctuation">.</span>start_ea<span class="token punctuation">)</span><span class="token punctuation">,</span>pred<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>获取 block 的后继块</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idaapi</pre></td></tr><tr><td data-num="2"></td><td><pre>f_blocks <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>FlowChart<span class="token punctuation">(</span>idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span><span class="token number">0x401E80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>idaapi<span class="token punctuation">.</span>FC_PREDS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>block <span class="token operator">=</span> f_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 获取当前块的后继块</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> succ <span class="token keyword">in</span> block<span class="token punctuation">.</span>succs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"后继块"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>succ<span class="token punctuation">.</span>start_ea<span class="token punctuation">)</span><span class="token punctuation">,</span>succ<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>获取块的开始地址和结束地址</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idaapi</pre></td></tr><tr><td data-num="2"></td><td><pre>f_blocks <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>FlowChart<span class="token punctuation">(</span>idaapi<span class="token punctuation">.</span>get_func<span class="token punctuation">(</span><span class="token number">0x401E80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>idaapi<span class="token punctuation">.</span>FC_PREDS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>block <span class="token operator">=</span> f_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token builtin">hex</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>start_ea<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">hex</span> <span class="token punctuation">(</span>idc<span class="token punctuation">.</span>prev_head <span class="token punctuation">(</span>block<span class="token punctuation">.</span>end_ea<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 获取块的开始地址 / 结束地址</span></pre></td></tr></table></figure><h1 id="操作数"><a class="anchor" href="#操作数">#</a> 操作数</h1>
<p>可以通过 <code>idc.get_operand_type(curr_addr, n)</code>  获取第 n+1 个操作数的类型，返回值有八种情况，值和含义如下</p>
<table>
<thead>
<tr>
<th>操作数</th>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>o_void</td>
<td>0</td>
<td>指令没有任何操作数，如 <code>retn</code></td>
</tr>
<tr>
<td>o_reg</td>
<td>1</td>
<td>操作数是寄存器</td>
</tr>
<tr>
<td>o_mem</td>
<td>2</td>
<td>操作数是直接寻址的内存，这种类型对寻找 DATA 的引用非常有帮助。如  <code>cmp ds:dword_A152B8, 0</code></td>
</tr>
<tr>
<td>o_phrase</td>
<td>3</td>
<td>操作数是利用基址寄存器和变址寄存器的寻址操作的话，如 <code>mov [edi+ecx], eax</code></td>
</tr>
<tr>
<td>o_displ</td>
<td>4</td>
<td>操作数是利用寄存器和位移的寻址操作的话，如 <code>mov eax, [edi+18h]</code></td>
</tr>
<tr>
<td>o_imm</td>
<td>5</td>
<td>操作数是一个确定的数值，如  <code>add esp, 0Ch</code></td>
</tr>
<tr>
<td>o_far</td>
<td>6</td>
<td>这种返回类型在 x86 和 x86_64 的逆向中不常见。它用来判断直接访问远端地址的操作数</td>
</tr>
<tr>
<td>o_near</td>
<td>7</td>
<td>这种返回类型在 x86 和 x86_64 的逆向中不常见。它用来判断直接访问近端地址的操作数</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 判断在 curr_addr 的指令的第一个操作数的类型是否为利用寄存器和位移的寻址操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>insn <span class="token operator">=</span> ida_ua<span class="token punctuation">.</span>insn_t<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>idaapi<span class="token punctuation">.</span>decode_insn<span class="token punctuation">(</span>insn<span class="token punctuation">,</span> curr_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">if</span> insn<span class="token punctuation">.</span>Op1<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> idaapi<span class="token punctuation">.</span>o_displ<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第一个操作数的类型是利用寄存器和位移的寻址操作!"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># insn 的各个属性</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Python<span class="token operator">></span><span class="token builtin">dir</span><span class="token punctuation">(</span>insn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token string">'Op1'</span><span class="token punctuation">,</span> <span class="token string">'Op2'</span><span class="token punctuation">,</span> <span class="token string">'Op3'</span><span class="token punctuation">,</span> <span class="token string">'Op4'</span><span class="token punctuation">,</span> <span class="token string">'Op5'</span><span class="token punctuation">,</span> <span class="token string">'Op6'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__get_auxpref__'</span><span class="token punctuation">,</span> <span class="token string">'__get_operand__'</span><span class="token punctuation">,</span> <span class="token string">'__get_ops__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__set_auxpref__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__swig_destroy__'</span><span class="token punctuation">,</span> <span class="token string">'__weakref__'</span><span class="token punctuation">,</span> <span class="token string">'add_cref'</span><span class="token punctuation">,</span> <span class="token string">'add_dref'</span><span class="token punctuation">,</span> <span class="token string">'add_off_drefs'</span><span class="token punctuation">,</span> <span class="token string">'assign'</span><span class="token punctuation">,</span> <span class="token string">'auxpref'</span><span class="token punctuation">,</span> <span class="token string">'create_op_data'</span><span class="token punctuation">,</span> <span class="token string">'create_stkvar'</span><span class="token punctuation">,</span> <span class="token string">'cs'</span><span class="token punctuation">,</span> <span class="token string">'ea'</span><span class="token punctuation">,</span> <span class="token string">'flags'</span><span class="token punctuation">,</span> <span class="token string">'get_canon_feature'</span><span class="token punctuation">,</span> <span class="token string">'get_canon_mnem'</span><span class="token punctuation">,</span> <span class="token string">'get_next_byte'</span><span class="token punctuation">,</span> <span class="token string">'get_next_dword'</span><span class="token punctuation">,</span> <span class="token string">'get_next_qword'</span><span class="token punctuation">,</span> <span class="token string">'get_next_word'</span><span class="token punctuation">,</span> <span class="token string">'insnpref'</span><span class="token punctuation">,</span> <span class="token string">'ip'</span><span class="token punctuation">,</span> <span class="token string">'is_64bit'</span><span class="token punctuation">,</span> <span class="token string">'is_canon_insn'</span><span class="token punctuation">,</span> <span class="token string">'is_macro'</span><span class="token punctuation">,</span> <span class="token string">'itype'</span><span class="token punctuation">,</span> <span class="token string">'ops'</span><span class="token punctuation">,</span> <span class="token string">'segpref'</span><span class="token punctuation">,</span> <span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'thisown'</span><span class="token punctuation">]</span></pre></td></tr></table></figure><h1 id="搜索"><a class="anchor" href="#搜索">#</a> 搜索</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>FindBinary<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>flag<span class="token punctuation">,</span> searchstr<span class="token punctuation">,</span> radix<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token comment">#字节或者二进制的搜索</span></pre></td></tr></table></figure><p><code>idc.FindBinary(ea,flag, searchstr, radix=16)</code>  中 <code>flag</code>  的各个类型的含义</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>SEARCH_UP</td>
<td>0</td>
<td>向上搜索</td>
</tr>
<tr>
<td>SEARCH_DOWN</td>
<td>1</td>
<td>向下搜索</td>
</tr>
<tr>
<td>SEARCH_NEXT</td>
<td>2</td>
<td>获取下一个已经找到的对象</td>
</tr>
<tr>
<td>SEARCH_CASE</td>
<td>4</td>
<td>指明是否区分大小写</td>
</tr>
<tr>
<td>SEARCH_REGEX</td>
<td>8</td>
<td>正则搜索</td>
</tr>
<tr>
<td>SEARCH_NOBRK</td>
<td colspan="2">16</td>
</tr>
<tr>
<td>SEARCH_NOSHOW</td>
<td>32</td>
<td>指明是否显示搜索的进度</td>
</tr>
<tr>
<td>SEARCH_UNICODE</td>
<td>64</td>
<td>将所有搜索字符串视为 Unicode</td>
</tr>
<tr>
<td>SEARCH_IDENT</td>
<td colspan="2">128</td>
</tr>
<tr>
<td>SEARCH_BRK</td>
<td colspan="2">256</td>
</tr>
</tbody>
</table>
<p>举个例子</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pattern <span class="token operator">=</span> <span class="token string">'55 48 89 E5'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>addr <span class="token operator">=</span> ida_ida<span class="token punctuation">.</span>inf_get_min_ea<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>find_binary<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> SEARCH_DOWN<span class="token operator">|</span>SEARCH_NEXT<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> addr <span class="token operator">!=</span> idc<span class="token punctuation">.</span>BADADDR<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> idc<span class="token punctuation">.</span>GetDisasm<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="数据"><a class="anchor" href="#数据">#</a> 数据</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ida_bytes<span class="token punctuation">.</span>get_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span>size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ida_bytes<span class="token punctuation">.</span>get_byte<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ida_bytes<span class="token punctuation">.</span>get_word<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ida_bytes<span class="token punctuation">.</span>get_dword<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="动态调试"><a class="anchor" href="#动态调试">#</a> 动态调试</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>idc<span class="token punctuation">.</span>add_bpt<span class="token punctuation">(</span><span class="token builtin">long</span> Address<span class="token punctuation">)</span><span class="token comment">#在指定的地址设置断点</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>idc<span class="token punctuation">.</span>get_reg_value<span class="token punctuation">(</span>string Register<span class="token punctuation">)</span><span class="token comment">#获取一个寄存器的名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>idc<span class="token punctuation">.</span>set_reg_value<span class="token punctuation">(</span><span class="token builtin">long</span> Value<span class="token punctuation">,</span> string Register<span class="token punctuation">)</span><span class="token comment">#设置寄存器的值</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>idc<span class="token punctuation">.</span>run_to<span class="token punctuation">(</span><span class="token builtin">long</span> Address<span class="token punctuation">)</span><span class="token comment">#运行到指定的地址，然后停下。</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>idc<span class="token punctuation">.</span>wait_for_next_event<span class="token punctuation">(</span>wfne<span class="token punctuation">,</span>timeout<span class="token punctuation">)</span><span class="token comment">#等待下一个事件，此函数会继续执行进程，并等待调试器事件直到超时</span></pre></td></tr></table></figure><p>在 <code>idc.wait_for_next_event(wfne,timeout)</code>  中参数即返回值的标志如下</p>
<ul>
<li>
<p><code>wfne</code>  标志</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// wfne flag is combination of the following:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_ANY</span>    <span class="token expression"><span class="token number">0x0001</span> </span><span class="token comment">// return the first event (even if it doesn't suspend the process)</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>                           <span class="token comment">// if the process is still running, the database</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                           <span class="token comment">// does not reflect the memory state. you might want</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                           <span class="token comment">// to call refresh_debugger_memory() in this case</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_SUSP</span>   <span class="token expression"><span class="token number">0x0002</span> </span><span class="token comment">// wait until the process gets suspended</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_SILENT</span> <span class="token expression"><span class="token number">0x0004</span> </span><span class="token comment">// 1: be slient, 0:display modal boxes if necessary</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_CONT</span>   <span class="token expression"><span class="token number">0x0008</span> </span><span class="token comment">// continue from the suspended state</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_NOWAIT</span> <span class="token expression"><span class="token number">0x0010</span> </span><span class="token comment">// do not wait for any event, immediately return DEC_TIMEOUT</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>                           <span class="token comment">// (to be used with WFNE_CONT)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WFNE_USEC</span>   <span class="token expression"><span class="token number">0x0020</span> </span><span class="token comment">// timeout is specified in microseconds</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>                           <span class="token comment">// (minimum non-zero timeout is 40000us)</span></pre></td></tr></table></figure></li>
<li>
<p><code>timeout</code> ，等待的秒数，-1 为无限大</p>
</li>
<li>
<p>返回值 <code>debugger event codes</code></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// debugger event codes</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NOTASK</span>         <span class="token expression"><span class="token operator">-</span><span class="token number">2</span>            </span><span class="token comment">// process does not exist</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBG_ERROR</span>      <span class="token expression"><span class="token operator">-</span><span class="token number">1</span>            </span><span class="token comment">// error (e.g. network problems)</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBG_TIMEOUT</span>     <span class="token expression"><span class="token number">0</span>            </span><span class="token comment">// timeout</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_STARTED</span>   <span class="token expression"><span class="token number">0x00000001</span> </span><span class="token comment">// New process started</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_EXITED</span>    <span class="token expression"><span class="token number">0x00000002</span> </span><span class="token comment">// Process stopped</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">THREAD_STARTED</span>    <span class="token expression"><span class="token number">0x00000004</span> </span><span class="token comment">// New thread started</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">THREAD_EXITED</span>     <span class="token expression"><span class="token number">0x00000008</span> </span><span class="token comment">// Thread stopped</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BREAKPOINT</span>        <span class="token expression"><span class="token number">0x00000010</span> </span><span class="token comment">// Breakpoint reached</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STEP</span>              <span class="token expression"><span class="token number">0x00000020</span> </span><span class="token comment">// One instruction executed</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EXCEPTION</span>         <span class="token expression"><span class="token number">0x00000040</span> </span><span class="token comment">// Exception</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIB_LOADED</span>        <span class="token expression"><span class="token number">0x00000080</span> </span><span class="token comment">// New library loaded</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIB_UNLOADED</span>      <span class="token expression"><span class="token number">0x00000100</span> </span><span class="token comment">// Library unloaded</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INFORMATION</span>       <span class="token expression"><span class="token number">0x00000200</span> </span><span class="token comment">// User-defined information</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_ATTACHED</span>  <span class="token expression"><span class="token number">0x00000400</span> </span><span class="token comment">// Attached to running process</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_DETACHED</span>  <span class="token expression"><span class="token number">0x00000800</span> </span><span class="token comment">// Detached from process</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_SUSPENDED</span> <span class="token expression"><span class="token number">0x00001000</span> </span><span class="token comment">// Process has been suspended</span></span></pre></td></tr></table></figure></li>
</ul>
<h1 id="patch"><a class="anchor" href="#patch">#</a> patch</h1>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ida_bytes<span class="token punctuation">.</span>patch_byte<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> byte<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ida_bytes<span class="token punctuation">.</span>patch_word<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> word<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ida_bytes<span class="token punctuation">.</span>patch_dword<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> dword<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>ida_bytes<span class="token punctuation">.</span>patch_qword<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> qword<span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="idapython常用脚本"><a class="anchor" href="#idapython常用脚本">#</a> IDApython 常用脚本</h1>
<h2 id="打印ida函数列表"><a class="anchor" href="#打印ida函数列表">#</a> 打印 IDA 函数列表</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idautils</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> idc</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>func_addr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>func_name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> idautils<span class="token punctuation">.</span>Functions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    func_addr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    func_name<span class="token punctuation">.</span>append<span class="token punctuation">(</span>idc<span class="token punctuation">.</span>get_func_name<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> func_addr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, "</span></span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> func_name<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">\", "</span></span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="批量去除花指令"><a class="anchor" href="#批量去除花指令">#</a> 批量去除花指令</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> idc</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> ida_bytes</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ida_segment</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">my_nop</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> endaddr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">while</span> addr <span class="token operator">&lt;</span> endaddr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_byte<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        addr <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>pattern <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"74 15 75 13 8D 44 24 FC 83 F0 22 3B 04 24 74 0A E8 1F 00 00 00 74 04"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>           <span class="token string">"74 0A 75 08 E8 10 00 00 00 EB 04 E8"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>           <span class="token string">"48 81 EC 08 03 00 00"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>text_seg <span class="token operator">=</span> ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">".text"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>start<span class="token punctuation">,</span> end <span class="token operator">=</span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">,</span> text_seg<span class="token punctuation">.</span>end_ea</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    cur_addr <span class="token operator">=</span> start</pre></td></tr><tr><td data-num="18"></td><td><pre>    end_addr <span class="token operator">=</span> end</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">while</span> cur_addr <span class="token operator">&lt;</span> end_addr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        cur_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>find_binary<span class="token punctuation">(</span>cur_addr<span class="token punctuation">,</span> idc<span class="token punctuation">.</span>SEARCH_DOWN<span class="token punctuation">,</span> pattern<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"patch address: "</span> <span class="token operator">+</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>cur_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印提示信息</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">if</span> cur_addr <span class="token operator">==</span> idc<span class="token punctuation">.</span>BADADDR<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            my_nop<span class="token punctuation">(</span>cur_addr<span class="token punctuation">,</span> cur_addr <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pattern<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        cur_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>cur_addr<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="去除bcf虚假控制流"><a class="anchor" href="#去除bcf虚假控制流">#</a> 去除 BCF 虚假控制流</h2>
<p>更多细节请参考<a href="https://oacia.dev/ollvm-study/"> ollvm 三种混淆模式的反混淆思路</a></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 去除虚假控制流 idapython 脚本</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> ida_xref</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ida_idaapi</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> ida_bytes <span class="token keyword">import</span> get_bytes<span class="token punctuation">,</span> patch_bytes</pre></td></tr><tr><td data-num="5"></td><td><pre> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 将 mov 寄存器，不透明谓词 修改为 mov 寄存器，0</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">do_patch</span><span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> get_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b"\x8B"</span><span class="token punctuation">:</span> <span class="token comment"># mov eax-edi, dword</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        reg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>get_bytes<span class="token punctuation">(</span>ea <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b00111000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">3</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        patch_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0xB8</span> <span class="token operator">+</span> reg<span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\x00\x00\x00\x00\x90\x90'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 不透明谓词在.bss 段的范围</span></pre></td></tr><tr><td data-num="15"></td><td><pre>seg <span class="token operator">=</span> ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">'.bss'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>start <span class="token operator">=</span> seg<span class="token punctuation">.</span>start_ea</pre></td></tr><tr><td data-num="17"></td><td><pre>end <span class="token operator">=</span> seg<span class="token punctuation">.</span>end_ea</pre></td></tr><tr><td data-num="18"></td><td><pre> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">for</span> addr <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    ref <span class="token operator">=</span> ida_xref<span class="token punctuation">.</span>get_first_dref_to<span class="token punctuation">(</span>addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment"># 获取所有交叉引用</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> ida_idaapi<span class="token punctuation">.</span>BADADDR<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        do_patch<span class="token punctuation">(</span>ref<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'patch at '</span> <span class="token operator">+</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        ref <span class="token operator">=</span> ida_xref<span class="token punctuation">.</span>get_next_dref_to<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> ref<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="去除寄存器跳转混淆"><a class="anchor" href="#去除寄存器跳转混淆">#</a> 去除寄存器跳转混淆</h2>
<p>仅供参考，需要根据实际情况进行调整！</p>
<ul>
<li>
<p>arm64 架构上的 <code>csel-br</code>  及 <code>cset-br</code>  类型寄存器跳转<br>
这个脚本是我在做腾讯游戏安全 2023 的安卓题时写的，更多细节可以参阅<a href="https://oacia.dev/sec-2023/">细品 sec2023 安卓赛题</a></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> ida_segment</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> idautils</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> idc</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> ida_bytes</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> keystone <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">patch_nop</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># arm64 中的 NOP 指令是 b'\x1F\x20\x03\xD5'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">while</span> end <span class="token operator">></span> begin<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>begin<span class="token punctuation">,</span> <span class="token string">b'\x1F\x20\x03\xD5'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        begin <span class="token operator">=</span> begin <span class="token operator">+</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 获取 text 段的起始地址</span></pre></td></tr><tr><td data-num="15"></td><td><pre>text_seg <span class="token operator">=</span> ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">".text"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>start<span class="token punctuation">,</span> end <span class="token operator">=</span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">,</span> text_seg<span class="token punctuation">.</span>end_ea</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># start, end = 0x3BA34, 0x3BA80</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># start, end = 0x37390,0x373B4# 测试 ADRP 指令</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># start, end = 0x3FCE0, 0x3FD00  # 测试 EQ 情况</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">#start, end = 0x3AA90, 0x3AAA4</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># start, end = 0x3A078, 0x3A090# 测试 CSET-BR 去除情况</span></pre></td></tr><tr><td data-num="22"></td><td><pre>current_addr <span class="token operator">=</span> start</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># print(text_seg.start_ea,text_seg.end_ea)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>nop_addr_array_after_finish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 在 CSEL/CSET-BR 结构修复完成后需要 NOP 的指令</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">while</span> current_addr <span class="token operator">&lt;</span> end<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment"># 处理 CSEL-BR 结构</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"CSEL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        CSEL_addr <span class="token operator">=</span> current_addr</pre></td></tr><tr><td data-num="29"></td><td><pre>        nop_addr_array_temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        BR_addr <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        BR_reg <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 向下搜寻 9 条指令，寻找是否有 BR 指令</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"BR"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                BR_addr <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="37"></td><td><pre>                BR_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"CSEL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">if</span> BR_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 匹配到了 CSEL-BR 结构的汇编，需要去除</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token comment"># 形如 CSEL X11, X12, X11, GE, 获取 CSEL 后的操作数 op1~3, 以及条件码 cond</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            CSEL_op1 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            CSEL_op2 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            CSEL_op2_val <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            CSEL_op3 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            CSEL_op3_val <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            CSEL_cond <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token comment"># 读取条件分支语句 CSEL 中要赋值给目标寄存器的两个源寄存器中存储的值</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>CSEL_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token keyword">while</span> <span class="token punctuation">(</span>CSEL_op2_val <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> CSEL_op3_val <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token keyword">if</span> CSEL_op2 <span class="token operator">==</span> <span class="token string">"XZR"</span><span class="token punctuation">:</span>  <span class="token comment"># 如果寄存器的值是 XZR, 说明该值为 0</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                    CSEL_op2_val <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token keyword">if</span> CSEL_op3 <span class="token operator">==</span> <span class="token string">"XZR"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                    CSEL_op3_val <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> CSEL_op2<span class="token punctuation">[</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                                                               <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">and</span> CSEL_op2_val <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 寄存器 X11 和 W11 是同一个寄存器</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                        CSEL_op2_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> CSEL_op3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">and</span> CSEL_op3_val <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                        CSEL_op3_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token comment"># print(CSEL_op2_val, CSEL_op3_val, hex(current_addr))</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token keyword">assert</span> CSEL_op2_val <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> CSEL_op3_val <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>            temp_addr <span class="token operator">=</span> BR_addr</pre></td></tr><tr><td data-num="71"></td><td><pre>            jump_array_reg <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 存贮跳转表的寄存器名称</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            jump_array_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># 跳转表所在的位置</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            add_reg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 加到跳转表的值所在的寄存器</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            add_val <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># 加到跳转表的值</span></pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token keyword">while</span> temp_addr <span class="token operator">></span> CSEL_addr<span class="token punctuation">:</span>  <span class="token comment"># 从后往前找，以 BR 所在的地址开始，CSEL 所在的地址结束，匹配必要的寄存器名称和值</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                <span class="token comment"># print(hex(temp_addr),idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADD"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> BR_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                    add_reg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                    add_reg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                        add_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"LDR"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                    jump_array_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 获取存储跳转表的寄存器名称</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                    jump_array_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                    jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token comment"># 如果在 CSEL-BR 间的指令中没找到跳转表所在的位置，则向上寻找</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token keyword">if</span> jump_array_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                temp_addr <span class="token operator">=</span> CSEL_addr</pre></td></tr><tr><td data-num="97"></td><td><pre>                <span class="token keyword">while</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                    <span class="token comment"># print(hex(temp_addr), idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                            jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                    <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRP"</span><span class="token punctuation">:</span>  <span class="token comment"># ADRP 指令，还需要加上另一部分</span></pre></td></tr><tr><td data-num="105"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="106"></td><td><pre>                            jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="107"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="108"></td><td><pre>                            <span class="token keyword">while</span> temp_addr <span class="token operator">&lt;</span> text_seg<span class="token punctuation">.</span>end_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="109"></td><td><pre>                                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADD"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                                        jump_array_addr <span class="token operator">+=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="112"></td><td><pre>                                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre>                                        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="116"></td><td><pre>                    temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre>            <span class="token comment"># print(hex(jump_array_addr),hex(add_val))</span></pre></td></tr><tr><td data-num="118"></td><td><pre></pre></td></tr><tr><td data-num="119"></td><td><pre>            <span class="token keyword">if</span> add_val <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="120"></td><td><pre>                temp_addr <span class="token operator">=</span> CSEL_addr</pre></td></tr><tr><td data-num="121"></td><td><pre>                <span class="token keyword">while</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                    <span class="token comment"># print(hex(temp_addr), idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="123"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="124"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'X'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="125"></td><td><pre>                            add_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="127"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="128"></td><td><pre>                    temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="129"></td><td><pre></pre></td></tr><tr><td data-num="130"></td><td><pre>            <span class="token comment"># 计算出分支跳转的两个位置</span></pre></td></tr><tr><td data-num="131"></td><td><pre>            branch_a <span class="token operator">=</span> <span class="token punctuation">(</span>ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>jump_array_addr <span class="token operator">+</span> CSEL_op2_val<span class="token punctuation">)</span> <span class="token operator">+</span> add_val<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffffffffffff</span></pre></td></tr><tr><td data-num="132"></td><td><pre>            branch_b <span class="token operator">=</span> <span class="token punctuation">(</span>ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>jump_array_addr <span class="token operator">+</span> CSEL_op3_val<span class="token punctuation">)</span> <span class="token operator">+</span> add_val<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffffffffffff</span></pre></td></tr><tr><td data-num="133"></td><td><pre>            <span class="token comment"># print(hex(branch_a), hex(branch_b))</span></pre></td></tr><tr><td data-num="134"></td><td><pre></pre></td></tr><tr><td data-num="135"></td><td><pre>            <span class="token comment"># print(CSEL_cond,hex(current_addr))</span></pre></td></tr><tr><td data-num="136"></td><td><pre></pre></td></tr><tr><td data-num="137"></td><td><pre>            <span class="token comment"># GE&lt;->LT 有符号大于等于 vs 有符号小于</span></pre></td></tr><tr><td data-num="138"></td><td><pre>            <span class="token comment"># EQ&lt;->NE 结果相等 vs 结果不相等</span></pre></td></tr><tr><td data-num="139"></td><td><pre>            <span class="token comment"># CC&lt;->CS 无符号小于 vs 无符号大于等于</span></pre></td></tr><tr><td data-num="140"></td><td><pre>            <span class="token comment"># HI&lt;->LS 无符号大于 vs 无符号小于等于</span></pre></td></tr><tr><td data-num="141"></td><td><pre>            <span class="token comment"># if CSEL_cond == "GE":# 构造 B.LT 跳转</span></pre></td></tr><tr><td data-num="142"></td><td><pre>            logic_rev <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"GE"</span><span class="token punctuation">:</span> <span class="token string">"LT"</span><span class="token punctuation">,</span> <span class="token string">"LT"</span><span class="token punctuation">:</span> <span class="token string">"GE"</span><span class="token punctuation">,</span> <span class="token string">"EQ"</span><span class="token punctuation">:</span> <span class="token string">"NE"</span><span class="token punctuation">,</span> <span class="token string">"NE"</span><span class="token punctuation">:</span> <span class="token string">"EQ"</span><span class="token punctuation">,</span> <span class="token string">"CC"</span><span class="token punctuation">:</span> <span class="token string">"CS"</span><span class="token punctuation">,</span> <span class="token string">"CS"</span><span class="token punctuation">:</span> <span class="token string">"CC"</span><span class="token punctuation">,</span> <span class="token string">"HI"</span><span class="token punctuation">:</span> <span class="token string">"LS"</span><span class="token punctuation">,</span> <span class="token string">"LS"</span><span class="token punctuation">:</span> <span class="token string">"HI"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>            ks <span class="token operator">=</span> Ks<span class="token punctuation">(</span>KS_ARCH_ARM64<span class="token punctuation">,</span> KS_MODE_LITTLE_ENDIAN<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="144"></td><td><pre>            code <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="145"></td><td><pre>            <span class="token keyword">if</span> branch_b <span class="token operator">==</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断逻辑不取反</span></pre></td></tr><tr><td data-num="146"></td><td><pre>                code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"B.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CSEL_cond<span class="token punctuation">&#125;</span></span><span class="token string"> #</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_a<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="147"></td><td><pre>            <span class="token keyword">elif</span> branch_a <span class="token operator">==</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断逻辑取反</span></pre></td></tr><tr><td data-num="148"></td><td><pre>                code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"B.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>logic_rev<span class="token punctuation">[</span>CSEL_cond<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> #</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="149"></td><td><pre></pre></td></tr><tr><td data-num="150"></td><td><pre>            <span class="token comment">#print(hex(current_addr), hex(add_val), CSEL_op2_val, CSEL_op3_val, hex(jump_array_addr), code)</span></pre></td></tr><tr><td data-num="151"></td><td><pre></pre></td></tr><tr><td data-num="152"></td><td><pre>            <span class="token comment"># 修复 BR 跳转</span></pre></td></tr><tr><td data-num="153"></td><td><pre>            <span class="token keyword">if</span> code <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="154"></td><td><pre></pre></td></tr><tr><td data-num="155"></td><td><pre>                patch_br_byte<span class="token punctuation">,</span> count <span class="token operator">=</span> ks<span class="token punctuation">.</span>asm<span class="token punctuation">(</span>code<span class="token punctuation">,</span> addr<span class="token operator">=</span>BR_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="156"></td><td><pre>                ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>BR_addr<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>patch_br_byte<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="157"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"fix CSEL-BR at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                nop_addr_array_after_finish<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>nop_addr_array_temp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="159"></td><td><pre>                current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="160"></td><td><pre>                <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="161"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"error! unable to fix CSEL-BR at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,branch:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_a<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="163"></td><td><pre></pre></td></tr><tr><td data-num="164"></td><td><pre>    <span class="token comment"># 处理 CSET-BR 结构</span></pre></td></tr><tr><td data-num="165"></td><td><pre>    <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"CSET"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="166"></td><td><pre>        CSET_addr <span class="token operator">=</span> current_addr</pre></td></tr><tr><td data-num="167"></td><td><pre>        nop_addr_array_temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="168"></td><td><pre>        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>CSET_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="169"></td><td><pre>        BR_addr <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="170"></td><td><pre>        BR_reg <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="171"></td><td><pre>        temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="172"></td><td><pre>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 向下搜寻 15 条指令，寻找是否有 BR 指令</span></pre></td></tr><tr><td data-num="173"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"BR"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="174"></td><td><pre>                BR_addr <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="175"></td><td><pre>                BR_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="176"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="177"></td><td><pre>            <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"CSEL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="178"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="179"></td><td><pre>            <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"RET"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="180"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="181"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="182"></td><td><pre>        <span class="token keyword">if</span> BR_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 匹配到了 CSET-BR 结构的汇编，需要去除</span></pre></td></tr><tr><td data-num="183"></td><td><pre>            <span class="token comment"># 形如 CSET W23, NE, 获取 CSET 后的操作数 op1, 以及条件码 cond</span></pre></td></tr><tr><td data-num="184"></td><td><pre>            CSET_op1 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSET_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="185"></td><td><pre>            CSET_op1_val <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="186"></td><td><pre>            CSET_cond <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>CSET_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="187"></td><td><pre></pre></td></tr><tr><td data-num="188"></td><td><pre>            temp_addr <span class="token operator">=</span> BR_addr</pre></td></tr><tr><td data-num="189"></td><td><pre>            jump_array_reg <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 存贮跳转表的寄存器名称</span></pre></td></tr><tr><td data-num="190"></td><td><pre>            jump_array_addr <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 跳转表所在的位置</span></pre></td></tr><tr><td data-num="191"></td><td><pre>            add_reg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 加到跳转表的值所在的寄存器</span></pre></td></tr><tr><td data-num="192"></td><td><pre>            add_val <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 加到跳转表的值</span></pre></td></tr><tr><td data-num="193"></td><td><pre>            Lshift_val <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="194"></td><td><pre>            <span class="token keyword">while</span> temp_addr <span class="token operator">></span> CSET_addr<span class="token punctuation">:</span>  <span class="token comment"># 从后往前找，以 BR 所在的地址开始，CSET 所在的地址结束，匹配必要的寄存器名称和值</span></pre></td></tr><tr><td data-num="195"></td><td><pre>                <span class="token comment"># print(hex(temp_addr),idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="196"></td><td><pre>                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADD"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> BR_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="197"></td><td><pre>                    add_reg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="198"></td><td><pre>                    add_reg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="199"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="200"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOVK"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="201"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="202"></td><td><pre>                        add_val <span class="token operator">+=</span> <span class="token punctuation">(</span>idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="203"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="204"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="205"></td><td><pre>                        add_val <span class="token operator">+=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="206"></td><td><pre>                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="207"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"LDR"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="208"></td><td><pre>                    LDR_temp <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="209"></td><td><pre>                    jump_array_reg <span class="token operator">=</span> LDR_temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 获取存储跳转表的寄存器名称</span></pre></td></tr><tr><td data-num="210"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>LDR_temp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="211"></td><td><pre>                        Lshift_val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>LDR_temp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="212"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="213"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="214"></td><td><pre>                    jump_array_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="215"></td><td><pre>                    jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="216"></td><td><pre>                    nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="217"></td><td><pre>                <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"LSL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="218"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> CSET_op1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="219"></td><td><pre>                        Lshift_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="220"></td><td><pre></pre></td></tr><tr><td data-num="221"></td><td><pre>                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="222"></td><td><pre></pre></td></tr><tr><td data-num="223"></td><td><pre>            <span class="token comment"># 如果在 CSET-BR 间的指令中没找到跳转表所在的位置，则向上寻找</span></pre></td></tr><tr><td data-num="224"></td><td><pre>            <span class="token keyword">if</span> jump_array_addr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="225"></td><td><pre>                temp_addr <span class="token operator">=</span> CSET_addr</pre></td></tr><tr><td data-num="226"></td><td><pre>                <span class="token keyword">while</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="227"></td><td><pre>                    <span class="token comment"># print(hex(temp_addr), idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="228"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRL"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="229"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="230"></td><td><pre>                            jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="231"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="232"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="233"></td><td><pre>                    <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADRP"</span><span class="token punctuation">:</span>  <span class="token comment"># ADRP 指令，还需要加上另一部分</span></pre></td></tr><tr><td data-num="234"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="235"></td><td><pre>                            jump_array_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="236"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="237"></td><td><pre>                            <span class="token keyword">while</span> temp_addr <span class="token operator">&lt;</span> text_seg<span class="token punctuation">.</span>end_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="238"></td><td><pre>                                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ADD"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="239"></td><td><pre>                                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> jump_array_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="240"></td><td><pre>                                        jump_array_addr <span class="token operator">+=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="241"></td><td><pre>                                        nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="242"></td><td><pre>                                        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="243"></td><td><pre>                                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="244"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="245"></td><td><pre>                    temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="246"></td><td><pre>            <span class="token comment"># print(hex(jump_array_addr),hex(add_val))</span></pre></td></tr><tr><td data-num="247"></td><td><pre></pre></td></tr><tr><td data-num="248"></td><td><pre>            <span class="token comment"># 向上寻找加到跳转表的值</span></pre></td></tr><tr><td data-num="249"></td><td><pre>            <span class="token keyword">if</span> add_val <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="250"></td><td><pre>                temp_addr <span class="token operator">=</span> CSET_addr</pre></td></tr><tr><td data-num="251"></td><td><pre>                <span class="token keyword">while</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="252"></td><td><pre>                    <span class="token comment"># print(hex(temp_addr), idc.print_insn_mnem(temp_addr))</span></pre></td></tr><tr><td data-num="253"></td><td><pre>                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="254"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="255"></td><td><pre>                            add_val <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="256"></td><td><pre>                            nop_addr_array_temp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="257"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="258"></td><td><pre>                    <span class="token keyword">elif</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOVK"</span><span class="token punctuation">:</span>  <span class="token comment"># 形如 MOV W9, #0x76BC;MOVK W9, #0x4C48,LSL#16; 的形式</span></pre></td></tr><tr><td data-num="259"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="260"></td><td><pre>                            <span class="token comment"># print(hex(add_val))</span></pre></td></tr><tr><td data-num="261"></td><td><pre>                            add_val <span class="token operator">=</span> <span class="token punctuation">(</span>idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="262"></td><td><pre>                            <span class="token comment"># print(hex(add_val))</span></pre></td></tr><tr><td data-num="263"></td><td><pre>                            <span class="token keyword">while</span> temp_addr <span class="token operator">></span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="264"></td><td><pre>                                <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"MOV"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="265"></td><td><pre>                                    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">in</span> add_reg<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="266"></td><td><pre>                                        add_val <span class="token operator">+=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="267"></td><td><pre>                                        <span class="token comment"># print(hex(add_val))</span></pre></td></tr><tr><td data-num="268"></td><td><pre>                                        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="269"></td><td><pre>                                temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="270"></td><td><pre></pre></td></tr><tr><td data-num="271"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="272"></td><td><pre></pre></td></tr><tr><td data-num="273"></td><td><pre>                    temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="274"></td><td><pre></pre></td></tr><tr><td data-num="275"></td><td><pre>            <span class="token comment"># print(hex(current_addr))</span></pre></td></tr><tr><td data-num="276"></td><td><pre>            <span class="token comment"># 计算出分支跳转的两个位置</span></pre></td></tr><tr><td data-num="277"></td><td><pre>            branch_a <span class="token operator">=</span> <span class="token punctuation">(</span>ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>jump_array_addr <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> Lshift_val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> add_val<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffffffffffff</span></pre></td></tr><tr><td data-num="278"></td><td><pre>            branch_b <span class="token operator">=</span> <span class="token punctuation">(</span>ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>jump_array_addr <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> Lshift_val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> add_val<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffffffffffff</span></pre></td></tr><tr><td data-num="279"></td><td><pre>            <span class="token comment"># print(hex(branch_a), hex(branch_b))</span></pre></td></tr><tr><td data-num="280"></td><td><pre></pre></td></tr><tr><td data-num="281"></td><td><pre>            <span class="token comment"># print(CSEL_cond,hex(current_addr))</span></pre></td></tr><tr><td data-num="282"></td><td><pre></pre></td></tr><tr><td data-num="283"></td><td><pre>            <span class="token comment"># GE&lt;->LT 有符号大于等于 vs 有符号小于</span></pre></td></tr><tr><td data-num="284"></td><td><pre>            <span class="token comment"># EQ&lt;->NE 结果相等 vs 结果不相等</span></pre></td></tr><tr><td data-num="285"></td><td><pre>            <span class="token comment"># CC&lt;->CS 无符号小于 vs 无符号大于等于</span></pre></td></tr><tr><td data-num="286"></td><td><pre>            <span class="token comment"># HI&lt;->LS 无符号大于 vs 无符号小于等于</span></pre></td></tr><tr><td data-num="287"></td><td><pre>            <span class="token comment"># if CSEL_cond == "GE":# 构造 B.LT 跳转</span></pre></td></tr><tr><td data-num="288"></td><td><pre>            logic_rev <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"GE"</span><span class="token punctuation">:</span> <span class="token string">"LT"</span><span class="token punctuation">,</span> <span class="token string">"LT"</span><span class="token punctuation">:</span> <span class="token string">"GE"</span><span class="token punctuation">,</span> <span class="token string">"EQ"</span><span class="token punctuation">:</span> <span class="token string">"NE"</span><span class="token punctuation">,</span> <span class="token string">"NE"</span><span class="token punctuation">:</span> <span class="token string">"EQ"</span><span class="token punctuation">,</span> <span class="token string">"CC"</span><span class="token punctuation">:</span> <span class="token string">"CS"</span><span class="token punctuation">,</span> <span class="token string">"CS"</span><span class="token punctuation">:</span> <span class="token string">"CC"</span><span class="token punctuation">,</span> <span class="token string">"HI"</span><span class="token punctuation">:</span> <span class="token string">"LS"</span><span class="token punctuation">,</span> <span class="token string">"LS"</span><span class="token punctuation">:</span> <span class="token string">"HI"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="289"></td><td><pre>            ks <span class="token operator">=</span> Ks<span class="token punctuation">(</span>KS_ARCH_ARM64<span class="token punctuation">,</span> KS_MODE_LITTLE_ENDIAN<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="290"></td><td><pre>            code <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="291"></td><td><pre>            <span class="token keyword">if</span> branch_b <span class="token operator">==</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断逻辑不取反</span></pre></td></tr><tr><td data-num="292"></td><td><pre>                code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"B.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CSET_cond<span class="token punctuation">&#125;</span></span><span class="token string"> #</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_a<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="293"></td><td><pre>            <span class="token keyword">elif</span> branch_a <span class="token operator">==</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断逻辑取反</span></pre></td></tr><tr><td data-num="294"></td><td><pre>                code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"B.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>logic_rev<span class="token punctuation">[</span>CSET_cond<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> #</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="295"></td><td><pre></pre></td></tr><tr><td data-num="296"></td><td><pre>            <span class="token comment"># print(hex(current_addr),add_reg,hex(add_val),CSET_op1,CSET_op1_val,jump_array_reg,hex(jump_array_addr),Lshift_val,code)</span></pre></td></tr><tr><td data-num="297"></td><td><pre>            <span class="token comment"># 修复 BR 跳转</span></pre></td></tr><tr><td data-num="298"></td><td><pre>            <span class="token keyword">if</span> code <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="299"></td><td><pre>                patch_br_byte<span class="token punctuation">,</span> count <span class="token operator">=</span> ks<span class="token punctuation">.</span>asm<span class="token punctuation">(</span>code<span class="token punctuation">,</span> addr<span class="token operator">=</span>BR_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="300"></td><td><pre>                ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>BR_addr<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>patch_br_byte<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="301"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"fix CSET-BR at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="302"></td><td><pre>                nop_addr_array_after_finish<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>nop_addr_array_temp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="303"></td><td><pre>                current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>BR_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="304"></td><td><pre>                <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="305"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="306"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"error! unable to fix CSET-BR at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,branch:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_a<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>branch_b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="307"></td><td><pre></pre></td></tr><tr><td data-num="308"></td><td><pre>    current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="309"></td><td><pre></pre></td></tr><tr><td data-num="310"></td><td><pre><span class="token keyword">for</span> addr <span class="token keyword">in</span> nop_addr_array_after_finish<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="311"></td><td><pre>    patch_nop<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> addr <span class="token operator">+</span> idc<span class="token punctuation">.</span>get_item_size<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p>x86_64 架构的 <code>jmp rax</code>  类型寄存器跳转<br>
例题点这里下载 <span class="exturl" data-url="aHR0cHM6Ly9vYWNpYS5naXRodWIuaW8vaWRhcHl0aG9uLWxlYXJuaW5nL0FDVEYtb2JmdXNlLnppcA==">ACTF-obfuse</span></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> ida_segment</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> idautils</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> idc</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> ida_bytes</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">from</span> keystone <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">patch_nop</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> endaddr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">while</span> addr <span class="token operator">&lt;</span> endaddr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_byte<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        addr <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 获取 text 段的起始地址</span></pre></td></tr><tr><td data-num="16"></td><td><pre>text_seg <span class="token operator">=</span> ida_segment<span class="token punctuation">.</span>get_segm_by_name<span class="token punctuation">(</span><span class="token string">".text"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>start<span class="token punctuation">,</span> end <span class="token operator">=</span> text_seg<span class="token punctuation">.</span>start_ea<span class="token punctuation">,</span> text_seg<span class="token punctuation">.</span>end_ea</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># start, end = 0x41143D,0x41145F# 测试 call rax</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#start, end = 0x411489,0x411498# 测试 jmp rax case1</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># start, end = 0x411568, 0x411575  # 测试 jmp rax case2</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">#start, end = 0x410EC0,0x412670# 去除 check 函数的混淆</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">#start, end = 0x410EC0,0x412670# 在 check 中测试 jmp rax case2</span></pre></td></tr><tr><td data-num="23"></td><td><pre>current_addr <span class="token operator">=</span> start</pre></td></tr><tr><td data-num="24"></td><td><pre>call_table <span class="token operator">=</span> <span class="token number">0x67F1A0</span>  <span class="token comment"># call rax 跳转表地址</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="26"></td><td><pre>这是一个call rax基本块 需要去除mov rax, [rax+14E8h];call rax</pre></td></tr><tr><td data-num="27"></td><td><pre>mov     rax, [rax+14E8h]</pre></td></tr><tr><td data-num="28"></td><td><pre>movzx   edi, byte ptr [rbp+var_50+6]</pre></td></tr><tr><td data-num="29"></td><td><pre>mov     edx, offset dword_674040</pre></td></tr><tr><td data-num="30"></td><td><pre>mov     esi, 1</pre></td></tr><tr><td data-num="31"></td><td><pre>lea     rcx, [rbp+var_120]</pre></td></tr><tr><td data-num="32"></td><td><pre>mov     r8d, 2AE8944Ah</pre></td></tr><tr><td data-num="33"></td><td><pre>call    rax</pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>处理后应为如下形式</pre></td></tr><tr><td data-num="36"></td><td><pre>movzx   edi, byte ptr [rbp+var_50+6]</pre></td></tr><tr><td data-num="37"></td><td><pre>mov     edx, offset dword_674040</pre></td></tr><tr><td data-num="38"></td><td><pre>mov     esi, 1</pre></td></tr><tr><td data-num="39"></td><td><pre>lea     rcx, [rbp+var_120]</pre></td></tr><tr><td data-num="40"></td><td><pre>mov     r8d, 2AE8944Ah</pre></td></tr><tr><td data-num="41"></td><td><pre>call sub_xxxxxx</pre></td></tr><tr><td data-num="42"></td><td><pre>'''</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">while</span> current_addr <span class="token operator">&lt;=</span> end<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token comment">#print(hex(current_addr))</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment"># 处理 call rax 结构</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"call"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>current_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"rax"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token comment"># print("call rax")</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        call_rax_addr <span class="token operator">=</span> current_addr</pre></td></tr><tr><td data-num="49"></td><td><pre>        mov_rax_xxxh_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        call_func_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token comment"># 获取需要跳转的地址</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        temp_addr <span class="token operator">=</span> call_rax_addr</pre></td></tr><tr><td data-num="53"></td><td><pre>        count <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">while</span> temp_addr <span class="token operator">>=</span> start <span class="token keyword">and</span> count<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"mov"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                                                                             <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"rax"</span> <span class="token keyword">and</span> <span class="token string">"rax"</span> <span class="token keyword">in</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                mov_rax_xxxh_addr <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token comment"># 获取 [rax+14E8h] 中的 14E8 十六进制字符串</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                tmp_call_table_offset_re_result <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\[\w+\+([\da-fA-F]+)'</span><span class="token punctuation">,</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token keyword">if</span> tmp_call_table_offset_re_result<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    tmp <span class="token operator">=</span> tmp_call_table_offset_re_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    <span class="token comment">#print(tmp)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                        <span class="token keyword">if</span> tmp<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                            tmp <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                            tmp <span class="token operator">=</span> <span class="token string">'0'</span><span class="token operator">+</span>tmp</pre></td></tr><tr><td data-num="69"></td><td><pre>                    call_table_offset <span class="token operator">=</span> binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                    <span class="token keyword">break</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                call_table_offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>call_table_offset<span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                call_func_addr <span class="token operator">=</span> ida_bytes<span class="token punctuation">.</span>get_dword<span class="token punctuation">(</span>call_table <span class="token operator">+</span> call_table_offset<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="75"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            count <span class="token operator">=</span> count<span class="token operator">+</span><span class="token number">1</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token comment"># print(hex(call_func_addr))</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token keyword">if</span> call_rax_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> mov_rax_xxxh_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> call_func_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token comment"># 准备 patch</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        movRAX_callRAX_patch <span class="token operator">=</span> <span class="token string">b''</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token comment"># print(hex(idc.next_head(mov_rax_xxxh_addr)),hex(call_rax_addr))</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        ea <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>mov_rax_xxxh_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token keyword">while</span> ea <span class="token operator">&lt;</span> call_rax_addr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            size <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span> <span class="token operator">-</span> ea</pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token comment">#print(ida_bytes.get_bytes(ea, size))</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            movRAX_callRAX_patch <span class="token operator">+=</span> ida_bytes<span class="token punctuation">.</span>get_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            ea <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token comment"># 计算跳转到的地址</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token keyword">if</span> call_func_addr <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            ks <span class="token operator">=</span> Ks<span class="token punctuation">(</span>KS_ARCH_X86<span class="token punctuation">,</span> KS_MODE_64<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>            code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"call </span><span class="token interpolation"><span class="token punctuation">&#123;</span>call_func_addr<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="97"></td><td><pre>            patch_call_rax_byte<span class="token punctuation">,</span> count <span class="token operator">=</span> ks<span class="token punctuation">.</span>asm<span class="token punctuation">(</span>code<span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token punctuation">(</span>mov_rax_xxxh_addr <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movRAX_callRAX_patch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token comment">#print(call_func_addr, code, patch_call_rax_byte)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        movRAX_callRAX_patch <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>patch_call_rax_byte<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token comment"># print(movRAX_callRAX_patch)</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>mov_rax_xxxh_addr<span class="token punctuation">,</span> <span class="token string">b'\x90'</span> <span class="token operator">*</span> <span class="token punctuation">(</span>idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>call_rax_addr<span class="token punctuation">)</span> <span class="token operator">-</span> mov_rax_xxxh_addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>mov_rax_xxxh_addr<span class="token punctuation">,</span> movRAX_callRAX_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"fix call rax at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>call_rax_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>    <span class="token comment"># 处理 jmp rax 结构</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    考虑两种情况 此时需要先获取rcx</pre></td></tr><tr><td data-num="110"></td><td><pre>    一:</pre></td></tr><tr><td data-num="111"></td><td><pre>    mov     rax, cs:qword_67CA28</pre></td></tr><tr><td data-num="112"></td><td><pre>    mov     ecx, 0ADAE163Ch</pre></td></tr><tr><td data-num="113"></td><td><pre>    add     rax, rcx</pre></td></tr><tr><td data-num="114"></td><td><pre>    jmp     rax</pre></td></tr><tr><td data-num="115"></td><td><pre>    </pre></td></tr><tr><td data-num="116"></td><td><pre>    二:</pre></td></tr><tr><td data-num="117"></td><td><pre>    mov     rax, cs:qword_67CA30</pre></td></tr><tr><td data-num="118"></td><td><pre>    add     rax, 5C65CCC7h</pre></td></tr><tr><td data-num="119"></td><td><pre>    jmp     rax</pre></td></tr><tr><td data-num="120"></td><td><pre>    </pre></td></tr><tr><td data-num="121"></td><td><pre>    '''</pre></td></tr><tr><td data-num="122"></td><td><pre>    <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"jmp"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>current_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"rax"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        <span class="token comment"># print("jmp rax")</span></pre></td></tr><tr><td data-num="124"></td><td><pre>        mov_rax_qword_xxx_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="125"></td><td><pre>        mov_reg_xxx_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        add_rax_xxx_addr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        jmp_rax_addr <span class="token operator">=</span> current_addr</pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre>        add_num1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        add_num2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="131"></td><td><pre>        <span class="token comment"># 获取加上的第一个数</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        temp_addr <span class="token operator">=</span> jmp_rax_addr</pre></td></tr><tr><td data-num="133"></td><td><pre>        count <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        <span class="token keyword">while</span> temp_addr <span class="token operator">>=</span> start <span class="token keyword">and</span> count<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="135"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"mov"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"rax"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="136"></td><td><pre>                mov_rax_qword_xxx_addr <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="137"></td><td><pre>                tmp <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'cs:qword_([0-9A-Fa-f]+)'</span><span class="token punctuation">,</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="138"></td><td><pre>                <span class="token keyword">if</span> tmp<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="139"></td><td><pre>                    add_num1_addr <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="140"></td><td><pre>                    add_num1_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>add_num1_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="141"></td><td><pre>                    add_num1 <span class="token operator">=</span> ida_bytes<span class="token punctuation">.</span>get_qword<span class="token punctuation">(</span>add_num1_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="142"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                    <span class="token keyword">break</span></pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre>                <span class="token comment">#print(add_num1_addr)</span></pre></td></tr><tr><td data-num="146"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="147"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="148"></td><td><pre>            count <span class="token operator">=</span> count<span class="token operator">+</span><span class="token number">1</span></pre></td></tr><tr><td data-num="149"></td><td><pre></pre></td></tr><tr><td data-num="150"></td><td><pre>        <span class="token comment"># 获取加上的第二个数</span></pre></td></tr><tr><td data-num="151"></td><td><pre>        temp_addr <span class="token operator">=</span> jmp_rax_addr</pre></td></tr><tr><td data-num="152"></td><td><pre>        count <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="153"></td><td><pre>        <span class="token keyword">while</span> temp_addr <span class="token operator">>=</span> start <span class="token keyword">and</span> count<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="154"></td><td><pre>            <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"add"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"rax"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="155"></td><td><pre>                add_rax_xxx_addr <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="156"></td><td><pre>                <span class="token comment"># 如果直接加上一个数</span></pre></td></tr><tr><td data-num="157"></td><td><pre>                <span class="token keyword">if</span> <span class="token keyword">not</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                    add_num2 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="159"></td><td><pre>                <span class="token comment"># 如果这个数是通过寄存器例如 ecx 赋值的</span></pre></td></tr><tr><td data-num="160"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="161"></td><td><pre>                    tmp_add_num2_reg <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                    temp_addr_2 <span class="token operator">=</span> temp_addr</pre></td></tr><tr><td data-num="163"></td><td><pre>                    count2 <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="164"></td><td><pre>                    <span class="token keyword">while</span> temp_addr_2 <span class="token operator">>=</span> start <span class="token keyword">and</span> count2<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="165"></td><td><pre>                        <span class="token comment"># print(idc.print_insn_mnem(temp_addr),idc.print_operand(temp_addr, 0)[1::],tmp_add_num2_reg[1::])</span></pre></td></tr><tr><td data-num="166"></td><td><pre>                        <span class="token keyword">if</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>temp_addr_2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"mov"</span> <span class="token keyword">and</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr_2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="167"></td><td><pre>                                                                         <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> tmp_add_num2_reg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="168"></td><td><pre>                            add_num2 <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_operand<span class="token punctuation">(</span>temp_addr_2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="169"></td><td><pre>                            mov_reg_xxx_addr <span class="token operator">=</span> temp_addr_2</pre></td></tr><tr><td data-num="170"></td><td><pre>                            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="171"></td><td><pre>                        temp_addr_2 <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr_2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="172"></td><td><pre>                        count2<span class="token operator">=</span>count2<span class="token operator">+</span><span class="token number">1</span></pre></td></tr><tr><td data-num="173"></td><td><pre>                <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="174"></td><td><pre>                    add_num2 <span class="token operator">=</span> add_num2<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="175"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>add_num2<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="176"></td><td><pre>                        <span class="token keyword">if</span> add_num2<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="177"></td><td><pre>                            add_num2 <span class="token operator">=</span> add_num2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="178"></td><td><pre>                        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="179"></td><td><pre>                            add_num2 <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> add_num2</pre></td></tr><tr><td data-num="180"></td><td><pre>                    add_num2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>a2b_hex<span class="token punctuation">(</span>add_num2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="181"></td><td><pre>                    <span class="token comment">#print(add_num2)</span></pre></td></tr><tr><td data-num="182"></td><td><pre>                <span class="token keyword">except</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="183"></td><td><pre>                    <span class="token keyword">break</span></pre></td></tr><tr><td data-num="184"></td><td><pre></pre></td></tr><tr><td data-num="185"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="186"></td><td><pre></pre></td></tr><tr><td data-num="187"></td><td><pre>            temp_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>prev_head<span class="token punctuation">(</span>temp_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="188"></td><td><pre>            count <span class="token operator">=</span> count<span class="token operator">+</span><span class="token number">1</span></pre></td></tr><tr><td data-num="189"></td><td><pre></pre></td></tr><tr><td data-num="190"></td><td><pre>        <span class="token keyword">if</span> add_num1 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> add_num2 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> mov_rax_qword_xxx_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> add_rax_xxx_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> jmp_rax_addr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="191"></td><td><pre>            <span class="token comment">#print(add_num1,add_num2,mov_rax_qword_xxx_addr,add_rax_xxx_addr,jmp_rax_addr)</span></pre></td></tr><tr><td data-num="192"></td><td><pre>            current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="193"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="194"></td><td><pre></pre></td></tr><tr><td data-num="195"></td><td><pre>        <span class="token comment"># 准备 patch</span></pre></td></tr><tr><td data-num="196"></td><td><pre>        movRAX_jmpRAX_patch <span class="token operator">=</span> <span class="token string">b''</span></pre></td></tr><tr><td data-num="197"></td><td><pre>        <span class="token comment">#print(hex(idc.next_head(mov_rax_xxxh_addr)), hex(call_rax_addr))</span></pre></td></tr><tr><td data-num="198"></td><td><pre>        should_pass_addr <span class="token operator">=</span> <span class="token punctuation">[</span>mov_rax_qword_xxx_addr<span class="token punctuation">,</span> mov_reg_xxx_addr<span class="token punctuation">,</span> add_rax_xxx_addr<span class="token punctuation">,</span> jmp_rax_addr<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="199"></td><td><pre>        ea <span class="token operator">=</span> mov_rax_qword_xxx_addr</pre></td></tr><tr><td data-num="200"></td><td><pre>        <span class="token keyword">while</span> ea <span class="token operator">&lt;</span> jmp_rax_addr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="201"></td><td><pre>            <span class="token keyword">if</span> ea <span class="token keyword">not</span> <span class="token keyword">in</span> should_pass_addr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="202"></td><td><pre>                size <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span> <span class="token operator">-</span> ea</pre></td></tr><tr><td data-num="203"></td><td><pre>                <span class="token comment"># print(ida_bytes.get_bytes(ea, size))</span></pre></td></tr><tr><td data-num="204"></td><td><pre>                movRAX_jmpRAX_patch <span class="token operator">+=</span> ida_bytes<span class="token punctuation">.</span>get_bytes<span class="token punctuation">(</span>ea<span class="token punctuation">,</span> size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="205"></td><td><pre>            ea <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>ea<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="206"></td><td><pre></pre></td></tr><tr><td data-num="207"></td><td><pre>        <span class="token comment"># 计算跳转到的地址</span></pre></td></tr><tr><td data-num="208"></td><td><pre>        <span class="token comment">#print(hex(add_num1), add_num2)</span></pre></td></tr><tr><td data-num="209"></td><td><pre>        jmp_addr <span class="token operator">=</span> <span class="token punctuation">(</span>add_num1 <span class="token operator">+</span> add_num2<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span></pre></td></tr><tr><td data-num="210"></td><td><pre>        ks <span class="token operator">=</span> Ks<span class="token punctuation">(</span>KS_ARCH_X86<span class="token punctuation">,</span> KS_MODE_64<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="211"></td><td><pre>        code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"jmp </span><span class="token interpolation"><span class="token punctuation">&#123;</span>jmp_addr<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span></pre></td></tr><tr><td data-num="212"></td><td><pre>        patch_call_rax_byte<span class="token punctuation">,</span> count <span class="token operator">=</span> ks<span class="token punctuation">.</span>asm<span class="token punctuation">(</span>code<span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token punctuation">(</span>mov_rax_qword_xxx_addr <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movRAX_jmpRAX_patch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="213"></td><td><pre>        <span class="token comment"># print(call_func_addr, code, patch_call_rax_byte)</span></pre></td></tr><tr><td data-num="214"></td><td><pre></pre></td></tr><tr><td data-num="215"></td><td><pre>        movRAX_jmpRAX_patch <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>patch_call_rax_byte<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="216"></td><td><pre>        <span class="token comment"># print(movRAX_callRAX_patch)</span></pre></td></tr><tr><td data-num="217"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>mov_rax_qword_xxx_addr<span class="token punctuation">,</span> <span class="token string">b'\x90'</span> <span class="token operator">*</span> <span class="token punctuation">(</span>idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>jmp_rax_addr<span class="token punctuation">)</span> <span class="token operator">-</span> mov_rax_qword_xxx_addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="218"></td><td><pre>        ida_bytes<span class="token punctuation">.</span>patch_bytes<span class="token punctuation">(</span>mov_rax_qword_xxx_addr<span class="token punctuation">,</span> movRAX_jmpRAX_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="219"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"fix jmp rax at </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>jmp_rax_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="220"></td><td><pre></pre></td></tr><tr><td data-num="221"></td><td><pre>    current_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>next_head<span class="token punctuation">(</span>current_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="222"></td><td><pre></pre></td></tr><tr><td data-num="223"></td><td><pre><span class="token comment">#patch_nop(0x410FB3,0x41142C)</span></pre></td></tr></table></figure></li>
</ul>
<h1 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h1>
<ul>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9saW5nemUueHl6L2Jvb2svcmV2ZXJzZS9pZGFfcHl0aG9uLyMlRTUlOUMlQjAlRTUlOUQlODA=">ida python 使用</span></p>
</li>
<li>
<p><span class="exturl" data-url="aHR0cDovLzE5Mi4xNDQuMjM3LjI5LzIwMjIvMDIvMjMvY29tbW9uL2lkYXB5dGhvbi8=">idapython 笔记学习</span></p>
</li>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MzIzOTYwL2FydGljbGUvZGV0YWlscy8xMjU0OTM1ODg=">在 PyCharm 中写 IDAPython 脚本</span></p>
</li>
</ul>

      <div class="tags">
          <a href="/tags/idapython/" rel="tag"><i class="ic i-tag"></i> idapython</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2025-04-09 02:55:11" itemprop="dateModified" datetime="2025-04-09T02:55:11+08:00">2025-04-09</time>
  </span>
  <span id="idapython-learning/" class="item leancloud_visitors" data-flag-title="IDApython学习笔记" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>oacia <i class="ic i-at"><em>@</em></i>oaciaのBbBlog~
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://oacia.dev/idapython-learning/" title="IDApython学习笔记">https://oacia.dev/idapython-learning/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/rwProcMem33-usage/" itemprop="url" rel="prev" data-background-image="&#x2F;picture&#x2F;598879.webp" title="将rwProcMem33编译进安卓内核">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>将rwProcMem33编译进安卓内核</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/sec-2023/" itemprop="url" rel="next" data-background-image="&#x2F;picture&#x2F;346694.webp" title="细品sec2023安卓赛题">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>细品sec2023安卓赛题</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-text"> 官方文档</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idapython%E7%BC%96%E5%86%99%E7%8E%AF%E5%A2%83"><span class="toc-text"> IDApython 编写环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80-address"><span class="toc-text"> 地址 address</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96-disasm"><span class="toc-text"> 反汇编 disasm</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AE%B5-segment"><span class="toc-text"> 段 segment</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-function"><span class="toc-text"> 函数 function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9D%97-block"><span class="toc-text"> 块 block</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0"><span class="toc-text"> 操作数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2"><span class="toc-text"> 搜索</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-text"> 数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-text"> 动态调试</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#patch"><span class="toc-text"> patch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idapython%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="toc-text"> IDApython 常用脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8D%B0ida%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8"><span class="toc-text"> 打印 IDA 函数列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%8E%BB%E9%99%A4%E8%8A%B1%E6%8C%87%E4%BB%A4"><span class="toc-text"> 批量去除花指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4bcf%E8%99%9A%E5%81%87%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-text"> 去除 BCF 虚假控制流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E5%AF%84%E5%AD%98%E5%99%A8%E8%B7%B3%E8%BD%AC%E6%B7%B7%E6%B7%86"><span class="toc-text"> 去除寄存器跳转混淆</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text"> 参考资料</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="oacia"
      data-src="/images/avatar.jpg">
  
  <svg class="logo-overview" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 540.19 380.99">
    <g id="clips" fill= #00a99d; stroke="none">
      <clipPath id="o">
        <path d="M93.57,284c8,0,14.91-1,20.75-3,5.83-2,10.41-3.66,13.75-5,4.66-1.66,6.16-.75,4.5,2.75-1.67,3.5-4.67,6.42-9,8.75-2.34,1.34-6.09,2.84-11.25,4.5-5.17,1.67-11.09,2.5-17.75,2.5-.34,8.67-3.34,16.84-9,24.5-5.67,7.67-13.34,13.34-23,17-6,2.34-12.17,3.59-18.5,3.75-6.34,.17-12.17-.66-17.5-2.5-5.34-1.83-10.09-4.66-14.25-8.5-4.17-3.83-7.25-8.41-9.25-13.75-2-5.33-2.83-11-2.5-17s1.83-11.83,4.5-17.5c2.66-5.66,6.33-10.75,11-15.25,4.66-4.5,10.16-7.75,16.5-9.75,5.66-1.66,11.41-1.66,17.25,0,5.83,1.67,10.08,4.34,12.75,8,1.66,2.67,2.5,5.67,2.5,9,3-2,6.33-3,10-3h1c3.33,0,6.5,.84,9.5,2.5,3,1.67,5.33,4.5,7,8.5l1,3.5Zm-34,39.5c5.66-.66,10.33-3.83,14-9.5,3.66-5.66,5.33-12.16,5-19.5-4.67,.34-9.09-.41-13.25-2.25-4.17-1.83-6.42-4.58-6.75-8.25-.67-3,0-5.5,2-7.5-.67-2.66-2.75-5-6.25-7s-7.09-2.16-10.75-.5c-4.67,2-8.25,5.84-10.75,11.5-2.5,5.67-3.09,11.84-1.75,18.5,1.33,8,4.75,14.34,10.25,19,5.5,4.67,11.58,6.5,18.25,5.5Z"/>
      </clipPath>
      <clipPath id="a1">
        <path d="M176.06,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      <clipPath id="c">
        <path d="M250.06,280.5c4.66-7.66,12-13.16,22-16.5,10-3.33,19.83-3.66,29.5-1,7.66,2.34,13.5,5.67,17.5,10,4,4.34,5.83,8.5,5.5,12.5-.34,4.67-2.25,8.59-5.75,11.75-3.5,3.17-7.09,5.34-10.75,6.5-3.67,1.17-6.84,1.25-9.5,.25-2.67-1-3.34-3.16-2-6.5,2.66-8,2.75-14.58,.25-19.75-2.5-5.16-5.92-6.41-10.25-3.75-2.67,1.67-5,4.09-7,7.25-2,3.17-3.5,6.75-4.5,10.75s-1.42,8.09-1.25,12.25c.16,4.17,.75,7.92,1.75,11.25,1.33,4,3.66,7.42,7,10.25,3.33,2.84,7.16,4.67,11.5,5.5,4.33,.84,8.91,.67,13.75-.5,4.83-1.16,9.25-3.75,13.25-7.75,7.33-6.66,12.33-14.33,15-23,.33-1.66,1.16-2.91,2.5-3.75,1.33-.83,2.5-1.08,3.5-.75,1,.34,1.83,1.09,2.5,2.25,.66,1.17,.66,2.92,0,5.25-2.34,9.34-6.34,17-12,23-4.67,5.67-10.5,10.42-17.5,14.25-7,3.84-14.25,6.09-21.75,6.75-7.5,.67-14.84-.33-22-3-7.17-2.66-13.25-7.5-18.25-14.5-6-8.66-8.75-17.66-8.25-27,.5-9.33,2.25-16.66,5.25-22Z"/>
      </clipPath>
      <clipPath id="i_b">
        <path d="M393.06,330c-2.34,2.67-5.17,5.09-8.5,7.25-3.34,2.17-7.09,3.59-11.25,4.25-4.17,.67-8.59,.67-13.25,0-4.67-.66-9.17-2.33-13.5-5-4.67-2.66-7.67-7.58-9-14.75-1.34-7.16-1.83-14.66-1.5-22.5,.33-7.83,1.33-14.91,3-21.25,1.66-6.33,3.33-10.16,5-11.5,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,3.59,1.25,6.75-.17,3.17-.5,6.92-1,11.25-.5,4.34-1.09,8.92-1.75,13.75-.67,4.84-.67,9.42,0,13.75,.33,3.67,1.33,6.42,3,8.25,1.66,1.84,3.5,2.84,5.5,3,2,.17,4-.25,6-1.25s3.83-2.33,5.5-4c3-3.66,5.66-7.66,8-12,2.33-4.33,4.16-8.16,5.5-11.5,1-3.66,2.91-5.25,5.75-4.75,2.83,.5,3.75,3.09,2.75,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.34,8.59-10,14.25Z"/>
      </clipPath>
      <clipPath id="a2">
        <path d="M461.56,270c5,4,8.5,9.17,10.5,15.5,.66-1.33,1.25-2.33,1.75-3,.5-.66,1.08-1.33,1.75-2,3.66-2.66,8-3.08,13-1.25,5,1.84,8.5,4.09,10.5,6.75,1,1.34,1.41,2.75,1.25,4.25-.17,1.5-.5,3.42-1,5.75-.5,2.34-1,5.09-1.5,8.25-.5,3.17-.42,6.92,.25,11.25,.33,3.67,1.25,6.5,2.75,8.5s3.16,3.25,5,3.75c1.83,.5,3.75,.34,5.75-.5,2-.83,3.83-2.08,5.5-3.75,3-3.66,5.75-7.66,8.25-12,2.5-4.33,4.25-8.16,5.25-11.5,1.33-3.66,3.41-5.25,6.25-4.75,2.83,.5,3.58,3.09,2.25,7.75-1.34,4.67-3,8.92-5,12.75-2,3.84-5.17,8.59-9.5,14.25-4.67,5.67-11.34,9.59-20,11.75-8.67,2.17-17.67,.42-27-5.25-5-3.33-8.34-8.83-10-16.5-.67,1.34-2,3.34-4,6-3.67,4.67-7.84,8.59-12.5,11.75-4.67,3.17-9.42,5.34-14.25,6.5-4.84,1.17-9.59,1.34-14.25,.5-4.67-.83-9-2.75-13-5.75-7.67-6-11.75-14.33-12.25-25-.5-10.66,2.91-20.83,10.25-30.5,7.33-9.66,16.25-15.75,26.75-18.25s19.58-.91,27.25,4.75Zm-25,60c4.66,1.67,9.66,.17,15-4.5,5.33-4.66,9.33-10.83,12-18.5,2.33-6.66,2.58-12.5,.75-17.5-1.84-5-5.09-8.33-9.75-10-4.67-1.66-9.34-1.33-14,1-4.67,2.34-8.34,7.34-11,15-3,7.67-3.84,14.92-2.5,21.75,1.33,6.84,4.5,11.09,9.5,12.75Z"/>
      </clipPath>
      
    </g>
    <g
      id="strokes"
      fill="none"
      stroke=#96d7f5
      stroke-linecap="round"
      stroke-linejoin="round"
    >
    <path
    clip-path="url(#o)"
    class="oPath path"
    d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
    stroke-width="32.5"
    ></path>
    <path
      clip-path="url(#a1)"
      class="a1Path path"
      d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
      stroke-width="59"
    ></path>
    <path
      clip-path="url(#c)"
      class="cPath path"
      d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
      stroke-width="110"
    ></path>
    <path
      clip-path="url(#i_b)"
      class="i_bPath path"
      d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
      stroke-width="33"
    ></path>
    <path
      clip-path="url(#a2)"
      class="a2Path path"
      d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
      stroke-width="70"
    ></path>
    </g>
    <g
      id="strokes2"
      fill="none"
      stroke=#ff97b8
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path
        clip-path="url(#o)"
        class="oPath path"
        d="M65.07,278.38c-.29-1.76-1.26-6.18-5-10-3.34-3.4-7.07-4.47-9-5-6.95-1.9-12.89,.22-15,1-10.95,4.04-18.33,15.16-20,26-1.42,9.21,1.56,16.56,3,20,1.49,3.55,3.94,9.39,10,14,6.66,5.07,13.73,5.65,18,6,3,.25,9.01,.67,16-2,1.72-.66,5.78-2.38,10-6,.99-.86,4.82-4.25,8-10,2.79-5.06,3.72-9.49,4-11,.39-2.12,1.09-6.93,0-13-1.05-5.85-1.95-10.86-6-13-2.83-1.5-7.27-1.62-10,1-1.73,1.66-2.85,4.55-2,7,1.04,2.99,4.58,4.01,8,5,1.16,.33,2.91,.75,8,1,4.72,.23,8.68,.18,12,0,6.49-.36,9.74-.54,12-1,4.35-.88,7.44-2.14,12-4,4.67-1.9,6.76-3.17,8-4,2.56-1.7,3.95-3.1,5-4,5.5-4.73,12.89-6.48,18-7,6.09-.62,11.96-.21,18,3,4.89,2.6,8.27,6.84,10,9,1.86,2.32,3.15,4.46,4,6"
        stroke-width="32.5"
      ></path>
      <path
        clip-path="url(#a1)"
        class="a1Path path"
        d="M154.07,270.38c-3.73,1.48-11.88,5.3-18,14-4.95,7.03-6.09,13.7-7,19-1.38,8.06-2.81,16.39,2,24,3.93,6.21,9.88,8.58,11,9,7.28,2.76,13.71,.75,16,0,5.19-1.71,8.32-4.6,12-8,2.48-2.29,6.78-6.34,10-13,2.71-5.61,3.51-10.73,4-14,.86-5.79,.57-9.98,1-10,.41-.02,.79,3.69,2,11,1.71,10.28,2.44,11.93,3,13,1.44,2.76,2.62,5.84,7,10,4.73,4.49,8.09,5.74,11,7,6.75,2.92,13.16,1.45,15,1,4.94-1.21,8.2-3.64,10-5,4.09-3.11,6.34-6.48,8-9,2.23-3.4,3.47-6.35,5-10,1.22-2.9,2.18-5.67,3-8,1.52-4.35,1.41-4.5,2-6,1.75-4.46,2-6,7-12,2.31-2.77,6.32-8.54,10-11,3.79-2.54,7-3.81,10-5,5.33-2.12,9-2.17,12-2,5.4,.32,10.2,4.49,12,6,2.31,1.93,6.05,6.97,7,12,.62,3.29-.19,5.13-1,8-.86,3.04-3.06,5.4-4,7"
        stroke-width="59"
      ></path>
      <path
        clip-path="url(#c)"
        class="cPath path"
        d="M273.07,272.38c-3.08,2.79-9.54,9.45-12,20-2.1,9.02-.22,16.29,1,21,1.57,6.05,3.22,12.44,9,18,6.67,6.42,14.58,7.66,17,8,6.36,.9,11.22-.42,17-2,3.68-1,8.59-2.39,14-6,4.13-2.76,6.84-5.67,9-8,3.24-3.49,5.27-6.46,7-9,2.22-3.27,4.18-6.89,8-14,3.39-6.3,5.1-9.5,6-12,1.67-4.63,2.38-8.58,3-12,.72-4,.94-6.77,1-9,.03-1.23,.02-2.26,0-3"
        stroke-width="110"
      ></path>
      <path
        clip-path="url(#i_b)"
        class="i_bPath path"
        d="M355.07,265.38c-1.55,12.11-2.45,22.6-3,31-.66,10.17-.79,16.98,2,25,1.74,5,3.75,10.53,9,13,6.29,2.97,13.34-.3,17-2,6.11-2.83,9.64-6.89,14-12,9.03-10.59,9.67-15.19,10-17,.6-3.32,1.32-6.16,1-8"
        stroke-width="33"
      ></path>
      <path
        clip-path="url(#a2)"
        class="a2Path path"
        d="M470.07,302.38c.32-2.77,.45-7.09-1-12-.98-3.32-5.25-15.49-17-19-12.13-3.62-22.23,4.71-25,7-6.75,5.57-9.28,12.36-11,17-1.68,4.53-5.22,14.03-2,25,1.19,4.05,3.29,11.22,10,15,7.78,4.39,16.49,1.26,20,0,6.31-2.27,10.12-6.13,14-10,4.99-4.97,7.76-9.61,11-15,1.88-3.14,4.54-7.61,7-14,3.15-8.18,3.42-14.06,4-14,.51,.05-.23,7.53,0,19,.07,3.38,.38,6.92,1,14,.41,4.62,.69,7.05,2,10,.82,1.86,2.1,4.74,5,7,4.4,3.43,9.65,3.17,13,3,1.08-.05,5.74-.35,11-3,4.39-2.21,7.04-4.97,9-7,.85-.89,3.48-3.69,6-8,1.51-2.58,1.83-3.87,4-9,1.54-3.64,2.92-6.7,4-9"
        stroke-width="70"
      ></path>
    </g>
    <g class="dot-group">
      <path
        id="dot"
        fill=#ff97b8
        d="M362.58,182.21c4.66-.33,9.66,1.17,15,4.5,5.33,3.34,7.66,7.5,7,12.5-.67,2.34-1.92,4.92-3.75,7.75-1.84,2.84-4,5.5-6.5,8s-4.84,4.75-7,6.75c-2.17,2-3.75,3.17-4.75,3.5-2.67,1.67-5.34,2.25-8,1.75-2.67-.5-5-1.5-7-3s-3.59-3.33-4.75-5.5c-1.17-2.16-1.92-4.25-2.25-6.25-.34-2,.16-4.66,1.5-8,1.33-3.33,3.08-6.58,5.25-9.75,2.16-3.16,4.58-6,7.25-8.5,2.66-2.5,5.33-3.75,8-3.75Z"
      ></path>
    </g>
  </svg>
  <div class="description" itemprop="description">月遇从云 花遇和风</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">53</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">46</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29hY2lh" title="https:&#x2F;&#x2F;github.com&#x2F;oacia"><i class="ic i-github"></i></span>
      <a target="_blank" rel="noopener" href="https://twitter.com/oacia86" title="https:&#x2F;&#x2F;twitter.com&#x2F;oacia86" class="item twitter"><i class="ic i-twitter"></i></a>
      <span class="exturl item paper-plane" data-url="aHR0cHM6Ly90Lm1lL29hY2lh" title="https:&#x2F;&#x2F;t.me&#x2F;oacia"><i class="ic i-paper-plane"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOm9hY2lhODZAZ21haWwuY29t" title="mailto:oacia86@gmail.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about-oacia/" rel="section"><i class="ic i-user"></i>关于oacia</a>
  </li>

    
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-feather"></i>文章</a>
  </li>

    
  <li class="item">
    <a href="/TODOlist/" rel="section"><i class="ic i-clock"></i>要做的事</a>
  </li>

    
  <li class="item">
    <a href="/website_maintenance/" rel="section"><i class="ic i-calendar"></i>更新日志</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>小伙伴</a>
  </li>

    
  <li class="item">
    <a href="/music/" rel="section"><i class="ic i-music"></i>听会儿歌吧</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/rwProcMem33-usage/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/sec-2023/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2022 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">oacia @ oacia</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">968k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">14:40</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>



<script data-config type="text/javascript">
  var LOCAL = {
    path: 'idapython-learning/',
    favicon: {
      show: "柚鳥ナツ",
      hide: "甘い幸せ"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>
<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>


<script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>
<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
